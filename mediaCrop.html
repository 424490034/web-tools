<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è§†é¢‘è£å‰ªå·¥å…· - FFmpeg WebAssembly</title>
    <!-- Cropper.js CSS -->
    <link href="./videoFormat/cropper.min.css" rel="stylesheet" />
    <script src="./ffmpeg.min.js"></script>
    <!-- Cropper.js JavaScript -->
    <script src="./videoFormat/cropper.min.js"></script>
    <style>
      :root {
        /* Neumorphism Color System */
        --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --primary-solid: #667eea;
        --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --secondary-solid: #f093fb;
        --success: #2ecc71;
        --warning: #f39c12;
        --danger: #e74c3c;

        /* Background System */
        --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --bg-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);

        /* Card System */
        --card: rgba(255, 255, 255, 0.1);
        --card-hover: rgba(255, 255, 255, 0.15);

        /* Text Colors */
        --text-primary: rgba(255, 255, 255, 0.95);
        --text-secondary: rgba(255, 255, 255, 0.7);
        --text-muted: rgba(255, 255, 255, 0.5);

        /* Shadow System */
        --shadow-small: 0 2px 8px rgba(0, 0, 0, 0.1);
        --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.15);
        --shadow-large: 0 8px 32px rgba(0, 0, 0, 0.2);
        --shadow-inset: inset 0 2px 8px rgba(0, 0, 0, 0.1);
        --shadow-outset: 0 6px 20px rgba(102, 126, 234, 0.3);

        /* Border Radius */
        --border-radius: 16px;
        --border-radius-small: 8px;
        --border-radius-large: 24px;

        /* Transition */
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: var(--background);
        color: var(--text-primary);
        min-height: 100vh;
        animation: fadeIn 0.8s ease-out;
      }

      .container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 24px;
        background: var(--card);
        backdrop-filter: blur(20px);
        border-radius: var(--border-radius-large);
        box-shadow: var(--shadow-large);
        border: 1px solid rgba(255, 255, 255, 0.1);
        animation: containerFloat 6s ease-in-out infinite;
      }

      header {
        text-align: center;
        margin-bottom: 32px;
        padding: 24px;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1),
          rgba(255, 255, 255, 0.05)
        );
        backdrop-filter: blur(10px);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-medium);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
        animation: headerShine 3s ease-in-out infinite;
      }

      h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 12px;
        background: linear-gradient(
          135deg,
          var(--primary-solid),
          var(--secondary-solid)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: titlePulse 2s ease-in-out infinite;
        letter-spacing: -0.02em;
      }

      .subtitle {
        font-size: 1.1rem;
        color: var(--text-secondary);
        font-weight: 400;
        letter-spacing: 0.01em;
      }

      .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        padding: 24px;
        animation: slideIn 0.6s ease-out;
      }

      .upload-panel,
      .settings-panel {
        background: var(--card);
        backdrop-filter: blur(10px);
        border-radius: var(--border-radius);
        padding: 24px;
        box-shadow: var(--shadow-medium);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .upload-panel::before,
      .settings-panel::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transition: var(--transition);
      }

      .upload-panel:hover::before,
      .settings-panel:hover::before {
        left: 100%;
      }

      .upload-panel:hover,
      .settings-panel:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-outset);
      }

      .panel-title {
        font-size: 1.4rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 12px;
        position: relative;
        z-index: 1;
      }

      .panel-title::before {
        content: '';
        width: 4px;
        height: 24px;
        background: var(--primary);
        border-radius: 2px;
        animation: titlePulse 2s ease-in-out infinite;
      }

      .file-upload-area {
        border: 2px dashed rgba(102, 126, 234, 0.3);
        border-radius: var(--border-radius);
        padding: 40px 20px;
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
        background: var(--card);
        box-shadow: var(--shadow-inset);
        position: relative;
        overflow: hidden;
        margin-bottom: 24px;
      }

      .file-upload-area::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: radial-gradient(
          circle,
          rgba(102, 126, 234, 0.1),
          transparent
        );
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: var(--transition);
      }

      .file-upload-area:hover {
        border-color: var(--primary-solid);
        transform: translateY(-2px);
        box-shadow: var(--shadow-outset);
      }

      .file-upload-area:hover::before {
        width: 300px;
        height: 300px;
      }

      .file-upload-area.dragover {
        background: var(--card-hover);
        border-color: var(--primary-solid);
        transform: scale(1.02);
        box-shadow: var(--shadow-large);
      }

      .upload-icon {
        font-size: 3rem;
        color: var(--primary-solid);
        margin-bottom: 16px;
        animation: iconPulse 2s ease-in-out infinite;
        position: relative;
        z-index: 1;
      }

      .file-upload-area p {
        position: relative;
        z-index: 1;
        margin: 8px 0;
        color: var(--text-primary);
        font-weight: 500;
      }

      .file-upload-area p:first-of-type {
        font-weight: 600;
        font-size: 1.1rem;
      }

      .file-upload-area p:last-of-type {
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      .cropper-bg {
        background-image: none;
      }

      .video-preview {
        margin-top: 20px;
        position: relative;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow-medium);
        background: var(--card);
      }

      .video-preview video {
        width: 100%;
        height: auto;
        display: block;
        border-radius: var(--border-radius);
      }

      #cropperContainer {
        border-radius: var(--border-radius);
        transition: background 0.3s ease;
      }

      .cropper-canvas img,
      .cropper-view-box img,
      .cropper-modal {
        opacity: 0;
      }

      .cropper-point {
        width: 10px;
        height: 10px;
        opacity: 1;
      }

      .cropper-line {
        opacity: 0.5;
      }

      #cropperImage {
        border-radius: var(--border-radius);
      }

      .crop-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 10;
      }

      .crop-selection {
        position: absolute;
        border: 3px solid var(--primary-solid);
        background: rgba(102, 126, 234, 0.15);
        cursor: move;
        pointer-events: all;
        min-width: 50px;
        min-height: 50px;
        box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.6),
          inset 0 0 0 1px rgba(255, 255, 255, 0.3),
          0 0 20px rgba(102, 126, 234, 0.4);
        transition: var(--transition);
        touch-action: none;
      }

      .crop-selection:hover {
        border-color: var(--secondary-solid);
        background: rgba(240, 147, 251, 0.15);
        box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7),
          inset 0 0 0 1px rgba(255, 255, 255, 0.4),
          0 0 30px rgba(240, 147, 251, 0.5);
      }

      .crop-selection:active {
        border-color: var(--secondary-solid);
        background: rgba(240, 147, 251, 0.2);
      }

      .crop-handle {
        position: absolute;
        width: 16px;
        height: 16px;
        background: var(--primary-solid);
        border: 3px solid white;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: var(--shadow-medium);
        transition: var(--transition);
        z-index: 20;
        touch-action: none;
      }

      .crop-handle:hover {
        box-shadow: var(--shadow-outset);
        background: var(--secondary-solid);
      }

      .crop-handle:active {
        box-shadow: var(--shadow-large);
      }

      .crop-handle.nw:hover,
      .crop-handle.ne:hover,
      .crop-handle.sw:hover,
      .crop-handle.se:hover {
        transform: scale(1.2);
      }

      .crop-handle.nw:active,
      .crop-handle.ne:active,
      .crop-handle.sw:active,
      .crop-handle.se:active {
        transform: scale(1.1);
      }

      .crop-handle.nw {
        top: -8px;
        left: -8px;
        cursor: nw-resize;
      }
      .crop-handle.ne {
        top: -8px;
        right: -8px;
        cursor: ne-resize;
      }
      .crop-handle.sw {
        bottom: -8px;
        left: -8px;
        cursor: sw-resize;
      }
      .crop-handle.se {
        bottom: -8px;
        right: -8px;
        cursor: se-resize;
      }
      .crop-handle.n {
        top: -8px;
        left: 50%;
        transform: translateX(-50%);
        cursor: n-resize;
      }
      .crop-handle.s {
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        cursor: s-resize;
      }
      .crop-handle.w {
        top: 50%;
        left: -8px;
        transform: translateY(-50%);
        cursor: w-resize;
      }
      .crop-handle.e {
        top: 50%;
        right: -8px;
        transform: translateY(-50%);
        cursor: e-resize;
      }

      .crop-handle.n:hover,
      .crop-handle.s:hover {
        transform: translateX(-50%) scale(1.2);
      }

      .crop-handle.w:hover,
      .crop-handle.e:hover {
        transform: translateY(-50%) scale(1.2);
      }

      /* è‡ªå®šä¹‰è§†é¢‘æ§åˆ¶æ¡æ ·å¼ */
      .video-controls {
        margin-top: 16px;
        background: var(--card);
        backdrop-filter: blur(10px);
        border-radius: var(--border-radius);
        padding: 16px;
        box-shadow: var(--shadow-medium);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: var(--transition);
      }

      .progress-container-video {
        margin-bottom: 12px;
      }

      .video-progress {
        width: 100%;
        height: 6px;
        -webkit-appearance: none;
        background: var(--card-hover);
        border-radius: 3px;
        outline: none;
        cursor: pointer;
        transition: var(--transition);
        padding: 8px 0 !important;
      }

      #timeSlider {
        padding: 8px 0 !important;
      }

      .video-progress::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px;
        height: 16px;
        background: var(--primary-solid);
        border-radius: 50%;
        cursor: pointer;
        box-shadow: var(--shadow-medium);
        transition: var(--transition);
      }

      .video-progress::-webkit-slider-thumb:hover {
        transform: scale(1.2);
        box-shadow: var(--shadow-outset);
      }

      .controls-row {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .control-btn {
        background: var(--card-hover);
        border: none;
        border-radius: var(--border-radius-small);
        padding: 8px 12px;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: var(--shadow-small);
        color: var(--text-primary);
        font-size: 1.2rem;
      }

      .control-btn:hover {
        background: var(--primary-solid);
        transform: translateY(-1px);
        box-shadow: var(--shadow-medium);
      }

      .time-display {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 0.9rem;
        color: var(--text-secondary);
        font-weight: 500;
        min-width: 80px;
      }

      .volume-control {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-left: auto;
      }

      .volume-slider {
        width: 80px;
        height: 4px;
        -webkit-appearance: none;
        background: var(--card-hover);
        border-radius: 2px;
        outline: none;
        cursor: pointer;
        padding: 8px 0 !important;
      }

      .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 12px;
        height: 12px;
        background: var(--primary-solid);
        border-radius: 50%;
        cursor: pointer;
        transition: var(--transition);
      }

      .volume-slider::-webkit-slider-thumb:hover {
        transform: scale(1.1);
      }

      .opacity-control {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-left: 16px;
      }

      .opacity-label {
        font-size: 1.1rem;
        color: var(--text-secondary);
      }

      .opacity-slider {
        width: 80px;
        height: 4px;
        -webkit-appearance: none;
        background: var(--card-hover);
        border-radius: 2px;
        outline: none;
        cursor: pointer;
        padding: 8px 0 !important;
      }

      .opacity-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 12px;
        height: 12px;
        background: var(--secondary-solid);
        border-radius: 50%;
        cursor: pointer;
        transition: var(--transition);
      }

      .opacity-slider::-webkit-slider-thumb:hover {
        transform: scale(1.1);
      }

      /* å¼¹æ¡†æ ·å¼ */
      /* Modal styles removed - using Cropper.js directly */

      .form-group {
        margin-bottom: 24px;
        position: relative;
        z-index: 1;
      }

      label {
        display: block;
        margin-bottom: 12px;
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.95rem;
        letter-spacing: -0.01em;
      }

      input[type='number'],
      input[type='range'],
      select {
        width: 100%;
        padding: 14px 16px;
        border-radius: var(--border-radius-small);
        border: none;
        font-size: 16px;
        background: var(--card);
        box-shadow: var(--shadow-inset);
        transition: var(--transition);
        color: var(--text-primary);
        font-weight: 500;
      }

      select option {
        color: #333;
      }

      input[type='number']:focus,
      select:focus {
        outline: none;
        box-shadow: var(--shadow-outset);
        transform: translateY(-1px);
      }

      input[type='number']:hover,
      select:hover {
        box-shadow: var(--shadow-medium);
      }

      input[type='range'] {
        -webkit-appearance: none;
        height: 8px;
        background: var(--card-hover);
        border-radius: 4px;
        box-shadow: var(--shadow-inset);
      }

      input[type='range']::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        background: var(--primary-solid);
        border-radius: 50%;
        cursor: pointer;
        box-shadow: var(--shadow-medium);
        transition: var(--transition);
      }

      input[type='range']::-webkit-slider-thumb:hover {
        transform: scale(1.1);
        box-shadow: var(--shadow-outset);
      }

      .time-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 20px;
      }

      .format-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 12px;
        margin-bottom: 24px;
      }

      .format-option {
        padding: 16px 12px;
        background: var(--card);
        border: 2px solid transparent;
        border-radius: var(--border-radius-small);
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: var(--shadow-medium);
        position: relative;
        overflow: hidden;
      }

      .format-option::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          rgba(102, 126, 234, 0.1),
          rgba(118, 75, 162, 0.1)
        );
        opacity: 0;
        transition: var(--transition);
      }

      .format-option:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-outset);
      }

      .format-option:hover::before {
        opacity: 1;
      }

      .format-option.selected {
        border-color: var(--primary-solid);
        background: var(--card-hover);
        box-shadow: var(--shadow-outset);
      }

      .format-option.selected::before {
        opacity: 1;
      }

      .format-icon {
        font-size: 1.5rem;
        margin-bottom: 8px;
        display: block;
        position: relative;
        z-index: 1;
      }

      .format-name {
        font-weight: 600;
        font-size: 0.9rem;
        position: relative;
        z-index: 1;
      }

      .action-buttons {
        display: flex;
        gap: 16px;
        margin-top: 32px;
        justify-content: center;
      }

      .btn {
        padding: 16px 32px;
        border: none;
        border-radius: var(--border-radius-small);
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: relative;
        overflow: hidden;
        box-shadow: var(--shadow-medium);
      }

      .btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: var(--transition);
      }

      .btn:hover::before {
        width: 300px;
        height: 300px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-outset);
      }

      .btn:active {
        transform: translateY(0);
        box-shadow: var(--shadow-small);
      }

      .btn-primary {
        background: var(--primary);
        color: white;
      }

      .btn-secondary {
        background: var(--card);
        color: var(--text-primary);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .btn:disabled {
        background: var(--card);
        color: var(--text-muted);
        cursor: not-allowed;
        transform: none;
        box-shadow: var(--shadow-inset);
        opacity: 0.6;
      }

      .btn:disabled::before {
        display: none;
      }

      .progress-container {
        margin-top: 24px;
        display: none;
      }

      .progress-bar {
        width: 100%;
        height: 12px;
        background: var(--card-hover);
        border-radius: var(--border-radius-small);
        overflow: hidden;
        box-shadow: var(--shadow-inset);
        position: relative;
      }

      .progress-bar::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          45deg,
          transparent 25%,
          rgba(255, 255, 255, 0.1) 25%,
          rgba(255, 255, 255, 0.1) 50%,
          transparent 50%,
          transparent 75%,
          rgba(255, 255, 255, 0.1) 75%
        );
        background-size: 20px 20px;
        animation: progressStripes 1s linear infinite;
      }

      .progress {
        height: 100%;
        background: var(--primary);
        width: 0%;
        transition: width 0.4s ease-out;
        position: relative;
        border-radius: var(--border-radius-small);
        box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
      }

      .progress::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: progressShine 2s infinite;
      }

      .progress-text {
        text-align: center;
        margin-top: 12px;
        font-weight: 500;
        color: var(--text-secondary);
      }

      .result-container {
        margin-top: 24px;
        display: none;
      }

      .result-video {
        width: 100%;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-large);
        margin-bottom: 16px;
      }

      .download-btn {
        width: 100%;
        background: var(--success);
        color: white;
        padding: 16px;
        border: none;
        border-radius: var(--border-radius-small);
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: var(--shadow-medium);
      }

      .download-btn:hover {
        background: #27ae60;
        transform: translateY(-2px);
        box-shadow: var(--shadow-outset);
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes containerFloat {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-5px);
        }
      }

      @keyframes headerShine {
        0% {
          background-position: -200% center;
        }
        100% {
          background-position: 200% center;
        }
      }

      @keyframes titlePulse {
        0%,
        100% {
          text-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }
        50% {
          text-shadow: 0 0 20px rgba(102, 126, 234, 0.6),
            0 0 30px rgba(102, 126, 234, 0.4);
        }
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes iconPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      @keyframes progressStripes {
        0% {
          background-position: 0 0;
        }
        100% {
          background-position: 20px 0;
        }
      }

      @keyframes progressShine {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      /* Mobile Responsive */
      @media (max-width: 1024px) {
        .container {
          margin: 10px;
          padding: 20px;
        }

        .main-content {
          grid-template-columns: 1fr;
          gap: 20px;
          padding: 20px;
        }
      }

      @media (max-width: 768px) {
        .container {
          margin: 5px;
          padding: 16px;
        }

        h1 {
          font-size: 2rem;
        }

        .subtitle {
          font-size: 1rem;
        }

        .main-content {
          padding: 16px;
          gap: 16px;
        }

        .upload-panel,
        .settings-panel {
          padding: 20px;
        }

        .file-upload-area {
          padding: 32px 16px;
        }

        .upload-icon {
          font-size: 2.5rem;
        }

        .time-controls {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .format-options {
          grid-template-columns: repeat(2, 1fr);
        }

        .action-buttons {
          flex-direction: column;
          gap: 12px;
        }

        .btn {
          padding: 14px 24px;
          font-size: 0.95rem;
        }
      }

      @media (max-width: 480px) {
        .container {
          margin: 0;
          padding: 12px;
          border-radius: 0;
        }

        h1 {
          font-size: 1.8rem;
        }

        .subtitle {
          font-size: 0.9rem;
        }

        .main-content {
          padding: 12px;
          gap: 12px;
        }

        .upload-panel,
        .settings-panel {
          padding: 16px;
        }

        .panel-title {
          font-size: 1.2rem;
        }

        .file-upload-area {
          padding: 24px 12px;
        }

        .upload-icon {
          font-size: 2rem;
        }

        .format-options {
          grid-template-columns: 1fr;
        }

        .format-option {
          padding: 12px 8px;
        }

        .btn {
          padding: 12px 20px;
          font-size: 0.9rem;
        }

        input[type='number'],
        select {
          padding: 12px 14px;
          font-size: 14px;
        }

        /* ç§»åŠ¨ç«¯è£å‰ªåŒºåŸŸä¼˜åŒ– */
        .crop-handle {
          width: 20px;
          height: 20px;
          border: 4px solid white;
        }

        .crop-handle.nw {
          top: -10px;
          left: -10px;
        }
        .crop-handle.ne {
          top: -10px;
          right: -10px;
        }
        .crop-handle.sw {
          bottom: -10px;
          left: -10px;
        }
        .crop-handle.se {
          bottom: -10px;
          right: -10px;
        }
        .crop-handle.n {
          top: -10px;
        }
        .crop-handle.s {
          bottom: -10px;
        }
        .crop-handle.w {
          left: -10px;
        }
        .crop-handle.e {
          right: -10px;
        }

        .crop-selection {
          border-width: 4px;
          min-width: 80px;
          min-height: 80px;
        }

        /* ç§»åŠ¨ç«¯è§†é¢‘æ§åˆ¶æ¡ä¼˜åŒ– */
        .video-controls {
          padding: 12px;
        }

        .controls-row {
          flex-wrap: wrap;
          gap: 12px;
          justify-content: space-between;
        }

        .control-btn {
          padding: 12px 16px;
          font-size: 1.4rem;
          min-width: 48px;
          min-height: 48px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .time-display {
          order: 1;
          flex: 1;
          min-width: 100px;
          justify-content: center;
          font-size: 1rem;
        }

        .volume-control {
          order: 2;
          margin-left: 0;
          flex: 1;
          min-width: 120px;
        }

        .volume-slider {
          width: 100%;
          height: 8px;
          padding: 12px 0 !important;
        }

        .volume-slider::-webkit-slider-thumb {
          width: 20px;
          height: 20px;
        }

        .opacity-control {
          order: 3;
          margin-left: 0;
          flex: 1;
          min-width: 120px;
        }

        .opacity-slider {
          width: 100%;
          height: 8px;
          padding: 12px 0 !important;
        }

        .opacity-slider::-webkit-slider-thumb {
          width: 20px;
          height: 20px;
        }

        .video-progress {
          height: 10px;
          padding: 12px 0 !important;
        }

        .video-progress::-webkit-slider-thumb {
          width: 24px;
          height: 24px;
        }
      }

      @media (max-width: 360px) {
        /* è¶…å°å±å¹•ä¼˜åŒ– */
        .controls-row {
          flex-direction: column;
          align-items: stretch;
        }

        .volume-control,
        .opacity-control {
          justify-content: space-between;
        }

        .control-btn {
          width: 100%;
          margin-bottom: 8px;
        }

        .time-display {
          text-align: center;
          margin: 8px 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ğŸ¬ åª’ä½“è£å‰ªå·¥å…·</h1>
        <p class="subtitle">
          æ”¯æŒè§†é¢‘å’Œå›¾ç‰‡è£å‰ªå¤„ç†ï¼Œè§†é¢‘å¯æŒ‡å®šæ—¶é•¿å’ŒåŒºåŸŸï¼Œå›¾ç‰‡å¯ç²¾ç¡®è£å‰ª -
          åŸºäºFFmpeg WebAssemblyå’ŒCropper.js
        </p>
      </header>

      <div class="main-content">
        <!-- ä¸Šä¼ é¢æ¿ -->
        <div class="upload-panel">
          <h2 class="panel-title">ğŸ“ è§†é¢‘ä¸Šä¼ </h2>

          <div class="file-upload-area" id="uploadArea">
            <div class="upload-icon">ğŸ¥</div>
            <p>ç‚¹å‡»æˆ–æ‹–æ‹½è§†é¢‘æˆ–å›¾ç‰‡æ–‡ä»¶åˆ°æ­¤å¤„</p>
            <p>
              æ”¯æŒ MP4, MOV, AVI, WebM ç­‰è§†é¢‘æ ¼å¼ï¼Œä»¥åŠ JPG, PNG, GIF ç­‰å›¾ç‰‡æ ¼å¼
            </p>
          </div>

          <input
            type="file"
            id="videoInput"
            accept="video/*,image/*"
            style="display: none"
          />

          <div class="video-preview" id="videoPreview" style="display: none">
            <video id="previewVideo"></video>
            <img
              id="previewImage"
              style="
                width: 100%;
                height: 100%;
                object-fit: contain;
                display: none;
              "
            />
            <!-- Cropper.js container overlays the video/image -->
            <div
              id="cropperContainer"
              style="
                display: none;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 10;
              "
            >
              <img
                id="cropperImage"
                style="width: 100%; height: 100%; object-fit: contain"
              />
            </div>
          </div>
          <!-- è‡ªå®šä¹‰è§†é¢‘æ§åˆ¶æ¡ -->
          <div class="video-controls" id="videoControls" style="display: none">
            <div class="progress-container-video">
              <input
                type="range"
                id="videoProgress"
                class="video-progress"
                min="0"
                max="100"
                value="0"
              />
            </div>
            <div class="controls-row">
              <button class="control-btn" id="playPauseBtn">
                <span class="play-icon">â–¶ï¸</span>
              </button>
              <div class="time-display">
                <span id="videoCurrentTime">00:00</span>
                <span>/</span>
                <span id="videoDuration">00:00</span>
              </div>
              <div class="volume-control">
                <button class="control-btn" id="muteBtn">
                  <span class="volume-icon">ğŸ”Š</span>
                </button>
                <input
                  type="range"
                  id="volumeSlider"
                  class="volume-slider"
                  min="0"
                  max="100"
                  value="100"
                />
              </div>
              <div class="opacity-control">
                <span class="opacity-label">ğŸ­</span>
                <input
                  type="range"
                  id="opacitySlider"
                  class="opacity-slider"
                  min="0"
                  max="100"
                  value="30"
                  title="è£å‰ªåŒºåŸŸé€æ˜åº¦"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- è®¾ç½®é¢æ¿ -->
        <div class="settings-panel">
          <h2 class="panel-title">âš™ï¸ è£å‰ªè®¾ç½®</h2>

          <div class="form-group" id="timeRangeGroup">
            <label>æ—¶é—´èŒƒå›´è®¾ç½®</label>
            <div class="time-controls">
              <div>
                <label for="startTime">å¼€å§‹æ—¶é—´ (ç§’)</label>
                <div style="display: flex; gap: 8px; align-items: center">
                  <input
                    type="number"
                    id="startTime"
                    min="0"
                    step="0.1"
                    value="0"
                    style="flex: 1"
                  />
                  <button
                    class="btn btn-secondary"
                    id="setStartTimeBtn"
                    style="padding: 8px 12px; font-size: 0.8rem"
                    disabled
                  >
                    é€‰æ‹©å½“å‰æ—¶é—´
                  </button>
                </div>
              </div>
              <div>
                <label for="endTime">ç»“æŸæ—¶é—´ (ç§’)</label>
                <div style="display: flex; gap: 8px; align-items: center">
                  <input
                    type="number"
                    id="endTime"
                    min="0"
                    step="0.1"
                    value="10"
                    style="flex: 1"
                  />
                  <button
                    class="btn btn-secondary"
                    id="setEndTimeBtn"
                    style="padding: 8px 12px; font-size: 0.8rem"
                    disabled
                  >
                    é€‰æ‹©å½“å‰æ—¶é—´
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group" id="timeSliderGroup">
            <label for="timeSlider">æ—¶é—´è½´é€‰æ‹©</label>
            <input type="range" id="timeSlider" min="0" max="100" value="0" />
            <div
              style="
                display: flex;
                justify-content: space-between;
                font-size: 0.9rem;
                color: var(--text-secondary);
                margin-top: 8px;
              "
            >
              <span id="currentTime">00:00</span>
              <span id="totalTime">00:00</span>
            </div>
          </div>

          <div class="form-group">
            <label>è£å‰ªåŒºåŸŸè®¾ç½®</label>
            <p
              style="
                color: var(--text-secondary);
                font-size: 0.9rem;
                margin-bottom: 16px;
              "
            >
              ä½¿ç”¨ä¸‹æ–¹çš„Cropper.jså·¥å…·è¿›è¡Œç²¾ç¡®è£å‰ª
            </p>
          </div>

          <div class="form-group">
            <label>è£å‰ªåŒºåŸŸ (åƒç´ )</label>
            <p
              style="
                color: var(--text-secondary);
                font-size: 0.85rem;
                margin-bottom: 12px;
                line-height: 1.4;
              "
            >
              ğŸ’¡ <strong>å°ºå¯¸é™åˆ¶ï¼š</strong>å›¾ç‰‡æœ€å¤§æ”¯æŒ 4096x4096ï¼Œè§†é¢‘æœ€å¤§æ”¯æŒ
              2048x2048
            </p>
            <div class="time-controls">
              <div>
                <label for="cropX">X åæ ‡</label>
                <input type="number" id="cropX" min="0" value="0" />
              </div>
              <div>
                <label for="cropY">Y åæ ‡</label>
                <input type="number" id="cropY" min="0" value="0" />
              </div>
            </div>
            <div class="time-controls">
              <div>
                <label for="cropWidth">å®½åº¦</label>
                <input
                  type="number"
                  id="cropWidth"
                  min="1"
                  max="4096"
                  value="640"
                />
              </div>
              <div>
                <label for="cropHeight">é«˜åº¦</label>
                <input
                  type="number"
                  id="cropHeight"
                  min="1"
                  max="4096"
                  value="360"
                />
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>è¾“å‡ºæ ¼å¼</label>
            <div class="format-options" id="formatOptions">
              <!-- è§†é¢‘æ ¼å¼ -->
              <div
                class="format-option selected video-format"
                data-format="mp4"
              >
                <span class="format-icon">ğŸ¬</span>
                <span class="format-name">MP4</span>
              </div>
              <div class="format-option video-format" data-format="webm">
                <span class="format-icon">ğŸŒ</span>
                <span class="format-name">WebM</span>
              </div>
              <div class="format-option video-format" data-format="gif">
                <span class="format-icon">ğŸï¸</span>
                <span class="format-name">GIF</span>
              </div>
              <!-- å›¾ç‰‡æ ¼å¼ -->
              <div
                class="format-option image-format"
                data-format="jpg"
                style="display: none"
              >
                <span class="format-icon">ğŸ–¼ï¸</span>
                <span class="format-name">JPG</span>
              </div>
              <div
                class="format-option image-format"
                data-format="png"
                style="display: none"
              >
                <span class="format-icon">ğŸ–¼ï¸</span>
                <span class="format-name">PNG</span>
              </div>
              <div
                class="format-option image-format"
                data-format="webp"
                style="display: none"
              >
                <span class="format-icon">ğŸ–¼ï¸</span>
                <span class="format-name">WebP</span>
              </div>
            </div>
          </div>

          <div class="form-group" id="qualityGroup">
            <label for="quality">è§†é¢‘è´¨é‡</label>
            <select id="quality">
              <option value="23">é«˜è´¨é‡ (è¾ƒå¤§æ–‡ä»¶)</option>
              <option value="28" selected>ä¸­ç­‰è´¨é‡</option>
              <option value="32">ä½è´¨é‡ (è¾ƒå°æ–‡ä»¶)</option>
            </select>
          </div>

          <div class="form-group" id="gifGroup" style="display: none">
            <label for="gifFps">GIF å¸§ç‡</label>
            <select id="gifFps">
              <option value="10">10 FPS</option>
              <option value="15" selected>15 FPS</option>
              <option value="20">20 FPS</option>
              <option value="24">24 FPS</option>
            </select>
          </div>

          <div class="action-buttons">
            <button class="btn btn-secondary" id="resetBtn">é‡ç½®</button>
            <button class="btn btn-primary" id="cropBtn" disabled>
              å¼€å§‹è£å‰ª
            </button>
          </div>

          <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
              <div class="progress" id="progressBar"></div>
            </div>
            <div class="progress-text" id="progressText">å¤„ç†ä¸­...</div>
          </div>

          <div class="result-container" id="resultContainer">
            <video class="result-video" id="resultVideo" controls></video>
            <button class="download-btn" id="downloadBtn">
              ä¸‹è½½è£å‰ªåçš„æ–‡ä»¶
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- è£å‰ªå¼¹æ¡† -->
    <!-- Modal removed - using Cropper.js directly -->

    <script>
      class VideoCropper {
        constructor() {
          this.ffmpeg = null
          this.videoFile = null
          this.videoElement = null
          this.cropper = null
          this.cropperImage = null
          this.canvas = null
          this.isImageFile = false // æ ‡è®°æ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶

          this.init()
        }

        async init() {
          await this.loadFFmpeg()
          this.setupEventListeners()
        }

        async loadFFmpeg() {
          try {
            this.ffmpeg = FFmpeg.createFFmpeg({
              log: true,
            })
            await this.ffmpeg.load()
            console.log('FFmpeg loaded successfully')
          } catch (error) {
            console.error('Failed to load FFmpeg:', error)
            alert('FFmpeg åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•')
          }
        }

        setupEventListeners() {
          const uploadArea = document.getElementById('uploadArea')
          const videoInput = document.getElementById('videoInput')
          const cropBtn = document.getElementById('cropBtn')
          const resetBtn = document.getElementById('resetBtn')
          const downloadBtn = document.getElementById('downloadBtn')
          const formatOptions = document.querySelectorAll('.format-option')

          // æ–‡ä»¶ä¸Šä¼ 
          uploadArea.addEventListener('click', () => videoInput.click())
          uploadArea.addEventListener(
            'dragover',
            this.handleDragOver.bind(this)
          )
          uploadArea.addEventListener('drop', this.handleDrop.bind(this))
          videoInput.addEventListener(
            'change',
            this.handleFileSelect.bind(this)
          )

          // æ ¼å¼é€‰æ‹©
          formatOptions.forEach((option) => {
            option.addEventListener('click', this.handleFormatSelect.bind(this))
          })

          // æŒ‰é’®äº‹ä»¶
          cropBtn.addEventListener('click', this.startCropping.bind(this))
          resetBtn.addEventListener('click', this.reset.bind(this))
          downloadBtn.addEventListener('click', this.downloadResult.bind(this))

          // æ—¶é—´é€‰æ‹©æŒ‰é’®
          const setStartTimeBtn = document.getElementById('setStartTimeBtn')
          const setEndTimeBtn = document.getElementById('setEndTimeBtn')
          setStartTimeBtn.addEventListener(
            'click',
            this.setCurrentTimeAsStart.bind(this)
          )
          setEndTimeBtn.addEventListener(
            'click',
            this.setCurrentTimeAsEnd.bind(this)
          )

          // æ—¶é—´æ§åˆ¶
          const timeSlider = document.getElementById('timeSlider')
          const startTime = document.getElementById('startTime')
          const endTime = document.getElementById('endTime')

          timeSlider.addEventListener(
            'input',
            this.handleTimeSliderChange.bind(this)
          )
          startTime.addEventListener('input', this.updateTimeRange.bind(this))
          endTime.addEventListener('input', this.updateTimeRange.bind(this))

          // è£å‰ªåŒºåŸŸè¾“å…¥
          ;['cropX', 'cropY', 'cropWidth', 'cropHeight'].forEach((id) => {
            document
              .getElementById(id)
              .addEventListener('input', this.updateCropFromInputs.bind(this))
          })
        }

        // Cropper.js handles all crop interactions, no need for custom setup

        handleDragOver(e) {
          e.preventDefault()
          e.currentTarget.classList.add('dragover')
        }

        handleDrop(e) {
          e.preventDefault()
          e.currentTarget.classList.remove('dragover')
          const files = e.dataTransfer.files
          if (files.length > 0) {
            const file = files[0]
            this.videoFile = file
            // æ£€æµ‹æ–‡ä»¶ç±»å‹
            this.isImageFile = file.type.startsWith('image/')

            if (this.isImageFile) {
              this.loadImage(file)
            } else {
              this.loadVideo(file)
            }

            // åˆ‡æ¢UIæ˜¾ç¤º
            this.toggleUIForFileType()
          }
        }

        handleFileSelect(e) {
          const file = e.target.files[0]
          if (file) {
            this.videoFile = file
            // æ£€æµ‹æ–‡ä»¶ç±»å‹
            this.isImageFile = file.type.startsWith('image/')

            if (this.isImageFile) {
              this.loadImage(file)
            } else {
              this.loadVideo(file)
            }

            // åˆ‡æ¢UIæ˜¾ç¤º
            this.toggleUIForFileType()
          }
        }

        loadVideo(file) {
          const url = URL.createObjectURL(file)

          const videoPreview = document.getElementById('videoPreview')
          const previewVideo = document.getElementById('previewVideo')
          const previewImage = document.getElementById('previewImage')
          const cropperContainer = document.getElementById('cropperContainer')
          const cropperImage = document.getElementById('cropperImage')

          previewVideo.src = url
          videoPreview.style.display = 'block'
          previewVideo.style.display = 'block'
          previewImage.style.display = 'none'
          cropperContainer.style.display = 'none'

          previewVideo.addEventListener('loadedmetadata', () => {
            // æ£€æŸ¥è§†é¢‘å°ºå¯¸é™åˆ¶
            const maxDimension = 2048
            if (
              previewVideo.videoWidth > maxDimension ||
              previewVideo.videoHeight > maxDimension
            ) {
              alert(
                `è§†é¢‘å°ºå¯¸è¿‡å¤§ï¼\nå½“å‰å°ºå¯¸ï¼š${previewVideo.videoWidth}x${previewVideo.videoHeight}\næœ€å¤§æ”¯æŒå°ºå¯¸ï¼š${maxDimension}x${maxDimension}\n\nè¯·é€‰æ‹©è¾ƒå°å°ºå¯¸çš„è§†é¢‘æ–‡ä»¶ã€‚`
              )
              // æ¸…ç†èµ„æº
              URL.revokeObjectURL(url)
              previewVideo.src = ''
              videoPreview.style.display = 'none'
              return
            }

            this.setupVideoControls(previewVideo)
            this.initializeCropper(previewVideo)
            document.getElementById('cropBtn').disabled = false
          })

          this.videoElement = previewVideo
          this.cropperImage = cropperImage
        }

        loadImage(file) {
          const url = URL.createObjectURL(file)

          const videoPreview = document.getElementById('videoPreview')
          const previewVideo = document.getElementById('previewVideo')
          const previewImage = document.getElementById('previewImage')
          const cropperContainer = document.getElementById('cropperContainer')
          const cropperImage = document.getElementById('cropperImage')

          // æ˜¾ç¤ºè§†é¢‘é¢„è§ˆå®¹å™¨ï¼Œéšè—è§†é¢‘å…ƒç´ ï¼Œæ˜¾ç¤ºå›¾ç‰‡å…ƒç´ å’Œè£å‰ªå®¹å™¨
          videoPreview.style.display = 'block'
          previewVideo.style.display = 'none'
          previewImage.style.display = 'block'
          previewImage.src = url
          cropperContainer.style.display = 'block'

          // ç›´æ¥åŠ è½½å›¾ç‰‡åˆ°cropper
          cropperImage.src = url
          cropperImage.onload = () => {
            // æ£€æŸ¥å›¾ç‰‡å°ºå¯¸é™åˆ¶
            const maxDimension = 4096
            if (
              cropperImage.naturalWidth > maxDimension ||
              cropperImage.naturalHeight > maxDimension
            ) {
              alert(
                `å›¾ç‰‡å°ºå¯¸è¿‡å¤§ï¼\nå½“å‰å°ºå¯¸ï¼š${cropperImage.naturalWidth}x${cropperImage.naturalHeight}\næœ€å¤§æ”¯æŒå°ºå¯¸ï¼š${maxDimension}x${maxDimension}\n\nè¯·é€‰æ‹©è¾ƒå°å°ºå¯¸çš„å›¾ç‰‡æ–‡ä»¶ã€‚`
              )
              // æ¸…ç†èµ„æº
              URL.revokeObjectURL(url)
              cropperImage.src = ''
              videoPreview.style.display = 'none'
              cropperContainer.style.display = 'none'
              return
            }

            this.initializeCropperForImage(cropperImage)
            document.getElementById('cropBtn').disabled = false
          }

          this.cropperImage = cropperImage
        }

        setupVideoControls(video) {
          const timeSlider = document.getElementById('timeSlider')
          const currentTime = document.getElementById('currentTime')
          const totalTime = document.getElementById('totalTime')
          const endTime = document.getElementById('endTime')
          const setStartTimeBtn = document.getElementById('setStartTimeBtn')
          const setEndTimeBtn = document.getElementById('setEndTimeBtn')

          const duration = video.duration
          timeSlider.max = duration
          endTime.value = Math.min(10, duration)
          endTime.max = duration

          totalTime.textContent = this.formatTime(duration)

          // å¯ç”¨å½“å‰æ—¶é—´æŒ‰é’®
          setStartTimeBtn.disabled = false
          setEndTimeBtn.disabled = false

          video.addEventListener('timeupdate', () => {
            timeSlider.value = video.currentTime
            currentTime.textContent = this.formatTime(video.currentTime)
          })

          // è®¾ç½®è‡ªå®šä¹‰è§†é¢‘æ§åˆ¶æ¡
          this.setupCustomVideoControls(video)
        }

        setupCustomVideoControls(video) {
          const videoControls = document.getElementById('videoControls')
          const playPauseBtn = document.getElementById('playPauseBtn')
          const videoProgress = document.getElementById('videoProgress')
          const videoCurrentTime = document.getElementById('videoCurrentTime')
          const videoDuration = document.getElementById('videoDuration')
          const muteBtn = document.getElementById('muteBtn')
          const volumeSlider = document.getElementById('volumeSlider')

          // æ˜¾ç¤ºè‡ªå®šä¹‰æ§åˆ¶æ¡
          videoControls.style.display = 'block'

          // è®¾ç½®è§†é¢‘æ—¶é•¿
          videoDuration.textContent = this.formatTime(video.duration)
          videoProgress.max = video.duration

          // æ’­æ”¾/æš‚åœæŒ‰é’®
          playPauseBtn.addEventListener('click', () => {
            if (video.paused) {
              video.play()
              playPauseBtn.querySelector('.play-icon').textContent = 'â¸ï¸'
            } else {
              video.pause()
              playPauseBtn.querySelector('.play-icon').textContent = 'â–¶ï¸'
            }
          })

          // è¿›åº¦æ¡æ§åˆ¶
          videoProgress.addEventListener('input', () => {
            video.currentTime = videoProgress.value
          })

          // è§†é¢‘æ—¶é—´æ›´æ–°
          video.addEventListener('timeupdate', () => {
            videoProgress.value = video.currentTime
            videoCurrentTime.textContent = this.formatTime(video.currentTime)
          })

          // éŸ³é‡æ§åˆ¶
          volumeSlider.addEventListener('input', () => {
            video.volume = volumeSlider.value / 100
            this.updateVolumeIcon(video.volume, muteBtn)
          })

          // é™éŸ³æŒ‰é’®
          muteBtn.addEventListener('click', () => {
            if (video.muted) {
              video.muted = false
              volumeSlider.value = video.volume * 100
            } else {
              video.muted = true
              volumeSlider.value = 0
            }
            this.updateVolumeIcon(video.muted ? 0 : video.volume, muteBtn)
          })

          // è§†é¢‘ç»“æŸæ—¶é‡ç½®æ’­æ”¾æŒ‰é’®
          video.addEventListener('ended', () => {
            playPauseBtn.querySelector('.play-icon').textContent = 'â–¶ï¸'
          })

          // é€æ˜åº¦æ§åˆ¶
          const opacitySlider = document.getElementById('opacitySlider')
          const cropperContainer = document.getElementById('cropperContainer')

          // è®¾ç½®åˆå§‹é€æ˜åº¦
          this.updateCropperOpacity(opacitySlider.value, cropperContainer)

          opacitySlider.addEventListener('input', () => {
            this.updateCropperOpacity(opacitySlider.value, cropperContainer)
          })
        }

        updateVolumeIcon(volume, muteBtn) {
          const volumeIcon = muteBtn.querySelector('.volume-icon')
          if (volume === 0) {
            volumeIcon.textContent = 'ğŸ”‡'
          } else if (volume < 0.5) {
            volumeIcon.textContent = 'ğŸ”‰'
          } else {
            volumeIcon.textContent = 'ğŸ”Š'
          }
        }

        updateCropperOpacity(value, cropperContainer) {
          // å°†æ»‘å—å€¼(0-100)è½¬æ¢ä¸ºé€æ˜åº¦(0-1)
          const opacity = value / 100
          cropperContainer.style.background = `rgba(0, 0, 0, ${opacity})`
        }

        initializeCropper(video) {
          // åˆ›å»ºcanvasæ¥æ•è·è§†é¢‘å¸§
          this.canvas = document.createElement('canvas')
          const ctx = this.canvas.getContext('2d')

          // è®¾ç½®canvaså°ºå¯¸ä¸ºè§†é¢‘å°ºå¯¸
          this.canvas.width = video.videoWidth
          this.canvas.height = video.videoHeight

          // æ•è·å½“å‰å¸§
          ctx.drawImage(video, 0, 0, video.videoWidth, video.videoHeight)

          // å°†canvasè½¬æ¢ä¸ºå›¾ç‰‡å¹¶æ˜¾ç¤ºåœ¨cropperä¸­
          const dataURL = this.canvas.toDataURL('image/jpeg', 0.8)
          this.cropperImage.src = dataURL

          // æ˜¾ç¤ºcropperå®¹å™¨
          document.getElementById('cropperContainer').style.display = 'block'

          // åˆå§‹åŒ–Cropper.js
          if (this.cropper) {
            this.cropper.destroy()
          }

          this.cropper = new Cropper(this.cropperImage, {
            aspectRatio: NaN, // å…è®¸è‡ªç”±è£å‰ª
            viewMode: 1,
            dragMode: 'move',
            autoCropArea: 0.5,
            restore: false,
            guides: true,
            center: true,
            highlight: false,
            cropBoxMovable: true,
            cropBoxResizable: true,
            toggleDragModeOnDblclick: false,
            zoomOnWheel: false,
            crop: (event) => {
              // æ›´æ–°è£å‰ªå‚æ•°è¾“å…¥æ¡†
              const data = event.detail
              document.getElementById('cropX').value = Math.round(data.x)
              document.getElementById('cropY').value = Math.round(data.y)
              document.getElementById('cropWidth').value = Math.round(
                data.width
              )
              document.getElementById('cropHeight').value = Math.round(
                data.height
              )
            },
          })
        }

        initializeCropperForImage(image) {
          // åˆå§‹åŒ–Cropper.js for image
          if (this.cropper) {
            this.cropper.destroy()
          }

          this.cropper = new Cropper(image, {
            aspectRatio: NaN, // å…è®¸è‡ªç”±è£å‰ª
            viewMode: 1,
            dragMode: 'move',
            autoCropArea: 0.8,
            restore: false,
            guides: true,
            center: true,
            highlight: false,
            cropBoxMovable: true,
            cropBoxResizable: true,
            toggleDragModeOnDblclick: false,
            zoomOnWheel: false, // ç¦ç”¨æ»šè½®ç¼©æ”¾
            crop: (event) => {
              // æ›´æ–°è£å‰ªå‚æ•°è¾“å…¥æ¡†
              const data = event.detail
              document.getElementById('cropX').value = Math.round(data.x)
              document.getElementById('cropY').value = Math.round(data.y)
              document.getElementById('cropWidth').value = Math.round(
                data.width
              )
              document.getElementById('cropHeight').value = Math.round(
                data.height
              )
            },
          })
        }

        toggleUIForFileType() {
          const timeControls = document.querySelector('.time-controls')
          const videoControls = document.getElementById('videoControls')
          const timeRangeGroup = document.getElementById('timeRangeGroup')
          const timeSliderGroup = document.getElementById('timeSliderGroup')
          const videoFormatOptions = document.querySelectorAll('.video-format')
          const imageFormatOptions = document.querySelectorAll('.image-format')
          const qualityGroup = document.getElementById('qualityGroup')
          const gifGroup = document.getElementById('gifGroup')

          if (this.isImageFile) {
            // å›¾ç‰‡æ¨¡å¼ï¼šéšè—æ—¶é—´æ§åˆ¶ï¼Œæ˜¾ç¤ºå›¾ç‰‡æ ¼å¼
            timeControls.style.display = 'none'
            videoControls.style.display = 'none'
            timeRangeGroup.style.display = 'none'
            timeSliderGroup.style.display = 'none'

            videoFormatOptions.forEach((option) => {
              option.style.display = 'none'
              option.classList.remove('selected')
            })

            imageFormatOptions.forEach((option) => {
              option.style.display = 'flex'
            })

            // é»˜è®¤é€‰æ‹©JPGæ ¼å¼
            imageFormatOptions[0].classList.add('selected')

            // éšè—è§†é¢‘ç›¸å…³è®¾ç½®
            qualityGroup.style.display = 'none'
            gifGroup.style.display = 'none'
          } else {
            // è§†é¢‘æ¨¡å¼ï¼šæ˜¾ç¤ºæ—¶é—´æ§åˆ¶ï¼Œæ˜¾ç¤ºè§†é¢‘æ ¼å¼
            timeControls.style.display = 'block'
            timeRangeGroup.style.display = 'block'
            timeSliderGroup.style.display = 'block'

            videoFormatOptions.forEach((option) => {
              option.style.display = 'flex'
            })

            imageFormatOptions.forEach((option) => {
              option.style.display = 'none'
              option.classList.remove('selected')
            })

            // é»˜è®¤é€‰æ‹©MP4æ ¼å¼
            videoFormatOptions[0].classList.add('selected')

            // æ˜¾ç¤ºè§†é¢‘ç›¸å…³è®¾ç½®
            qualityGroup.style.display = 'block'
          }
        }

        handleFormatSelect(e) {
          const formatOptions = document.querySelectorAll('.format-option')
          formatOptions.forEach((option) => option.classList.remove('selected'))
          e.currentTarget.classList.add('selected')

          const format = e.currentTarget.dataset.format
          const qualityGroup = document.getElementById('qualityGroup')
          const gifGroup = document.getElementById('gifGroup')

          if (format === 'gif') {
            qualityGroup.style.display = 'none'
            gifGroup.style.display = 'block'
          } else {
            qualityGroup.style.display = 'block'
            gifGroup.style.display = 'none'
          }
        }

        handleTimeSliderChange(e) {
          if (this.videoElement) {
            this.videoElement.currentTime = e.target.value
          }
        }

        setCurrentTimeAsStart() {
          if (this.videoElement && !this.isImageFile) {
            const currentTime = this.videoElement.currentTime
            document.getElementById('startTime').value = currentTime.toFixed(2)
            this.updateTimeRange()
          }
        }

        setCurrentTimeAsEnd() {
          if (this.videoElement && !this.isImageFile) {
            const currentTime = this.videoElement.currentTime
            document.getElementById('endTime').value = currentTime.toFixed(2)
            this.updateTimeRange()
          }
        }

        updateTimeRange() {
          const startTime = parseFloat(
            document.getElementById('startTime').value
          )
          const endTime = parseFloat(document.getElementById('endTime').value)

          if (startTime >= endTime) {
            document.getElementById('endTime').value = startTime + 1
          }
        }

        // All crop interaction methods removed - handled by Cropper.js

        updateCropFromInputs() {
          if (!this.cropper) return

          const x = parseInt(document.getElementById('cropX').value) || 0
          const y = parseInt(document.getElementById('cropY').value) || 0
          const width =
            parseInt(document.getElementById('cropWidth').value) || 100
          const height =
            parseInt(document.getElementById('cropHeight').value) || 100

          // æ›´æ–°Cropper.jsçš„è£å‰ªåŒºåŸŸ
          this.cropper.setData({
            x: x,
            y: y,
            width: width,
            height: height,
          })
        }

        async startCropping() {
          if (!this.videoFile) {
            alert('è¯·å…ˆä¸Šä¼ æ–‡ä»¶')
            return
          }

          // å¦‚æœæ˜¯å›¾ç‰‡æ–‡ä»¶ï¼Œä½¿ç”¨Canvasè¿›è¡Œè£å‰ª
          if (this.isImageFile) {
            this.cropImage()
            return
          }

          // è§†é¢‘æ–‡ä»¶éœ€è¦FFmpeg
          if (!this.ffmpeg) {
            alert('FFmpegæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åå†è¯•')
            return
          }

          const progressContainer = document.getElementById('progressContainer')
          const progressBar = document.getElementById('progressBar')
          const progressText = document.getElementById('progressText')
          const cropBtn = document.getElementById('cropBtn')

          progressContainer.style.display = 'block'
          cropBtn.disabled = true

          try {
            // è·å–å‚æ•°
            const startTime = parseFloat(
              document.getElementById('startTime').value
            )
            const endTime = parseFloat(document.getElementById('endTime').value)
            const cropX = parseInt(document.getElementById('cropX').value)
            const cropY = parseInt(document.getElementById('cropY').value)
            const cropWidth = parseInt(
              document.getElementById('cropWidth').value
            )
            const cropHeight = parseInt(
              document.getElementById('cropHeight').value
            )
            const selectedFormat = document.querySelector(
              '.format-option.selected'
            ).dataset.format

            // æ£€æŸ¥è§†é¢‘è£å‰ªå°ºå¯¸ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º
            const maxDimension = 2048 // è§†é¢‘æœ€å¤§å°ºå¯¸é™åˆ¶
            if (cropWidth > maxDimension || cropHeight > maxDimension) {
              alert(
                `è£å‰ªå°ºå¯¸è¿‡å¤§ (${cropWidth}x${cropHeight})ï¼Œæœ€å¤§æ”¯æŒ ${maxDimension}x${maxDimension}ã€‚è¯·è°ƒæ•´è£å‰ªåŒºåŸŸã€‚`
              )
              progressContainer.style.display = 'none'
              cropBtn.disabled = false
              return
            }

            // æ£€æŸ¥è§†é¢‘å¤„ç†çš„å†…å­˜ä½¿ç”¨é‡
            const estimatedMemoryMB =
              (cropWidth * cropHeight * 4) / (1024 * 1024)
            if (estimatedMemoryMB > 128) {
              // è§†é¢‘å¤„ç†å†…å­˜é™åˆ¶æ›´ä¸¥æ ¼
              const confirmed = confirm(
                `è§†é¢‘è£å‰ªå°ºå¯¸è¾ƒå¤§ (${cropWidth}x${cropHeight}, çº¦${Math.round(
                  estimatedMemoryMB
                )}MB)ï¼Œå¯èƒ½å¯¼è‡´å¤„ç†ç¼“æ…¢æˆ–å†…å­˜ä¸è¶³ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ`
              )
              if (!confirmed) {
                progressContainer.style.display = 'none'
                cropBtn.disabled = false
                return
              }
            }

            // å†™å…¥è¾“å…¥æ–‡ä»¶
            const inputName = 'input.' + this.videoFile.name.split('.').pop()
            await this.ffmpeg.FS(
              'writeFile',
              inputName,
              new Uint8Array(await this.videoFile.arrayBuffer())
            )

            let outputName, ffmpegArgs

            if (selectedFormat === 'gif') {
              const gifFps = document.getElementById('gifFps').value
              outputName = 'output.gif'
              ffmpegArgs = [
                '-i',
                inputName,
                '-ss',
                startTime.toString(),
                '-t',
                (endTime - startTime).toString(),
                '-vf',
                `crop=${cropWidth}:${cropHeight}:${cropX}:${cropY},fps=${gifFps},scale=${cropWidth}:-1:flags=lanczos`,
                '-y',
                outputName,
              ]
            } else {
              const quality = document.getElementById('quality').value
              const extension = selectedFormat === 'webm' ? 'webm' : 'mp4'
              outputName = `output.${extension}`

              if (selectedFormat === 'webm') {
                ffmpegArgs = [
                  '-i',
                  inputName,
                  '-ss',
                  startTime.toString(),
                  '-t',
                  (endTime - startTime).toString(),
                  '-vf',
                  `crop=${cropWidth}:${cropHeight}:${cropX}:${cropY}`,
                  '-c:v',
                  'libvpx-vp9',
                  '-crf',
                  quality,
                  '-y',
                  outputName,
                ]
              } else {
                ffmpegArgs = [
                  '-i',
                  inputName,
                  '-ss',
                  startTime.toString(),
                  '-t',
                  (endTime - startTime).toString(),
                  '-vf',
                  `crop=${cropWidth}:${cropHeight}:${cropX}:${cropY}`,
                  '-c:v',
                  'libx264',
                  '-crf',
                  quality,
                  '-y',
                  outputName,
                ]
              }
            }

            // è®¾ç½®è¿›åº¦å›è°ƒ
            this.ffmpeg.setProgress(({ ratio }) => {
              const percentage = Math.round(ratio * 100)
              progressBar.style.width = percentage + '%'
              progressText.textContent = `å¤„ç†ä¸­... ${percentage}%`
            })

            // æ‰§è¡ŒFFmpegå‘½ä»¤
            await this.ffmpeg.run(...ffmpegArgs)

            // è¯»å–è¾“å‡ºæ–‡ä»¶
            const data = this.ffmpeg.FS('readFile', outputName)
            const blob = new Blob([data.buffer], {
              type:
                selectedFormat === 'gif'
                  ? 'image/gif'
                  : `video/${selectedFormat}`,
            })

            // æ˜¾ç¤ºç»“æœ
            this.showResult(blob, selectedFormat)

            // æ¸…ç†æ–‡ä»¶
            this.ffmpeg.FS('unlink', inputName)
            this.ffmpeg.FS('unlink', outputName)
          } catch (error) {
            console.error('Cropping failed:', error)
            let errorMessage = 'è§†é¢‘è£å‰ªå¤±è´¥: ' + error.message
            if (
              error.message.includes('OOM') ||
              error.message.includes('abort')
            ) {
              errorMessage =
                'è§†é¢‘å¤„ç†æ—¶å†…å­˜ä¸è¶³ï¼Œè¯·å°è¯•ï¼š\n1. å‡å°è£å‰ªåŒºåŸŸå°ºå¯¸\n2. ç¼©çŸ­è§†é¢‘æ—¶é•¿\n3. é€‰æ‹©è¾ƒä½çš„è´¨é‡è®¾ç½®'
            }
            alert(errorMessage)
            // é‡ç½®å¤„ç†çŠ¶æ€
            this.resetProcessingState()
          } finally {
            progressContainer.style.display = 'none'
            cropBtn.disabled = false
          }
        }

        cropImage() {
          if (!this.cropper) {
            alert('è¯·å…ˆé€‰æ‹©è£å‰ªåŒºåŸŸ')
            return
          }

          const progressContainer = document.getElementById('progressContainer')
          const progressBar = document.getElementById('progressBar')
          const progressText = document.getElementById('progressText')
          const cropBtn = document.getElementById('cropBtn')

          progressContainer.style.display = 'block'
          progressBar.style.width = '50%'
          progressText.textContent = 'å¤„ç†ä¸­... 50%'
          cropBtn.disabled = true

          try {
            // è·å–é€‰ä¸­çš„æ ¼å¼
            const selectedFormat = document.querySelector(
              '.format-option.selected'
            ).dataset.format

            // è·å–è£å‰ªæ•°æ®
            const cropData = this.cropper.getData()
            const maxDimension = 4096 // æœ€å¤§å°ºå¯¸é™åˆ¶ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º

            // è®¡ç®—å®‰å…¨çš„è¾“å‡ºå°ºå¯¸
            let outputWidth = Math.round(cropData.width)
            let outputHeight = Math.round(cropData.height)

            // å¦‚æœå°ºå¯¸è¿‡å¤§ï¼ŒæŒ‰æ¯”ä¾‹ç¼©æ”¾
            if (outputWidth > maxDimension || outputHeight > maxDimension) {
              const ratio = Math.min(
                maxDimension / outputWidth,
                maxDimension / outputHeight
              )
              outputWidth = Math.round(outputWidth * ratio)
              outputHeight = Math.round(outputHeight * ratio)

              console.warn(
                `å›¾ç‰‡å°ºå¯¸è¿‡å¤§ï¼Œå·²è‡ªåŠ¨ç¼©æ”¾è‡³ ${outputWidth}x${outputHeight} ä»¥é˜²æ­¢å†…å­˜æº¢å‡º`
              )
            }

            // æ£€æŸ¥å†…å­˜ä½¿ç”¨é‡ï¼ˆç²—ç•¥ä¼°ç®—ï¼‰
            const estimatedMemoryMB =
              (outputWidth * outputHeight * 4) / (1024 * 1024)
            if (estimatedMemoryMB > 256) {
              // è¶…è¿‡256MBæ—¶è­¦å‘Š
              const confirmed = confirm(
                `è£å‰ªåçš„å›¾ç‰‡å°ºå¯¸è¾ƒå¤§ (${outputWidth}x${outputHeight}, çº¦${Math.round(
                  estimatedMemoryMB
                )}MB)ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜ä¸è¶³ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ`
              )
              if (!confirmed) {
                progressContainer.style.display = 'none'
                cropBtn.disabled = false
                return
              }
            }

            // ä½¿ç”¨Cropper.jsè·å–è£å‰ªåçš„canvasï¼Œè®¾ç½®æœ€å¤§å°ºå¯¸
            const canvas = this.cropper.getCroppedCanvas({
              width: outputWidth,
              height: outputHeight,
              imageSmoothingEnabled: true,
              imageSmoothingQuality: 'high',
            })

            progressBar.style.width = '80%'
            progressText.textContent = 'å¤„ç†ä¸­... 80%'

            // è½¬æ¢ä¸ºblob
            canvas.toBlob(
              (blob) => {
                progressBar.style.width = '100%'
                progressText.textContent = 'å¤„ç†å®Œæˆ!'

                // æ˜¾ç¤ºç»“æœ
                this.showResult(blob, selectedFormat)

                setTimeout(() => {
                  progressContainer.style.display = 'none'
                  cropBtn.disabled = false
                }, 500)
              },
              this.getMimeType(selectedFormat),
              0.9
            )
          } catch (error) {
            console.error('Image cropping failed:', error)
            let errorMessage = 'å›¾ç‰‡è£å‰ªå¤±è´¥: ' + error.message
            if (
              error.message.includes('OOM') ||
              error.message.includes('abort')
            ) {
              errorMessage =
                'å›¾ç‰‡å°ºå¯¸è¿‡å¤§å¯¼è‡´å†…å­˜ä¸è¶³ï¼Œè¯·å°è¯•è£å‰ªæ›´å°çš„åŒºåŸŸæˆ–ä½¿ç”¨æ›´å°çš„å›¾ç‰‡'
            }
            alert(errorMessage)
            // é‡ç½®å¤„ç†çŠ¶æ€
            this.resetProcessingState()
            progressContainer.style.display = 'none'
            cropBtn.disabled = false
          }
        }

        getMimeType(format) {
          switch (format) {
            case 'png':
              return 'image/png'
            case 'webp':
              return 'image/webp'
            case 'jpg':
            default:
              return 'image/jpeg'
          }
        }

        showResult(blob, format) {
          const resultContainer = document.getElementById('resultContainer')
          const resultVideo = document.getElementById('resultVideo')
          const downloadBtn = document.getElementById('downloadBtn')

          const url = URL.createObjectURL(blob)

          // åˆ¤æ–­æ˜¯å¦ä¸ºå›¾ç‰‡æ ¼å¼ï¼ˆåŒ…æ‹¬GIFå’Œå…¶ä»–å›¾ç‰‡æ ¼å¼ï¼‰
          const isImageFormat = ['gif', 'jpg', 'png', 'webp'].includes(format)

          if (isImageFormat) {
            // å¯¹äºå›¾ç‰‡æ ¼å¼ï¼Œåˆ›å»ºimgå…ƒç´ 
            const img = document.createElement('img')
            img.src = url
            img.className = 'result-video'
            img.style.width = '100%'
            img.style.borderRadius = 'var(--border-radius)'
            img.style.boxShadow = 'var(--shadow-large)'
            img.style.marginBottom = '16px'

            resultVideo.style.display = 'none'
            if (resultContainer.querySelector('img')) {
              resultContainer.removeChild(resultContainer.querySelector('img'))
            }
            resultContainer.insertBefore(img, downloadBtn)
          } else {
            // å¯¹äºè§†é¢‘æ ¼å¼
            resultVideo.src = url
            resultVideo.style.display = 'block'
            if (resultContainer.querySelector('img')) {
              resultContainer.removeChild(resultContainer.querySelector('img'))
            }
          }

          resultContainer.style.display = 'block'

          // è®¾ç½®ä¸‹è½½
          this.resultBlob = blob
          this.resultFormat = format
        }

        downloadResult() {
          if (!this.resultBlob) return

          const url = URL.createObjectURL(this.resultBlob)
          const a = document.createElement('a')
          a.href = url

          // æ ¹æ®æ–‡ä»¶ç±»å‹è®¾ç½®ä¸‹è½½æ–‡ä»¶å
          const isImageFormat = ['gif', 'jpg', 'png', 'webp'].includes(
            this.resultFormat
          )
          const fileName = isImageFormat
            ? `cropped_image.${this.resultFormat}`
            : `cropped_video.${this.resultFormat}`
          a.download = fileName

          document.body.appendChild(a)
          a.click()
          document.body.removeChild(a)
          URL.revokeObjectURL(url)
        }

        resetProcessingState() {
          // é‡ç½®è¿›åº¦æ¡
          const progressContainer = document.getElementById('progressContainer')
          const progressBar = document.getElementById('progressBar')
          const progressText = document.getElementById('progressText')

          if (progressContainer) {
            progressContainer.style.display = 'none'
          }
          if (progressBar) {
            progressBar.style.width = '0%'
          }
          if (progressText) {
            progressText.textContent = 'å‡†å¤‡å¤„ç†...'
          }

          // é‡æ–°å¯ç”¨è£å‰ªæŒ‰é’®
          const cropBtn = document.getElementById('cropBtn')
          if (cropBtn) {
            cropBtn.disabled = false
          }

          // æ¸…ç†å¯èƒ½çš„ä¸´æ—¶æ–‡ä»¶ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
          if (this.ffmpeg) {
            try {
              // å°è¯•æ¸…ç†å¯èƒ½æ®‹ç•™çš„ä¸´æ—¶æ–‡ä»¶
              const files = this.ffmpeg.FS('readdir', '/')
              files.forEach((file) => {
                if (file.startsWith('input_') || file.startsWith('output_')) {
                  try {
                    this.ffmpeg.FS('unlink', file)
                  } catch (e) {
                    // å¿½ç•¥æ–‡ä»¶ä¸å­˜åœ¨çš„é”™è¯¯
                  }
                }
              })
            } catch (e) {
              // å¿½ç•¥æ¸…ç†é”™è¯¯
            }
          }
        }

        reset() {
          // é‡ç½®æ–‡ä»¶ç›¸å…³å±æ€§
          this.videoFile = null
          this.isImageFile = false

          // é‡ç½®æ‰€æœ‰è¾“å…¥
          document.getElementById('startTime').value = 0
          document.getElementById('endTime').value = 10
          document.getElementById('cropX').value = 0
          document.getElementById('cropY').value = 0
          document.getElementById('cropWidth').value = 640
          document.getElementById('cropHeight').value = 360

          // é‡ç½®æ ¼å¼é€‰æ‹© - æ˜¾ç¤ºè§†é¢‘æ ¼å¼ï¼Œéšè—å›¾ç‰‡æ ¼å¼
          document.querySelectorAll('.format-option').forEach((option) => {
            option.classList.remove('selected')
          })

          // æ˜¾ç¤ºè§†é¢‘æ ¼å¼é€‰é¡¹
          document.querySelectorAll('.video-format').forEach((option) => {
            option.style.display = 'flex'
          })

          // éšè—å›¾ç‰‡æ ¼å¼é€‰é¡¹
          document.querySelectorAll('.image-format').forEach((option) => {
            option.style.display = 'none'
          })

          // é»˜è®¤é€‰æ‹©MP4
          document
            .querySelector('.format-option[data-format="mp4"]')
            .classList.add('selected')

          // æ˜¾ç¤ºæ—¶é—´æ§åˆ¶ï¼ˆæ¢å¤è§†é¢‘æ¨¡å¼UIï¼‰
          const timeControls = document.querySelector('.time-controls')
          if (timeControls) {
            timeControls.style.display = 'block'
          }

          // éšè—è§†é¢‘é¢„è§ˆå’Œæ§åˆ¶æ¡
          document.getElementById('videoPreview').style.display = 'none'
          document.getElementById('videoControls').style.display = 'none'
          document.getElementById('cropperContainer').style.display = 'none'

          // éšè—ç»“æœ
          document.getElementById('resultContainer').style.display = 'none'
          document.getElementById('progressContainer').style.display = 'none'

          // æ¸…ç†è§†é¢‘å…ƒç´ 
          if (this.videoElement) {
            this.videoElement.src = ''
            this.videoElement = null
          }

          // æ¸…ç†Cropperå®ä¾‹
          if (this.cropper) {
            this.cropper.destroy()
            this.cropper = null
          }

          // é‡ç½®æŒ‰é’®çŠ¶æ€
          document.getElementById('cropBtn').disabled = true

          // é‡ç½®é€æ˜åº¦æ»‘å—
          const opacitySlider = document.getElementById('opacitySlider')
          if (opacitySlider) {
            opacitySlider.value = 30
          }

          // é‡ç½®æ–‡ä»¶è¾“å…¥
          const videoInput = document.getElementById('videoInput')
          if (videoInput) {
            videoInput.value = ''
          }
        }

        formatTime(seconds) {
          const mins = Math.floor(seconds / 60)
          const secs = Math.floor(seconds % 60)
          return `${mins.toString().padStart(2, '0')}:${secs
            .toString()
            .padStart(2, '0')}`
        }

        // å¼¹æ¡†ç›¸å…³æ–¹æ³•
        // Modal functionality removed - using Cropper.js directly

        // setupModalCropSelection removed - using Cropper.js directly

        // All modal drag/resize methods removed - using Cropper.js directly
      }

      // åˆå§‹åŒ–åº”ç”¨
      document.addEventListener('DOMContentLoaded', () => {
        new VideoCropper()
      })
    </script>
  </body>
</html>

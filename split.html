<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è§†é¢‘éŸ³é¢‘åˆ†ç¦»å·¥å…·</title>
    <script src="./ffmpeg.min.js"></script>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: 'SF Pro Display', 'PingFang SC', 'Helvetica Neue', Arial,
          sans-serif;
      }

      :root {
        --primary-bg: #e6e7ee;
        --secondary-bg: #ffffff;
        --shadow-light: #ffffff;
        --shadow-dark: #d1d9e6;
        --accent-color: #667eea;
        --accent-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-color: #4ecdc4;
        --danger-color: #ff6b6b;
        --warning-color: #feca57;
        --text-primary: #2d3748;
        --text-secondary: #718096;
        --glass-bg: rgba(255, 255, 255, 0.25);
        --glass-border: rgba(255, 255, 255, 0.18);
      }

      body {
        background: var(--primary-bg);
        color: var(--text-primary);
        min-height: 100vh;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: all 0.3s ease;
        animation: pageLoad 0.8s ease;
      }

      @keyframes pageLoad {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .container {
        width: 100%;
        max-width: 1200px;
        background: var(--primary-bg);
        border-radius: 30px;
        padding: 40px;
        box-shadow: 20px 20px 60px var(--shadow-dark),
          -20px -20px 60px var(--shadow-light);
        margin-top: 20px;
        transition: all 0.3s ease;
        animation: containerFloat 1s ease 0.2s both;
      }

      @keyframes containerFloat {
        from {
          opacity: 0;
          transform: translateY(30px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .container:hover {
        box-shadow: 25px 25px 70px var(--shadow-dark),
          -25px -25px 70px var(--shadow-light);
      }

      header {
        text-align: center;
        margin-bottom: 40px;
        padding: 30px;
        background: var(--primary-bg);
        border-radius: 25px;
        box-shadow: 10px 10px 20px var(--shadow-dark),
          -10px -10px 20px var(--shadow-light);
        animation: headerSlide 0.8s ease 0.4s both;
      }

      @keyframes headerSlide {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h1 {
        font-size: 3.2rem;
        margin-bottom: 15px;
        background: var(--accent-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 700;
        animation: titleGlow 3s ease-in-out infinite alternate;
      }

      @keyframes titleGlow {
        from {
          filter: brightness(1);
        }
        to {
          filter: brightness(1.2);
        }
      }

      .subtitle {
        font-size: 1.3rem;
        color: var(--text-secondary);
        margin-bottom: 30px;
        font-weight: 500;
      }

      .panels {
        display: flex;
        gap: 30px;
        margin-bottom: 40px;
        animation: panelsSlide 0.8s ease 0.6s both;
      }

      @keyframes panelsSlide {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .panel {
        flex: 1;
        background: var(--primary-bg);
        border-radius: 25px;
        padding: 30px;
        box-shadow: 12px 12px 24px var(--shadow-dark),
          -12px -12px 24px var(--shadow-light);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .panel::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transition: left 0.8s;
      }

      .panel:hover::before {
        left: 100%;
      }

      .panel:hover {
        transform: translateY(-5px);
        box-shadow: 16px 16px 32px var(--shadow-dark),
          -16px -16px 32px var(--shadow-light);
      }

      .panel-title {
        font-size: 1.6rem;
        margin-bottom: 25px;
        color: var(--accent-color);
        display: flex;
        align-items: center;
        font-weight: 600;
      }

      .panel-title::before {
        content: attr(data-icon);
        margin-right: 12px;
        font-size: 1.8rem;
        animation: iconBounce 2s ease-in-out infinite;
      }

      @keyframes iconBounce {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      .file-upload {
        border: 3px dashed var(--accent-color);
        border-radius: 25px;
        padding: 50px 40px;
        text-align: center;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        margin-bottom: 25px;
        cursor: pointer;
        background: var(--primary-bg);
        box-shadow: inset 8px 8px 16px var(--shadow-dark),
          inset -8px -8px 16px var(--shadow-light);
        position: relative;
        overflow: hidden;
      }

      .file-upload:hover {
        border-color: var(--success-color);
        transform: translateY(-5px) scale(1.02);
        box-shadow: inset 10px 10px 20px var(--shadow-dark),
          inset -10px -10px 20px var(--shadow-light),
          0 15px 40px rgba(102, 126, 234, 0.25),
          0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .file-upload.dragover {
        border-color: var(--success-color);
        background: rgba(78, 205, 196, 0.05);
        transform: scale(1.05);
        box-shadow: inset 12px 12px 24px var(--shadow-dark),
          inset -12px -12px 24px var(--shadow-light),
          0 20px 50px rgba(78, 205, 196, 0.3);
        animation: dragPulse 1s ease-in-out infinite;
      }

      @keyframes dragPulse {
        0%, 100% {
          border-color: var(--success-color);
        }
        50% {
          border-color: var(--accent-color);
        }
      }

      .file-upload-content {
        position: relative;
        z-index: 1;
      }

      .file-upload-icon {
        font-size: 3.5rem;
        margin-bottom: 20px;
        display: block;
        animation: iconFloat 3s ease-in-out infinite;
        filter: drop-shadow(0 4px 8px rgba(102, 126, 234, 0.2));
      }

      @keyframes iconFloat {
        0%, 100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .file-upload-text {
        font-size: 1.4rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 10px;
        background: var(--accent-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .file-upload-subtext {
        font-size: 1.1rem;
        color: var(--text-secondary);
        margin-bottom: 20px;
        font-weight: 500;
      }

      .file-upload-formats {
        font-size: 0.9rem;
        color: var(--accent-color);
        font-weight: 500;
        padding: 8px 16px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 20px;
        display: inline-block;
        margin-bottom: 20px;
      }

      .file-upload input[type='file'] {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        opacity: 0;
        cursor: pointer;
        z-index: 2;
      }

      .video-preview {
        width: 100%;
        background: var(--primary-bg);
        border-radius: 20px;
        overflow: hidden;
        margin-top: 20px;
        box-shadow: inset 10px 10px 20px var(--shadow-dark),
          inset -10px -10px 20px var(--shadow-light);
        transition: all 0.3s ease;
      }

      .video-preview:hover {
        box-shadow: inset 12px 12px 24px var(--shadow-dark),
          inset -12px -12px 24px var(--shadow-light);
      }

      video {
        width: 100%;
        max-height: 300px;
        display: block;
        border-radius: 15px;
      }

      .options-form {
        display: flex;
        gap: 20px;
        margin-bottom: 25px;
        flex-wrap: wrap;
        align-items: flex-end;
      }

      .form-group {
        flex: 1;
        min-width: 150px;
      }

      label {
        display: block;
        margin-bottom: 10px;
        color: var(--text-secondary);
        font-weight: 500;
        font-size: 0.95rem;
      }

      input, select {
        width: 100%;
        padding: 14px 18px;
        background: var(--primary-bg);
        border: none;
        border-radius: 15px;
        color: var(--text-primary);
        font-size: 1rem;
        font-weight: 500;
        box-shadow: inset 6px 6px 12px var(--shadow-dark),
          inset -6px -6px 12px var(--shadow-light);
        transition: all 0.3s ease;
      }

      input:focus, select:focus {
        outline: none;
        box-shadow: inset 8px 8px 16px var(--shadow-dark),
          inset -8px -8px 16px var(--shadow-light),
          0 0 0 3px rgba(102, 126, 234, 0.2);
      }

      button {
        background: var(--primary-bg);
        color: var(--text-primary);
        border: none;
        padding: 14px 28px;
        border-radius: 15px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        font-size: 1rem;
        flex-shrink: 0;
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light);
        position: relative;
        overflow: hidden;
      }

      button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      button:hover::before {
        left: 100%;
      }

      button:hover {
        transform: translateY(-3px);
        box-shadow: 12px 12px 24px var(--shadow-dark),
          -12px -12px 24px var(--shadow-light);
      }

      button:active {
        transform: translateY(0);
        box-shadow: inset 6px 6px 12px var(--shadow-dark),
          inset -6px -6px 12px var(--shadow-light);
      }

      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
        box-shadow: 4px 4px 8px var(--shadow-dark),
          -4px -4px 8px var(--shadow-light);
      }

      .btn-primary {
        background: var(--accent-gradient);
        color: white;
        padding: 16px 32px;
        font-size: 1.1rem;
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light),
          inset 0 1px 0 rgba(255, 255, 255, 0.2);
      }

      .btn-primary:hover {
        box-shadow: 12px 12px 24px var(--shadow-dark),
          -12px -12px 24px var(--shadow-light),
          inset 0 1px 0 rgba(255, 255, 255, 0.2),
          0 0 30px rgba(102, 126, 234, 0.3);
      }

      .btn-success {
        background: linear-gradient(
          135deg,
          var(--success-color) 0%,
          #44a08d 100%
        );
        color: white;
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light),
          inset 0 1px 0 rgba(255, 255, 255, 0.2);
      }

      .progress-container {
        margin: 30px 0;
        animation: progressSlide 0.8s ease 0.8s both;
      }

      @keyframes progressSlide {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .progress-bar {
        height: 16px;
        background: var(--primary-bg);
        border-radius: 20px;
        overflow: hidden;
        margin-bottom: 15px;
        box-shadow: inset 6px 6px 12px var(--shadow-dark),
          inset -6px -6px 12px var(--shadow-light);
        position: relative;
      }

      .progress-fill {
        height: 100%;
        background: var(--accent-gradient);
        width: 0%;
        transition: width 0.3s ease;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        position: relative;
        overflow: hidden;
      }

      .progress-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: progressShine 2s infinite;
      }

      @keyframes progressShine {
        0% {
          left: -100%;
        }
        100% {
          left: 100%;
        }
      }

      .progress-text {
        text-align: center;
        font-size: 1rem;
        color: var(--text-secondary);
        font-weight: 500;
      }

      .actions {
        display: flex;
        justify-content: center;
        gap: 25px;
        margin-top: 30px;
        animation: actionsSlide 0.8s ease 1s both;
      }

      @keyframes actionsSlide {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .result-panel {
        text-align: center;
        animation: resultPanelSlide 0.8s ease 1.2s both;
      }

      @keyframes resultPanelSlide {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .status-message {
        min-height: 35px;
        margin: 20px 0;
        color: var(--accent-color);
        font-weight: 600;
        font-size: 1.1rem;
        transition: all 0.3s ease;
      }

      .status-message.processing {
        animation: statusPulse 1.5s ease-in-out infinite;
      }

      @keyframes statusPulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.6;
        }
      }

      .error-message {
        color: var(--danger-color);
        margin: 20px 0;
        min-height: 35px;
        font-weight: 600;
        font-size: 1.1rem;
        animation: errorShake 0.5s ease;
      }

      @keyframes errorShake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }

      .download-section {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-top: 30px;
        padding: 25px;
        background: var(--primary-bg);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-large);
        border: 2px solid var(--accent-color);
      }

      .download-segments {
        display: flex;
        flex-direction: column;
        gap: 25px;
      }

      .download-segment {
        background: var(--secondary-bg);
        border-radius: var(--border-radius);
        padding: 20px;
        box-shadow: var(--shadow-medium);
        border: 1px solid rgba(102, 126, 234, 0.2);
        transition: all 0.3s ease;
      }

      .download-segment:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-large);
        border-color: var(--accent-color);
      }

      .segment-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(102, 126, 234, 0.2);
      }

      .segment-header h4 {
        margin: 0;
        color: var(--text-primary);
        font-size: 1.1rem;
        font-weight: 600;
      }

      .segment-time {
        color: var(--text-secondary);
        font-size: 0.9rem;
        font-weight: 500;
        background: rgba(102, 126, 234, 0.1);
        padding: 4px 12px;
        border-radius: 15px;
        border: 1px solid rgba(102, 126, 234, 0.2);
      }

      .download-items {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
      }

      .download-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px;
        background: var(--primary-bg);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-small);
        transition: all 0.3s ease;
        border: 1px solid rgba(102, 126, 234, 0.1);
        flex: 1;
        min-width: 280px;
      }

      .download-item:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-medium);
        border-color: var(--accent-color);
      }

      .download-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .download-size {
        font-size: 0.9rem;
        color: var(--text-secondary);
        font-weight: 500;
        padding: 6px 12px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 15px;
        border: 1px solid rgba(102, 126, 234, 0.2);
        margin: 0 10px;
      }

      .instructions {
        background: var(--primary-bg);
        border-radius: 25px;
        padding: 30px;
        margin-top: 40px;
        box-shadow: 10px 10px 20px var(--shadow-dark),
          -10px -10px 20px var(--shadow-light);
        animation: instructionsSlide 0.8s ease 1.4s both;
      }

      @keyframes instructionsSlide {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .instructions h3 {
        color: var(--accent-color);
        margin-bottom: 20px;
        font-size: 1.4rem;
        font-weight: 600;
      }

      .instructions ol {
        padding-left: 25px;
        margin-bottom: 20px;
      }

      .instructions li {
        margin-bottom: 12px;
        line-height: 1.7;
        color: var(--text-secondary);
        font-weight: 500;
      }

      .instructions p {
        color: var(--text-secondary);
        font-style: italic;
        font-weight: 500;
        padding: 15px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 15px;
        border-left: 4px solid var(--accent-color);
      }

      footer {
        margin-top: 40px;
        text-align: center;
        color: var(--text-secondary);
        font-size: 0.95rem;
        padding: 25px;
        background: var(--primary-bg);
        border-radius: 20px;
        box-shadow: 6px 6px 12px var(--shadow-dark),
          -6px -6px 12px var(--shadow-light);
        animation: footerFade 0.8s ease 1.6s both;
      }

      @keyframes footerFade {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      /* æ—¶é—´æ®µç®¡ç†æ ·å¼ */
      .time-segments-section {
        margin-bottom: 25px;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid rgba(102, 126, 234, 0.1);
      }

      .section-header h4 {
        color: var(--accent-color);
        font-size: 1.3rem;
        font-weight: 600;
        margin: 0;
      }

      .current-time-display {
        background: var(--primary-bg);
        padding: 8px 16px;
        border-radius: 12px;
        font-size: 0.9rem;
        color: var(--text-secondary);
        font-weight: 500;
        box-shadow: inset 4px 4px 8px var(--shadow-dark),
          inset -4px -4px 8px var(--shadow-light);
      }

      .time-input-form {
        background: var(--primary-bg);
        border-radius: 20px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: inset 8px 8px 16px var(--shadow-dark),
          inset -8px -8px 16px var(--shadow-light);
      }

      .input-with-button {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .input-with-button input {
        flex: 1;
      }

      .get-time-btn {
        background: var(--accent-gradient);
        color: white;
        border: none;
        padding: 12px 16px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 1.2rem;
        transition: all 0.3s ease;
        box-shadow: 6px 6px 12px var(--shadow-dark),
          -6px -6px 12px var(--shadow-light);
        flex-shrink: 0;
      }

      .get-time-btn:hover {
        transform: translateY(-2px);
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light);
      }

      .get-time-btn:active {
        transform: translateY(0);
        box-shadow: inset 4px 4px 8px var(--shadow-dark),
          inset -4px -4px 8px var(--shadow-light);
      }

      .add-segment-btn {
        background: var(--success-color);
        color: white;
        border: none;
        padding: 14px 24px;
        border-radius: 15px;
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
        margin-top: 15px;
        width: 100%;
        transition: all 0.3s ease;
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light);
      }

      .add-segment-btn:hover {
        transform: translateY(-3px);
        box-shadow: 12px 12px 24px var(--shadow-dark),
          -12px -12px 24px var(--shadow-light);
      }

      .segments-list {
        background: var(--primary-bg);
        border-radius: 20px;
        padding: 20px;
        box-shadow: inset 6px 6px 12px var(--shadow-dark),
          inset -6px -6px 12px var(--shadow-light);
      }

      .segments-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(102, 126, 234, 0.1);
      }

      .segments-header span:first-child {
        color: var(--accent-color);
        font-weight: 600;
        font-size: 1.1rem;
      }

      .segments-count {
        background: rgba(102, 126, 234, 0.1);
        color: var(--accent-color);
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: 500;
      }

      .segments-container {
        max-height: 300px;
        overflow-y: auto;
      }

      .empty-segments {
        text-align: center;
        padding: 40px 20px;
        color: var(--text-secondary);
        font-style: italic;
      }

      .segment-item {
        background: var(--primary-bg);
        border-radius: 15px;
        padding: 15px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 6px 6px 12px var(--shadow-dark),
          -6px -6px 12px var(--shadow-light);
        transition: all 0.3s ease;
        animation: segmentSlideIn 0.3s ease;
      }

      @keyframes segmentSlideIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .segment-item:hover {
        transform: translateY(-2px);
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light);
      }

      .segment-info {
        flex: 1;
      }

      .segment-time {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 1rem;
        margin-bottom: 5px;
      }

      .segment-duration {
        font-size: 0.85rem;
        color: var(--text-secondary);
      }

      .segment-actions {
        display: flex;
        gap: 8px;
      }

      .segment-delete-btn {
        background: var(--danger-color);
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        box-shadow: 4px 4px 8px var(--shadow-dark),
          -4px -4px 8px var(--shadow-light);
      }

      .segment-delete-btn:hover {
        transform: translateY(-2px);
        box-shadow: 6px 6px 12px var(--shadow-dark),
          -6px -6px 12px var(--shadow-light);
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 1024px) {
        .container {
          padding: 30px;
          margin: 10px;
        }

        .panels {
          flex-direction: column;
        }

        h1 {
          font-size: 2.5rem;
        }

        .subtitle {
          font-size: 1.1rem;
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 20px;
        }

        .options-form {
          flex-direction: column;
        }

        .actions {
          flex-direction: column;
          align-items: center;
        }

        .download-section {
          flex-direction: column;
          align-items: center;
        }

        h1 {
          font-size: 2rem;
        }

        .file-upload {
          padding: 30px 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ğŸµ è§†é¢‘éŸ³é¢‘åˆ†ç¦»å·¥å…·</h1>
        <p class="subtitle">åŸºäº FFmpeg çš„é«˜è´¨é‡éŸ³è§†é¢‘åˆ†ç¦»å¤„ç†</p>
      </header>

      <div class="panels">
        <!-- ä¸Šä¼ é¢æ¿ -->
        <div class="panel">
          <div class="panel-title" data-icon="ğŸ“">æ–‡ä»¶ä¸Šä¼ </div>
          <div class="file-upload" id="uploadArea">
            <div class="file-upload-content">
              <span class="file-upload-icon">ğŸ¬</span>
              <div class="file-upload-text">æ‹–æ‹½è§†é¢‘æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </div>
              <div class="file-upload-subtext">æ”¯æŒæ‰€æœ‰ä¸»æµè§†é¢‘æ ¼å¼</div>
              <div class="file-upload-formats">
                MP4, AVI, MOV, MKV, WMV, FLV, WebM, M4V, 3GP, TS, MTS
              </div>
              <input type="file" id="videoInput" accept="video/*" />
            </div>
          </div>

          <div class="video-preview" id="originalPreview">
            <p style="text-align: center; padding: 60px 20px; color: var(--text-secondary); font-size: 1.1rem;">
              ğŸ“º è§†é¢‘é¢„è§ˆåŒº
            </p>
          </div>
        </div>

        <!-- è®¾ç½®é¢æ¿ -->
        <div class="panel">
          <div class="panel-title" data-icon="âš™ï¸">åˆ†ç¦»è®¾ç½®</div>
          
          <!-- æ—¶é—´æ®µç®¡ç† -->
          <div class="time-segments-section">
            <div class="section-header">
              <h4>ğŸ¯ æ—¶é—´æ®µè®¾ç½®</h4>
              <div class="current-time-display" id="currentTimeDisplay">å½“å‰æ—¶é—´: 00:00</div>
            </div>
            
            <div class="time-input-form">
              <div class="form-group">
                <label for="newStartTime">å¼€å§‹æ—¶é—´ (ç§’)</label>
                <div class="input-with-button">
                  <input type="number" id="newStartTime" value="0" min="0" step="0.1" placeholder="0" />
                  <button type="button" class="get-time-btn" id="getStartTimeBtn" title="è·å–å½“å‰æ’­æ”¾æ—¶é—´">ğŸ“</button>
                </div>
              </div>
              <div class="form-group">
                <label for="newEndTime">ç»“æŸæ—¶é—´ (ç§’)</label>
                <div class="input-with-button">
                  <input type="number" id="newEndTime" value="" min="0" step="0.1" placeholder="ç»“æŸæ—¶é—´" />
                  <button type="button" class="get-time-btn" id="getEndTimeBtn" title="è·å–å½“å‰æ’­æ”¾æ—¶é—´">ğŸ“</button>
                </div>
              </div>
              <button type="button" class="add-segment-btn" id="addSegmentBtn">â• æ·»åŠ æ—¶é—´æ®µ</button>
            </div>
            
            <div class="segments-list" id="segmentsList">
              <div class="segments-header">
                <span>ğŸ“‹ æ—¶é—´æ®µåˆ—è¡¨</span>
                <span class="segments-count" id="segmentsCount">0 ä¸ªç‰‡æ®µ</span>
              </div>
              <div class="segments-container" id="segmentsContainer">
                <div class="empty-segments">
                  <p>ğŸ¬ æš‚æ— æ—¶é—´æ®µï¼Œè¯·æ·»åŠ è¦åˆ†ç¦»çš„æ—¶é—´æ®µ</p>
                </div>
              </div>
            </div>
          </div>

          <div class="options-form">
            <div class="form-group">
              <label for="videoFormat">è§†é¢‘æ ¼å¼</label>
              <select id="videoFormat">
                <option value="mp4">MP4 (æ¨è)</option>
                <option value="avi">AVI</option>
                <option value="mov">MOV</option>
                <option value="mkv">MKV</option>
                <option value="webm">WebM</option>
                <option value="flv">FLV</option>
                <option value="wmv">WMV</option>
                <option value="m4v">M4V</option>
                <option value="3gp">3GP</option>
                <option value="ts">TS</option>
              </select>
            </div>
            <div class="form-group">
              <label for="audioFormat">éŸ³é¢‘æ ¼å¼</label>
              <select id="audioFormat">
                <option value="mp3">MP3 (æ¨è)</option>
                <option value="wav">WAV</option>
                <option value="aac">AAC</option>
                <option value="flac">FLAC</option>
                <option value="ogg">OGG</option>
                <option value="m4a">M4A</option>
                <option value="wma">WMA</option>
              </select>
            </div>
          </div>

          <div class="options-form">
            <div class="form-group">
              <label for="videoQuality">è§†é¢‘è´¨é‡</label>
              <select id="videoQuality">
                <option value="original">åŸå§‹è´¨é‡</option>
                <option value="high">é«˜è´¨é‡ (CRF 18)</option>
                <option value="medium">ä¸­ç­‰è´¨é‡ (CRF 23)</option>
                <option value="low">ä½è´¨é‡ (CRF 28)</option>
              </select>
            </div>
            <div class="form-group">
              <label for="audioBitrate">éŸ³é¢‘æ¯”ç‰¹ç‡</label>
              <select id="audioBitrate">
                <option value="320">320 kbps (é«˜è´¨é‡)</option>
                <option value="256">256 kbps</option>
                <option value="192">192 kbps (æ¨è)</option>
                <option value="128">128 kbps</option>
                <option value="96">96 kbps</option>
              </select>
            </div>
          </div>

          <div class="actions">
            <button class="btn-primary" id="processBtn" disabled>
              ğŸš€ å¼€å§‹åˆ†ç¦»
            </button>
            <button id="resetBtn">ğŸ”„ é‡ç½®</button>
          </div>
        </div>
      </div>

      <!-- è¿›åº¦æ˜¾ç¤º -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">ğŸš€ å‡†å¤‡å°±ç»ª</div>
      </div>

      <!-- çŠ¶æ€ä¿¡æ¯ -->
      <div class="status-message" id="statusMessage"></div>
      <div class="error-message" id="errorMessage"></div>

      <!-- ä¸‹è½½åŒºåŸŸ -->
      <div class="download-section" id="downloadSection" style="display: none;">
        <div class="download-segments" id="downloadSegments">
          <!-- åŠ¨æ€ç”Ÿæˆçš„ç‰‡æ®µä¸‹è½½é¡¹ -->
        </div>
      </div>

      <!-- ä½¿ç”¨è¯´æ˜ -->
      <div class="instructions">
        <h3>ğŸ“– ä½¿ç”¨è¯´æ˜</h3>
        <ol>
          <li>é€‰æ‹©æˆ–æ‹–æ‹½è§†é¢‘æ–‡ä»¶åˆ°ä¸Šä¼ åŒºåŸŸ</li>
          <li>è®¾ç½®åˆ†ç¦»å‚æ•°ï¼ˆæ—¶é—´èŒƒå›´ã€æ ¼å¼ã€è´¨é‡ç­‰ï¼‰</li>
          <li>ç‚¹å‡»"å¼€å§‹åˆ†ç¦»"æŒ‰é’®è¿›è¡Œå¤„ç†</li>
          <li>å¤„ç†å®Œæˆåå¯åˆ†åˆ«ä¸‹è½½è§†é¢‘å’ŒéŸ³é¢‘æ–‡ä»¶</li>
        </ol>
        <p>
          ğŸ’¡ æç¤ºï¼šæ”¯æŒæŒ‡å®šæ—¶é—´èŒƒå›´åˆ†ç¦»ï¼Œç•™ç©ºç»“æŸæ—¶é—´å°†å¤„ç†å®Œæ•´è§†é¢‘ã€‚æ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼å’Œè´¨é‡é€‰é¡¹ã€‚
        </p>
      </div>

      <footer>
        <p>ğŸ”§ åŸºäº FFmpeg.wasm æŠ€æœ¯ | ğŸŒ å®Œå…¨åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œä¿æŠ¤æ‚¨çš„éšç§</p>
      </footer>
    </div>

    <script>
      let ffmpeg = null;
      let inputFile = null;
      let videoUrl = null;
      let videoBlob = null;
      let audioBlob = null;

      // æ—¶é—´æ®µç®¡ç†
      let timeSegments = [];
      let currentVideo = null;

      // DOM å…ƒç´ 
      const uploadArea = document.getElementById('uploadArea');
      const videoInput = document.getElementById('videoInput');
      const originalPreview = document.getElementById('originalPreview');
      const startTimeInput = document.getElementById('newStartTime');
      const endTimeInput = document.getElementById('newEndTime');
      const getStartTimeBtn = document.getElementById('getStartTimeBtn');
      const getEndTimeBtn = document.getElementById('getEndTimeBtn');
      const addSegmentBtn = document.getElementById('addSegmentBtn');
      const segmentsList = document.getElementById('segmentsList');
      const segmentsCount = document.getElementById('segmentsCount');
      const currentTimeDisplay = document.getElementById('currentTimeDisplay');
      const videoFormatSelect = document.getElementById('videoFormat');
      const audioFormatSelect = document.getElementById('audioFormat');
      const videoQualitySelect = document.getElementById('videoQuality');
      const audioBitrateSelect = document.getElementById('audioBitrate');
      const processBtn = document.getElementById('processBtn');
      const resetBtn = document.getElementById('resetBtn');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      const statusMessage = document.getElementById('statusMessage');
      const errorMessage = document.getElementById('errorMessage');
      const downloadSection = document.getElementById('downloadSection');
      const downloadSegments = document.getElementById('downloadSegments');

      // åˆå§‹åŒ–äº‹ä»¶
      function initEvents() {
        // æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
        videoInput.addEventListener('change', handleFileUpload);
        uploadArea.addEventListener('click', (e) => {
          // åªæœ‰åœ¨æ²¡æœ‰æ–‡ä»¶æ—¶æ‰è§¦å‘æ–‡ä»¶é€‰æ‹©
          if (!inputFile && e.target === uploadArea) {
            videoInput.click();
          }
        });

        // æ‹–æ‹½äº‹ä»¶
        uploadArea.addEventListener('dragover', (e) => {
          e.preventDefault();
          uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', (e) => {
          e.preventDefault();
          uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
          e.preventDefault();
          uploadArea.classList.remove('dragover');

          if (e.dataTransfer.files.length) {
            videoInput.files = e.dataTransfer.files;
            handleFileUpload({ target: { files: e.dataTransfer.files } });
          }
        });

        // æŒ‰é’®äº‹ä»¶
        processBtn.addEventListener('click', processVideo);
        resetBtn.addEventListener('click', resetAll);
        
        // æ—¶é—´æ®µç®¡ç†äº‹ä»¶
        getStartTimeBtn.addEventListener('click', () => getCurrentTime('start'));
        getEndTimeBtn.addEventListener('click', () => getCurrentTime('end'));
        addSegmentBtn.addEventListener('click', addTimeSegment);
      }

      // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
      function handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        // æ£€æŸ¥æ–‡ä»¶ç±»å‹
        if (!file.type.match('video.*')) {
          showError('âŒ è¯·ä¸Šä¼ è§†é¢‘æ–‡ä»¶', errorMessage);
          return;
        }

        inputFile = file;
        videoUrl = URL.createObjectURL(file);

        // æ˜¾ç¤ºè§†é¢‘é¢„è§ˆ
        originalPreview.innerHTML = `
          <video controls style="border-radius: 15px;">
            <source src="${videoUrl}" type="${file.type}">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘é¢„è§ˆ
          </video>
          <p style="text-align: center; padding: 15px 0; color: var(--text-secondary); font-weight: 500;">
            ğŸ“ ${file.name} (${formatFileSize(file.size)})
          </p>
        `;

        // è·å–è§†é¢‘å…ƒç´ å¼•ç”¨
        currentVideo = originalPreview.querySelector('video');
        
        // è·å–è§†é¢‘æ—¶é•¿å¹¶è®¾ç½®é»˜è®¤ç»“æŸæ—¶é—´
        currentVideo.addEventListener('loadedmetadata', () => {
          if (!endTimeInput.value) {
            endTimeInput.value = Math.floor(currentVideo.duration);
          }
        });
        
        // ç›‘å¬æ—¶é—´æ›´æ–°
        currentVideo.addEventListener('timeupdate', updateCurrentTime);

        // å¯ç”¨å¤„ç†æŒ‰é’®
        processBtn.disabled = false;
        downloadSection.style.display = 'none';
        statusMessage.textContent = 'âœ¨ è¯·è®¾ç½®åˆ†ç¦»å‚æ•°å¹¶å¼€å§‹å¤„ç†';
      }

      // æ—¶é—´æ®µç®¡ç†åŠŸèƒ½
      function updateCurrentTime() {
        if (currentVideo) {
          const currentTime = currentVideo.currentTime;
          const minutes = Math.floor(currentTime / 60);
          const seconds = Math.floor(currentTime % 60);
          currentTimeDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
      }

      function getCurrentTime(type) {
        if (!currentVideo) {
          showError('âŒ è¯·å…ˆä¸Šä¼ è§†é¢‘æ–‡ä»¶', errorMessage);
          return;
        }
        
        const currentTime = Math.floor(currentVideo.currentTime);
        
        if (type === 'start') {
          startTimeInput.value = currentTime;
          statusMessage.textContent = `â° å·²è®¾ç½®å¼€å§‹æ—¶é—´: ${formatTime(currentTime)}`;
        } else if (type === 'end') {
          endTimeInput.value = currentTime;
          statusMessage.textContent = `â° å·²è®¾ç½®ç»“æŸæ—¶é—´: ${formatTime(currentTime)}`;
        }
      }

      function addTimeSegment() {
        const startTime = parseFloat(startTimeInput.value);
        const endTime = parseFloat(endTimeInput.value);
        
        if (isNaN(startTime) || isNaN(endTime)) {
          showError('âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„å¼€å§‹å’Œç»“æŸæ—¶é—´', errorMessage);
          return;
        }
        
        if (startTime >= endTime) {
          showError('âŒ å¼€å§‹æ—¶é—´å¿…é¡»å°äºç»“æŸæ—¶é—´', errorMessage);
          return;
        }
        
        if (currentVideo && endTime > currentVideo.duration) {
          showError('âŒ ç»“æŸæ—¶é—´ä¸èƒ½è¶…è¿‡è§†é¢‘æ€»æ—¶é•¿', errorMessage);
          return;
        }
        
        // æ£€æŸ¥æ—¶é—´æ®µé‡å 
        const hasOverlap = timeSegments.some(segment => 
          (startTime < segment.end && endTime > segment.start)
        );
        
        if (hasOverlap) {
          if (!confirm('âš ï¸ æ£€æµ‹åˆ°æ—¶é—´æ®µé‡å ï¼Œæ˜¯å¦ç»§ç»­æ·»åŠ ï¼Ÿ')) {
            return;
          }
        }
        
        const segment = {
          id: Date.now(),
          start: startTime,
          end: endTime,
          duration: endTime - startTime
        };
        
        timeSegments.push(segment);
        updateSegmentsList();
        
        // æ¸…ç©ºè¾“å…¥æ¡†
        startTimeInput.value = '';
        endTimeInput.value = '';
        
        statusMessage.textContent = `âœ… å·²æ·»åŠ æ—¶é—´æ®µ: ${formatTime(startTime)} - ${formatTime(endTime)}`;
      }

      function removeTimeSegment(id) {
        timeSegments = timeSegments.filter(segment => segment.id !== id);
        updateSegmentsList();
        statusMessage.textContent = 'ğŸ—‘ï¸ å·²åˆ é™¤æ—¶é—´æ®µ';
      }

      function updateSegmentsList() {
        segmentsCount.textContent = `${timeSegments.length} ä¸ªç‰‡æ®µ`;
        
        const segmentsContainer = document.getElementById('segmentsContainer');
        
        if (timeSegments.length === 0) {
          segmentsContainer.innerHTML = '<div class="empty-segments"><p>ğŸ¬ æš‚æ— æ—¶é—´æ®µï¼Œè¯·æ·»åŠ è¦åˆ†ç¦»çš„æ—¶é—´æ®µ</p></div>';
          processBtn.disabled = true;
          return;
        }
        
        // æŒ‰å¼€å§‹æ—¶é—´æ’åº
        timeSegments.sort((a, b) => a.start - b.start);
        
        segmentsContainer.innerHTML = timeSegments.map((segment, index) => `
          <div class="segment-item" data-id="${segment.id}">
            <div class="segment-info">
              <div class="segment-title">ç‰‡æ®µ ${index + 1}</div>
              <div class="segment-time">${formatTime(segment.start)} - ${formatTime(segment.end)}</div>
              <div class="segment-duration">(æ—¶é•¿: ${formatTime(segment.duration)})</div>
            </div>
            <div class="segment-actions">
              <button class="segment-delete-btn" onclick="removeTimeSegment(${segment.id})" title="åˆ é™¤ç‰‡æ®µ">
                ğŸ—‘ï¸ åˆ é™¤
              </button>
            </div>
          </div>
        `).join('');
        
        // å¯ç”¨å¤„ç†æŒ‰é’®
        if (inputFile) {
          processBtn.disabled = false;
        }
      }

      function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${minutes}:${secs.toString().padStart(2, '0')}`;
      }

      // å¤„ç†è§†é¢‘åˆ†ç¦»
      async function processVideo() {
        if (!inputFile) {
          showError('âŒ è¯·å…ˆä¸Šä¼ è§†é¢‘æ–‡ä»¶', errorMessage);
          return;
        }
        
        if (timeSegments.length === 0) {
          showError('âŒ è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªæ—¶é—´æ®µ', errorMessage);
          return;
        }

        try {
          statusMessage.textContent = 'ğŸš€ æ­£åœ¨åŠ è½½FFmpegå¼•æ“...';
          statusMessage.classList.add('processing');
          errorMessage.textContent = '';
          processBtn.disabled = true;
          downloadVideoBtn.disabled = true;
          downloadAudioBtn.disabled = true;
          downloadSection.style.display = 'none';

          // åˆå§‹åŒ–FFmpeg
          if (!ffmpeg) {
            const { createFFmpeg, fetchFile } = FFmpeg;
            ffmpeg = createFFmpeg({
              log: true,
            });

            // ç›‘å¬è¿›åº¦
            ffmpeg.setProgress(({ ratio }) => {
              const percent = Math.floor(ratio * 100);
              progressFill.style.width = `${percent}%`;
              progressText.textContent = `ğŸ¯ å¤„ç†ä¸­: ${percent}%`;
            });

            await ffmpeg.load();
          }

          const { fetchFile } = FFmpeg;
          const videoFormat = videoFormatSelect.value;
          const audioFormat = audioFormatSelect.value;
          const videoQuality = videoQualitySelect.value;
          const audioBitrate = audioBitrateSelect.value;

          // å†™å…¥è§†é¢‘æ–‡ä»¶åˆ°è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ
          const inputName = 'input.' + inputFile.name.split('.').pop();
          ffmpeg.FS('writeFile', inputName, await fetchFile(inputFile));

          // å¤„ç†å¤šä¸ªæ—¶é—´æ®µ
          const segmentBlobs = [];
          
          statusMessage.textContent = `ğŸ¬ æ­£åœ¨å¤„ç† ${timeSegments.length} ä¸ªæ—¶é—´æ®µ...`;
          
          for (let i = 0; i < timeSegments.length; i++) {
            const segment = timeSegments[i];
            const segmentVideoName = `video_segment_${i}.${videoFormat}`;
            const segmentAudioName = `audio_segment_${i}.${audioFormat}`;
            
            statusMessage.textContent = `ğŸ¬ æ­£åœ¨å¤„ç†ç¬¬ ${i + 1}/${timeSegments.length} ä¸ªç‰‡æ®µ...`;
            
            // å¤„ç†è§†é¢‘ç‰‡æ®µ
            const videoArgs = ['-i', inputName, '-ss', segment.start.toString(), '-t', segment.duration.toString(), '-an'];
            
            // è®¾ç½®è§†é¢‘è´¨é‡
            if (videoQuality === 'original') {
              videoArgs.push('-c:v', 'copy');
            } else {
              videoArgs.push('-c:v', 'libx264');
              const crfMap = { high: '18', medium: '23', low: '28' };
              videoArgs.push('-crf', crfMap[videoQuality]);
            }
            
            videoArgs.push(segmentVideoName);
            await ffmpeg.run(...videoArgs);
            
            // å¤„ç†éŸ³é¢‘ç‰‡æ®µ
            const audioArgs = ['-i', inputName, '-ss', segment.start.toString(), '-t', segment.duration.toString(), '-vn'];
            audioArgs.push('-c:a', getAudioCodec(audioFormat));
            audioArgs.push('-b:a', `${audioBitrate}k`);
            audioArgs.push(segmentAudioName);
            
            await ffmpeg.run(...audioArgs);
            
            // è¯»å–ç‰‡æ®µæ–‡ä»¶
            const videoData = ffmpeg.FS('readFile', segmentVideoName);
            const audioData = ffmpeg.FS('readFile', segmentAudioName);
            
            const videoBlob = new Blob([videoData.buffer], { type: `video/${videoFormat}` });
            const audioBlob = new Blob([audioData.buffer], { type: `audio/${audioFormat}` });
            
            segmentBlobs.push({
              index: i,
              segment: segment,
              videoBlob: videoBlob,
              audioBlob: audioBlob
            });
            
            // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
            ffmpeg.FS('unlink', segmentVideoName);
            ffmpeg.FS('unlink', segmentAudioName);
          }

          // ç”Ÿæˆä¸‹è½½åŒºåŸŸ
          generateDownloadArea(segmentBlobs, videoFormat, audioFormat);

          // æ˜¾ç¤ºä¸‹è½½åŒºåŸŸ
          downloadSection.style.display = 'flex';

          statusMessage.textContent = `ğŸ‰ å¤šæ—¶é—´æ®µéŸ³è§†é¢‘åˆ†ç¦»å®Œæˆï¼å…±å¤„ç† ${timeSegments.length} ä¸ªç‰‡æ®µ`;
          statusMessage.classList.remove('processing');
          progressText.textContent = 'âœ… å¤„ç†å®Œæˆ';
          progressFill.style.width = '100%';

        } catch (error) {
          console.error('å¤„ç†å¤±è´¥:', error);
          showError(`âŒ å¤„ç†å¤±è´¥: ${error.message}`, errorMessage);
          statusMessage.classList.remove('processing');
          processBtn.disabled = false;
        }
      }

      // è·å–éŸ³é¢‘ç¼–ç å™¨
      function getAudioCodec(format) {
        const codecMap = {
          mp3: 'libmp3lame',
          wav: 'pcm_s16le',
          aac: 'aac',
          flac: 'flac',
          ogg: 'libvorbis',
          m4a: 'aac',
          wma: 'wmav2'
        };
        return codecMap[format] || 'aac';
      }

      // ç”Ÿæˆä¸‹è½½åŒºåŸŸ
      function generateDownloadArea(segmentBlobs, videoFormat, audioFormat) {
        downloadSegments.innerHTML = '';
        
        segmentBlobs.forEach((segmentData, index) => {
          const segmentDiv = document.createElement('div');
          segmentDiv.className = 'download-segment';
          segmentDiv.innerHTML = `
            <div class="segment-header">
              <h4>ç‰‡æ®µ ${index + 1}</h4>
              <span class="segment-time">${formatTime(segmentData.segment.start)} - ${formatTime(segmentData.segment.end)}</span>
            </div>
            <div class="download-items">
              <div class="download-item">
                <div class="download-title">ğŸ¬ è§†é¢‘æ–‡ä»¶</div>
                <div class="download-size">${formatFileSize(segmentData.videoBlob.size)}</div>
                <button class="btn-success download-btn" data-type="video" data-index="${index}">
                  ğŸ“¥ ä¸‹è½½è§†é¢‘
                </button>
              </div>
              <div class="download-item">
                <div class="download-title">ğŸµ éŸ³é¢‘æ–‡ä»¶</div>
                <div class="download-size">${formatFileSize(segmentData.audioBlob.size)}</div>
                <button class="btn-success download-btn" data-type="audio" data-index="${index}">
                  ğŸ“¥ ä¸‹è½½éŸ³é¢‘
                </button>
              </div>
            </div>
          `;
          downloadSegments.appendChild(segmentDiv);
        });
        
        // æ·»åŠ ä¸‹è½½æŒ‰é’®äº‹ä»¶ç›‘å¬
        document.querySelectorAll('.download-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const type = e.target.getAttribute('data-type');
            const index = parseInt(e.target.getAttribute('data-index'));
            downloadSegmentFile(segmentBlobs[index], type, videoFormat, audioFormat, index + 1);
          });
        });
      }

      // ä¸‹è½½ç‰‡æ®µæ–‡ä»¶
      function downloadSegmentFile(segmentData, type, videoFormat, audioFormat, segmentNumber) {
        const blob = type === 'video' ? segmentData.videoBlob : segmentData.audioBlob;
        const format = type === 'video' ? videoFormat : audioFormat;
        const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
        const filename = `${type === 'video' ? 'è§†é¢‘' : 'éŸ³é¢‘'}_ç‰‡æ®µ${segmentNumber}_${timestamp}.${format}`;

        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        a.click();

        statusMessage.textContent = `ğŸ“¥ ${type === 'video' ? 'è§†é¢‘' : 'éŸ³é¢‘'}æ–‡ä»¶ä¸‹è½½ä¸­...`;
      }

      // é‡ç½®æ‰€æœ‰
      function resetAll() {
        if (confirm('ğŸ¤” ç¡®å®šè¦é‡ç½®æ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
          if (videoUrl) {
            URL.revokeObjectURL(videoUrl);
            videoUrl = null;
          }

          inputFile = null;
          videoBlob = null;
          audioBlob = null;
          currentVideo = null;
          timeSegments = [];
          
          videoInput.value = '';
          startTimeInput.value = '';
          endTimeInput.value = '';
          currentTimeDisplay.textContent = '00:00';

          originalPreview.innerHTML = '<p style="text-align: center; padding: 60px 20px; color: var(--text-secondary); font-size: 1.1rem;">ğŸ“º è§†é¢‘é¢„è§ˆåŒº</p>';
          updateSegmentsList();
          
          downloadSection.style.display = 'none';
          processBtn.disabled = true;
          statusMessage.textContent = '';
          statusMessage.classList.remove('processing');
          errorMessage.textContent = '';
          progressFill.style.width = '0%';
          progressText.textContent = 'ğŸš€ å‡†å¤‡å°±ç»ª';
        }
      }

      // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
      function showError(message, element) {
        element.textContent = message;
        element.classList.add('error-shake');
        setTimeout(() => {
          element.classList.remove('error-shake');
        }, 500);
      }

      // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
      function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }

      // åˆå§‹åŒ–
      initEvents();
    </script>
  </body>
</html>
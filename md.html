<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Markdownç¼–è¾‘å™¨</title>
    <!-- å¼•å…¥marked.jsç”¨äºMarkdownè§£æ -->
    <script src="./md/marked.min.js"></script>
    <!-- å¼•å…¥highlight.jsç”¨äºä»£ç é«˜äº® -->
    <link rel="stylesheet" href="./md/github.min.css" />
    <script src="./md/highlight.min.js"></script>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: 'SF Pro Display', 'PingFang SC', 'Helvetica Neue', Arial,
          sans-serif;
      }

      :root {
        --primary-bg: #e6e7ee;
        --secondary-bg: #ffffff;
        --shadow-light: #ffffff;
        --shadow-dark: #d1d9e6;
        --accent-color: #667eea;
        --accent-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-color: #4ecdc4;
        --danger-color: #ff6b6b;
        --warning-color: #feca57;
        --text-primary: #2d3748;
        --text-secondary: #718096;
        --glass-bg: rgba(255, 255, 255, 0.25);
        --glass-border: rgba(255, 255, 255, 0.18);
      }

      body {
        background: var(--primary-bg);
        color: var(--text-primary);
        min-height: 100vh;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: all 0.3s ease;
        animation: pageLoad 0.8s ease;
      }

      @keyframes pageLoad {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .container {
        width: 100%;
        max-width: 1400px;
        background: var(--primary-bg);
        border-radius: 30px;
        padding: 40px;
        box-shadow: 20px 20px 60px var(--shadow-dark),
          -20px -20px 60px var(--shadow-light);
        margin-top: 20px;
        transition: all 0.3s ease;
        animation: containerFloat 1s ease 0.2s both;
      }

      @keyframes containerFloat {
        from {
          opacity: 0;
          transform: translateY(30px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .container:hover {
        box-shadow: 25px 25px 70px var(--shadow-dark),
          -25px -25px 70px var(--shadow-light);
      }

      header {
        text-align: center;
        margin-bottom: 40px;
        padding: 30px;
        background: var(--primary-bg);
        border-radius: 25px;
        box-shadow: 10px 10px 20px var(--shadow-dark),
          -10px -10px 20px var(--shadow-light);
        animation: headerSlide 0.8s ease 0.4s both;
      }

      @keyframes headerSlide {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h1 {
        font-size: 3.2rem;
        margin-bottom: 15px;
        background: var(--accent-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 700;
        animation: titleGlow 3s ease-in-out infinite alternate;
      }

      @keyframes titleGlow {
        from {
          filter: brightness(1);
        }
        to {
          filter: brightness(1.2);
        }
      }

      .subtitle {
        font-size: 1.3rem;
        color: var(--text-secondary);
        margin-bottom: 30px;
        font-weight: 500;
      }

      .toolbar {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        padding: 20px;
        background: var(--primary-bg);
        border-radius: 20px;
        box-shadow: 10px 10px 20px var(--shadow-dark),
          -10px -10px 20px var(--shadow-light);
        flex-wrap: wrap;
        justify-content: center;
        animation: toolbarSlide 0.8s ease 0.6s both;
      }

      @keyframes toolbarSlide {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      button {
        background: var(--primary-bg);
        color: var(--text-primary);
        border: none;
        padding: 12px 24px;
        border-radius: 15px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        font-size: 0.95rem;
        flex-shrink: 0;
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light);
        position: relative;
        overflow: hidden;
      }

      button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      button:hover::before {
        left: 100%;
      }

      button:hover {
        transform: translateY(-3px);
        box-shadow: 12px 12px 24px var(--shadow-dark),
          -12px -12px 24px var(--shadow-light);
      }

      button:active {
        transform: translateY(0);
        box-shadow: inset 6px 6px 12px var(--shadow-dark),
          inset -6px -6px 12px var(--shadow-light);
      }

      .btn-primary {
        background: var(--accent-gradient);
        color: white;
        padding: 14px 28px;
        font-size: 1rem;
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light),
          inset 0 1px 0 rgba(255, 255, 255, 0.2);
      }

      .btn-primary:hover {
        box-shadow: 12px 12px 24px var(--shadow-dark),
          -12px -12px 24px var(--shadow-light),
          inset 0 1px 0 rgba(255, 255, 255, 0.2),
          0 0 30px rgba(102, 126, 234, 0.3);
      }

      .btn-success {
        background: linear-gradient(
          135deg,
          var(--success-color) 0%,
          #44a08d 100%
        );
        color: white;
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light),
          inset 0 1px 0 rgba(255, 255, 255, 0.2);
      }

      .btn-danger {
        background: linear-gradient(
          135deg,
          var(--danger-color) 0%,
          #e74c3c 100%
        );
        color: white;
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light),
          inset 0 1px 0 rgba(255, 255, 255, 0.2);
      }

      .file-input {
        position: relative;
        overflow: hidden;
        display: inline-block;
      }

      .file-input input[type='file'] {
        position: absolute;
        left: -9999px;
      }

      .editor-container {
        display: flex;
        gap: 20px;
        height: 600px;
        margin-bottom: 30px;
        animation: editorSlide 0.8s ease 0.8s both;
      }

      @keyframes editorSlide {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .editor-panel {
        flex: 1;
        background: var(--primary-bg);
        border-radius: 20px;
        padding: 25px;
        box-shadow: inset 10px 10px 20px var(--shadow-dark),
          inset -10px -10px 20px var(--shadow-light);
        display: none;
        flex-direction: column;
        transition: all 0.3s ease;
      }

      .editor-panel.show {
        display: flex;
      }

      .preview-only .preview-panel {
        flex: 1;
        max-width: 100%;
      }

      /* å…¨å±æ¨¡å¼ä¸‹çš„æ ·å¼ä¼˜åŒ– */
      .preview-panel:fullscreen {
        background: var(--secondary-bg);
        padding: 40px;
        display: flex;
        flex-direction: column;
      }

      .preview-panel:fullscreen #markdownPreview {
        max-width: 1000px;
        margin: 0 auto;
        flex: 1;
      }

      .preview-panel:-webkit-full-screen {
        background: var(--secondary-bg);
        padding: 40px;
        display: flex;
        flex-direction: column;
      }

      .preview-panel:-webkit-full-screen #markdownPreview {
        max-width: 1000px;
        margin: 0 auto;
        flex: 1;
      }

      .preview-panel:-moz-full-screen {
        background: var(--secondary-bg);
        padding: 40px;
        display: flex;
        flex-direction: column;
      }

      .preview-panel:-moz-full-screen #markdownPreview {
        max-width: 1000px;
        margin: 0 auto;
        flex: 1;
      }

      .panel-header {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--accent-color);
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid rgba(102, 126, 234, 0.2);
      }

      #markdownInput {
        flex: 1;
        background: var(--primary-bg);
        border: none;
        border-radius: 15px;
        padding: 20px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 14px;
        line-height: 1.6;
        color: var(--text-primary);
        resize: none;
        outline: none;
        box-shadow: inset 8px 8px 16px var(--shadow-dark),
          inset -8px -8px 16px var(--shadow-light);
        transition: all 0.3s ease;
      }

      #markdownInput:focus {
        box-shadow: inset 10px 10px 20px var(--shadow-dark),
          inset -10px -10px 20px var(--shadow-light),
          0 0 0 3px rgba(102, 126, 234, 0.2);
      }

      .preview-panel {
        flex: 1;
        background: var(--secondary-bg);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 10px 10px 20px var(--shadow-dark),
          -10px -10px 20px var(--shadow-light);
        overflow-y: auto;
        display: flex;
        flex-direction: column;
      }

      #markdownPreview {
        flex: 1;
        line-height: 1.8;
        color: var(--text-primary);
      }

      #markdownPreview h1,
      #markdownPreview h2,
      #markdownPreview h3,
      #markdownPreview h4,
      #markdownPreview h5,
      #markdownPreview h6 {
        color: var(--accent-color);
        margin: 20px 0 10px 0;
        font-weight: 600;
      }

      #markdownPreview h1 {
        font-size: 2rem;
        border-bottom: 2px solid var(--accent-color);
        padding-bottom: 10px;
      }

      #markdownPreview h2 {
        font-size: 1.6rem;
      }

      #markdownPreview h3 {
        font-size: 1.4rem;
      }

      #markdownPreview p {
        margin: 15px 0;
      }

      #markdownPreview ul,
      #markdownPreview ol {
        margin: 15px 0;
        padding-left: 30px;
      }

      #markdownPreview li {
        margin: 8px 0;
      }

      #markdownPreview blockquote {
        border-left: 4px solid var(--accent-color);
        padding-left: 20px;
        margin: 20px 0;
        background: rgba(102, 126, 234, 0.05);
        padding: 15px 20px;
        border-radius: 10px;
        font-style: italic;
      }

      #markdownPreview code {
        background: rgba(102, 126, 234, 0.1);
        padding: 2px 6px;
        border-radius: 4px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 0.9em;
      }

      #markdownPreview pre {
        background: var(--primary-bg);
        padding: 20px;
        border-radius: 10px;
        overflow-x: auto;
        margin: 20px 0;
        box-shadow: inset 6px 6px 12px var(--shadow-dark),
          inset -6px -6px 12px var(--shadow-light);
      }

      #markdownPreview pre code {
        background: none;
        padding: 0;
        border-radius: 0;
      }

      #markdownPreview table {
        border-collapse: collapse;
        width: 100%;
        margin: 20px 0;
        background: var(--secondary-bg);
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 6px 6px 12px var(--shadow-dark),
          -6px -6px 12px var(--shadow-light);
      }

      #markdownPreview th,
      #markdownPreview td {
        border: 1px solid rgba(102, 126, 234, 0.2);
        padding: 12px 15px;
        text-align: left;
      }

      #markdownPreview th {
        background: var(--accent-color);
        color: white;
        font-weight: 600;
      }

      #markdownPreview tr:nth-child(even) {
        background: rgba(102, 126, 234, 0.05);
      }

      #markdownPreview a {
        color: var(--accent-color);
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      #markdownPreview a:hover {
        text-decoration: underline;
        color: var(--success-color);
      }

      /* å›¾ç‰‡æ ·å¼é™åˆ¶ */
      #markdownPreview img {
        max-width: 100%;
        max-height: 400px;
        height: auto;
        border-radius: 10px;
        box-shadow: 6px 6px 12px var(--shadow-dark),
          -6px -6px 12px var(--shadow-light);
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 15px 0;
        display: block;
      }

      #markdownPreview img:hover {
        transform: scale(1.02);
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light);
      }

      /* å›¾ç‰‡å¼¹æ¡†æ ·å¼ */
      .image-modal {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        animation: modalFadeIn 0.3s ease;
      }

      .image-modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      @keyframes modalFadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .modal-content {
        max-width: 90%;
        max-height: 90%;
        border-radius: 15px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: modalSlideIn 0.3s ease;
      }

      @keyframes modalSlideIn {
        from {
          transform: scale(0.8) translateY(20px);
          opacity: 0;
        }
        to {
          transform: scale(1) translateY(0);
          opacity: 1;
        }
      }

      .modal-close {
        position: absolute;
        top: 20px;
        right: 30px;
        color: white;
        font-size: 40px;
        font-weight: bold;
        cursor: pointer;
        z-index: 10000;
        transition: all 0.3s ease;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-close:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.1);
      }

      .status-message {
        min-height: 35px;
        margin: 20px 0;
        color: var(--accent-color);
        font-weight: 600;
        font-size: 1.1rem;
        text-align: center;
        transition: all 0.3s ease;
      }

      .error-message {
        color: var(--danger-color);
        margin: 20px 0;
        min-height: 35px;
        font-weight: 600;
        font-size: 1.1rem;
        text-align: center;
        animation: errorShake 0.5s ease;
      }

      @keyframes errorShake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }

      .success-message {
        color: var(--success-color);
        margin: 20px 0;
        min-height: 35px;
        font-weight: 600;
        font-size: 1.1rem;
        text-align: center;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 1024px) {
        .editor-container {
          flex-direction: column;
          height: auto;
        }

        .editor-panel,
        .preview-panel {
          height: 400px;
        }

        .toolbar {
          justify-content: flex-start;
        }

        button {
          padding: 10px 20px;
          font-size: 0.9rem;
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 20px;
        }

        h1 {
          font-size: 2.5rem;
        }

        .toolbar {
          gap: 10px;
        }

        button {
          padding: 8px 16px;
          font-size: 0.85rem;
        }

        .editor-panel,
        .preview-panel {
          height: 300px;
          padding: 15px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ğŸ“ Markdownç¼–è¾‘å™¨</h1>
        <p class="subtitle">
          åœ¨çº¿ç¼–è¾‘å’Œé¢„è§ˆMarkdownæ–‡æ¡£ï¼Œæ”¯æŒå®æ—¶æ¸²æŸ“å’Œæ–‡ä»¶æ“ä½œ
        </p>
      </header>

      <div class="toolbar">
        <div class="file-input">
          <input type="file" id="fileInput" accept=".md,.markdown,.txt" />
          <button
            class="btn-primary"
            onclick="document.getElementById('fileInput').click()"
          >
            ğŸ“ æ‰“å¼€æ–‡ä»¶
          </button>
        </div>
        <button id="newDocBtn" onclick="newDocument()">ğŸ“„ æ–°å»ºæ–‡æ¡£</button>
        <button id="clearBtn" onclick="clearContent()" class="btn-danger">
          ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹
        </button>
        <button id="toggleEditorBtn" onclick="toggleEditor()">
          ğŸ“ æ˜¾ç¤º/éšè—ç¼–è¾‘å™¨
        </button>
        <button
          id="fullscreenBtn"
          onclick="toggleFullscreen()"
          class="btn-primary"
        >
          ğŸ” é¢„è§ˆå…¨å±
        </button>
        <button onclick="downloadMarkdown()" class="btn-success">
          ğŸ’¾ ä¿å­˜ä¸ºMD
        </button>
        <button onclick="downloadHTML()">ğŸŒ å¯¼å‡ºHTML</button>
        <button onclick="insertTemplate('heading')">ğŸ“‹ æ’å…¥æ ‡é¢˜</button>
        <button onclick="insertTemplate('list')">ğŸ“ æ’å…¥åˆ—è¡¨</button>
        <button onclick="insertTemplate('table')">ğŸ“Š æ’å…¥è¡¨æ ¼</button>
        <button onclick="insertTemplate('code')">ğŸ’» æ’å…¥ä»£ç </button>
      </div>

      <div class="editor-container">
        <div class="editor-panel">
          <div class="panel-header">ğŸ“ Markdownç¼–è¾‘å™¨</div>
          <textarea
            id="markdownInput"
            placeholder="åœ¨è¿™é‡Œè¾“å…¥Markdownå†…å®¹...\n\nç¤ºä¾‹ï¼š\n# æ ‡é¢˜\n\nè¿™æ˜¯ä¸€ä¸ª**ç²—ä½“**æ–‡æœ¬å’Œ*æ–œä½“*æ–‡æœ¬ã€‚\n\n- åˆ—è¡¨é¡¹1\n- åˆ—è¡¨é¡¹2\n\n```javascript\nconsole.log('Hello World!');\n```\n\n> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å—"
          ></textarea>
        </div>

        <div class="preview-panel">
          <div class="panel-header">ğŸ‘ï¸ å®æ—¶é¢„è§ˆ</div>
          <div id="markdownPreview"></div>
        </div>
      </div>

      <div id="statusMessage" class="status-message"></div>
    </div>

    <!-- å›¾ç‰‡å¼¹æ¡† -->
    <div id="imageModal" class="image-modal">
      <span class="modal-close" onclick="closeImageModal()">&times;</span>
      <img class="modal-content" id="modalImage" />
    </div>

    <script>
      // åˆå§‹åŒ–markedé…ç½®
      marked.setOptions({
        highlight: function (code, lang) {
          if (lang && hljs.getLanguage(lang)) {
            try {
              return hljs.highlight(code, { language: lang }).value
            } catch (err) {}
          }
          return hljs.highlightAuto(code).value
        },
        breaks: true,
        gfm: true,
      })

      const markdownInput = document.getElementById('markdownInput')
      const markdownPreview = document.getElementById('markdownPreview')
      const statusMessage = document.getElementById('statusMessage')
      const fileInput = document.getElementById('fileInput')

      // å®æ—¶é¢„è§ˆåŠŸèƒ½
      function updatePreview() {
        const markdownText = markdownInput.value
        try {
          const html = marked.parse(markdownText)
          markdownPreview.innerHTML = html
          // æ‰‹åŠ¨è§¦å‘ä»£ç é«˜äº®
          hljs.highlightAll()
          // ä¸ºå›¾ç‰‡æ·»åŠ ç‚¹å‡»äº‹ä»¶
          addImageClickEvents()
        } catch (error) {
          markdownPreview.innerHTML =
            '<p style="color: var(--danger-color);">é¢„è§ˆé”™è¯¯: ' +
            error.message +
            '</p>'
        }
      }

      // ä¸ºå›¾ç‰‡æ·»åŠ ç‚¹å‡»äº‹ä»¶
      function addImageClickEvents() {
        const images = markdownPreview.querySelectorAll('img')
        images.forEach((img) => {
          img.addEventListener('click', function () {
            openImageModal(this.src, this.alt)
          })
        })
      }

      // æ‰“å¼€å›¾ç‰‡å¼¹æ¡†
      function openImageModal(src, alt) {
        const modal = document.getElementById('imageModal')
        const modalImg = document.getElementById('modalImage')

        modalImg.src = src
        modalImg.alt = alt || ''

        // æ£€æµ‹æ˜¯å¦å¤„äºå…¨å±æ¨¡å¼
        const fullscreenElement =
          document.fullscreenElement ||
          document.webkitFullscreenElement ||
          document.mozFullScreenElement ||
          document.msFullscreenElement

        if (fullscreenElement) {
          // å¦‚æœå¤„äºå…¨å±æ¨¡å¼ï¼Œå°†å¼¹æ¡†æ·»åŠ åˆ°å…¨å±å…ƒç´ ä¸­
          fullscreenElement.appendChild(modal)
        } else {
          // å¦‚æœä¸åœ¨å…¨å±æ¨¡å¼ï¼Œç¡®ä¿å¼¹æ¡†åœ¨bodyä¸­
          if (modal.parentNode !== document.body) {
            document.body.appendChild(modal)
          }
        }

        modal.classList.add('show')

        // é˜»æ­¢é¡µé¢æ»šåŠ¨
        document.body.style.overflow = 'hidden'
      }

      // å…³é—­å›¾ç‰‡å¼¹æ¡†
      function closeImageModal() {
        const modal = document.getElementById('imageModal')
        modal.classList.remove('show')

        // å°†å¼¹æ¡†ç§»å›bodyï¼Œç¡®ä¿ä¸‹æ¬¡èƒ½æ­£å¸¸ä½¿ç”¨
        if (modal.parentNode !== document.body) {
          document.body.appendChild(modal)
        }

        // æ¢å¤é¡µé¢æ»šåŠ¨
        document.body.style.overflow = 'auto'
      }

      // ç‚¹å‡»å¼¹æ¡†èƒŒæ™¯å…³é—­
      document
        .getElementById('imageModal')
        .addEventListener('click', function (e) {
          if (e.target === this) {
            closeImageModal()
          }
        })

      // ESCé”®å…³é—­å¼¹æ¡†
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
          closeImageModal()
        }
      })

      // ç›‘å¬å…¨å±çŠ¶æ€å˜åŒ–
      document.addEventListener('fullscreenchange', function () {
        const modal = document.getElementById('imageModal')
        if (modal.classList.contains('show') && !document.fullscreenElement) {
          // å¦‚æœå¼¹æ¡†æ­£åœ¨æ˜¾ç¤ºä¸”é€€å‡ºäº†å…¨å±ï¼Œå°†å¼¹æ¡†ç§»å›body
          if (modal.parentNode !== document.body) {
            document.body.appendChild(modal)
          }
        }
      })

      // å…¼å®¹ä¸åŒæµè§ˆå™¨çš„å…¨å±äº‹ä»¶
      document.addEventListener('webkitfullscreenchange', function () {
        const modal = document.getElementById('imageModal')
        if (
          modal.classList.contains('show') &&
          !document.webkitFullscreenElement
        ) {
          if (modal.parentNode !== document.body) {
            document.body.appendChild(modal)
          }
        }
      })

      document.addEventListener('mozfullscreenchange', function () {
        const modal = document.getElementById('imageModal')
        if (
          modal.classList.contains('show') &&
          !document.mozFullScreenElement
        ) {
          if (modal.parentNode !== document.body) {
            document.body.appendChild(modal)
          }
        }
      })

      // ç›‘å¬è¾“å…¥å˜åŒ–
      markdownInput.addEventListener('input', updatePreview)

      // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
      function showMessage(message, type = 'info') {
        statusMessage.textContent = message
        statusMessage.className =
          type === 'error'
            ? 'error-message'
            : type === 'success'
            ? 'success-message'
            : 'status-message'

        setTimeout(() => {
          statusMessage.textContent = ''
          statusMessage.className = 'status-message'
        }, 3000)
      }

      // æ–‡ä»¶è¯»å–åŠŸèƒ½
      fileInput.addEventListener('change', function (e) {
        const file = e.target.files[0]
        if (!file) return

        if (!file.name.match(/\.(md|markdown|txt)$/i)) {
          showMessage('è¯·é€‰æ‹©Markdownæ–‡ä»¶ï¼ˆ.md, .markdown, .txtï¼‰', 'error')
          return
        }

        const reader = new FileReader()
        reader.onload = function (e) {
          markdownInput.value = e.target.result
          updatePreview()
          showMessage(`æ–‡ä»¶ "${file.name}" åŠ è½½æˆåŠŸï¼`, 'success')
        }
        reader.onerror = function () {
          showMessage('æ–‡ä»¶è¯»å–å¤±è´¥', 'error')
        }
        reader.readAsText(file, 'UTF-8')
      })

      // ç¼–è¾‘å™¨æ˜¾ç¤ºçŠ¶æ€
      let editorVisible = false
      let isFullscreen = false

      // åˆ‡æ¢ç¼–è¾‘å™¨æ˜¾ç¤º/éšè—
      function toggleEditor() {
        const editorPanel = document.querySelector('.editor-panel')
        const editorContainer = document.querySelector('.editor-container')
        const toggleBtn = document.getElementById('toggleEditorBtn')

        editorVisible = !editorVisible

        if (editorVisible) {
          editorPanel.classList.add('show')
          editorContainer.classList.remove('preview-only')
          toggleBtn.textContent = 'ğŸ‘ï¸ éšè—ç¼–è¾‘å™¨'
          showMessage('ç¼–è¾‘å™¨å·²æ˜¾ç¤º', 'success')
        } else {
          editorPanel.classList.remove('show')
          editorContainer.classList.add('preview-only')
          toggleBtn.textContent = 'ğŸ“ æ˜¾ç¤ºç¼–è¾‘å™¨'
          showMessage('ç¼–è¾‘å™¨å·²éšè—', 'info')
        }
      }

      // åˆ‡æ¢å…¨å±é¢„è§ˆ
      function toggleFullscreen() {
        const previewPanel = document.querySelector('.preview-panel')
        const fullscreenBtn = document.getElementById('fullscreenBtn')

        if (!document.fullscreenElement) {
          // è¿›å…¥å…¨å±æ¨¡å¼
          if (previewPanel.requestFullscreen) {
            previewPanel.requestFullscreen()
          } else if (previewPanel.mozRequestFullScreen) {
            // Firefox
            previewPanel.mozRequestFullScreen()
          } else if (previewPanel.webkitRequestFullscreen) {
            // Chrome, Safari
            previewPanel.webkitRequestFullscreen()
          } else if (previewPanel.msRequestFullscreen) {
            // IE/Edge
            previewPanel.msRequestFullscreen()
          }
          showMessage('å·²è¿›å…¥å…¨å±é¢„è§ˆæ¨¡å¼ï¼ŒæŒ‰ESCé”®é€€å‡º', 'success')
        } else {
          // é€€å‡ºå…¨å±æ¨¡å¼
          if (document.exitFullscreen) {
            document.exitFullscreen()
          } else if (document.mozCancelFullScreen) {
            // Firefox
            document.mozCancelFullScreen()
          } else if (document.webkitExitFullscreen) {
            // Chrome, Safari
            document.webkitExitFullscreen()
          } else if (document.msExitFullscreen) {
            // IE/Edge
            document.msExitFullscreen()
          }
          showMessage('å·²é€€å‡ºå…¨å±é¢„è§ˆæ¨¡å¼', 'info')
        }
      }

      // ç›‘å¬å…¨å±çŠ¶æ€å˜åŒ–
      document.addEventListener('fullscreenchange', function () {
        const fullscreenBtn = document.getElementById('fullscreenBtn')
        if (document.fullscreenElement) {
          fullscreenBtn.textContent = 'ğŸ”™ é€€å‡ºå…¨å±'
          isFullscreen = true
        } else {
          fullscreenBtn.textContent = 'ğŸ” é¢„è§ˆå…¨å±'
          isFullscreen = false
        }
      })

      // å…¼å®¹å…¶ä»–æµè§ˆå™¨çš„å…¨å±çŠ¶æ€å˜åŒ–äº‹ä»¶
      document.addEventListener('webkitfullscreenchange', function () {
        const fullscreenBtn = document.getElementById('fullscreenBtn')
        if (document.webkitFullscreenElement) {
          fullscreenBtn.textContent = 'ğŸ”™ é€€å‡ºå…¨å±'
          isFullscreen = true
        } else {
          fullscreenBtn.textContent = 'ğŸ” é¢„è§ˆå…¨å±'
          isFullscreen = false
        }
      })

      document.addEventListener('mozfullscreenchange', function () {
        const fullscreenBtn = document.getElementById('fullscreenBtn')
        if (document.mozFullScreenElement) {
          fullscreenBtn.textContent = 'ğŸ”™ é€€å‡ºå…¨å±'
          isFullscreen = true
        } else {
          fullscreenBtn.textContent = 'ğŸ” é¢„è§ˆå…¨å±'
          isFullscreen = false
        }
      })

      // æ–°å»ºæ–‡æ¡£
      function newDocument() {
        console.log('æ–°å»ºæ–‡æ¡£å‡½æ•°è¢«è°ƒç”¨')
        if (
          markdownInput.value.trim() &&
          !confirm('å½“å‰å†…å®¹å°†è¢«æ¸…ç©ºï¼Œç¡®å®šè¦æ–°å»ºæ–‡æ¡£å—ï¼Ÿ')
        ) {
          return
        }
        markdownInput.value = ''
        // é‡ç½®æ–‡ä»¶è¾“å…¥æ¡†ï¼Œç¡®ä¿å¯ä»¥é‡æ–°é€‰æ‹©åŒä¸€ä¸ªæ–‡ä»¶
        fileInput.value = ''
        updatePreview()
        showMessage('æ–°å»ºæ–‡æ¡£æˆåŠŸ', 'success')
      }

      // æ¸…ç©ºå†…å®¹
      function clearContent() {
        console.log('æ¸…ç©ºå†…å®¹å‡½æ•°è¢«è°ƒç”¨')
        if (!markdownInput.value.trim()) {
          showMessage('å†…å®¹å·²ç»æ˜¯ç©ºçš„', 'info')
          return
        }
        if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
          markdownInput.value = ''
          // é‡ç½®æ–‡ä»¶è¾“å…¥æ¡†ï¼Œç¡®ä¿å¯ä»¥é‡æ–°é€‰æ‹©åŒä¸€ä¸ªæ–‡ä»¶
          fileInput.value = ''
          updatePreview()
          showMessage('å†…å®¹å·²æ¸…ç©º', 'success')
        }
      }

      // ä¸‹è½½Markdownæ–‡ä»¶
      function downloadMarkdown() {
        const content = markdownInput.value
        if (!content.trim()) {
          showMessage('æ²¡æœ‰å†…å®¹å¯ä»¥ä¿å­˜', 'error')
          return
        }

        const blob = new Blob([content], {
          type: 'text/markdown;charset=utf-8',
        })
        const url = URL.createObjectURL(blob)
        const a = document.createElement('a')
        a.href = url
        a.download = `document_${new Date()
          .toISOString()
          .slice(0, 19)
          .replace(/:/g, '-')}.md`
        document.body.appendChild(a)
        a.click()
        document.body.removeChild(a)
        URL.revokeObjectURL(url)
        showMessage('Markdownæ–‡ä»¶ä¿å­˜æˆåŠŸ', 'success')
      }

      // å¯¼å‡ºHTMLæ–‡ä»¶
      function downloadHTML() {
        const content = markdownInput.value
        if (!content.trim()) {
          showMessage('æ²¡æœ‰å†…å®¹å¯ä»¥å¯¼å‡º', 'error')
          return
        }

        try {
          const html = marked.parse(content)
          const fullHTML = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdownæ–‡æ¡£</title>
    <link rel="stylesheet" href="./md/github.min.css">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; }
        h1, h2, h3, h4, h5, h6 { color: #333; margin-top: 24px; margin-bottom: 16px; }
        code { background: #f6f8fa; padding: 2px 4px; border-radius: 3px; }
        pre { background: #f6f8fa; padding: 16px; border-radius: 6px; overflow-x: auto; }
        blockquote { border-left: 4px solid #dfe2e5; padding-left: 16px; margin: 0; color: #6a737d; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #dfe2e5; padding: 8px 12px; text-align: left; }
        th { background: #f6f8fa; }
        img {
        max-width: 100%;
        max-height: 400px;
        height: auto;
        border-radius: 10px;
        box-shadow: 6px 6px 12px var(--shadow-dark),
          -6px -6px 12px var(--shadow-light);
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 15px 0;
        display: block;
      }
    </style>
</head>
<body>
${html}
</body>
</html>`

          const blob = new Blob([fullHTML], { type: 'text/html;charset=utf-8' })
          const url = URL.createObjectURL(blob)
          const a = document.createElement('a')
          a.href = url
          a.download = `document_${new Date()
            .toISOString()
            .slice(0, 19)
            .replace(/:/g, '-')}.html`
          document.body.appendChild(a)
          a.click()
          document.body.removeChild(a)
          URL.revokeObjectURL(url)
          showMessage('HTMLæ–‡ä»¶å¯¼å‡ºæˆåŠŸ', 'success')
        } catch (error) {
          showMessage('HTMLå¯¼å‡ºå¤±è´¥: ' + error.message, 'error')
        }
      }

      // æ’å…¥æ¨¡æ¿
      function insertTemplate(type) {
        const textarea = markdownInput
        const start = textarea.selectionStart
        const end = textarea.selectionEnd
        const selectedText = textarea.value.substring(start, end)
        let template = ''

        switch (type) {
          case 'heading':
            template = selectedText ? `# ${selectedText}` : '# æ ‡é¢˜\n\nå†…å®¹...'
            break
          case 'list':
            template = selectedText
              ? selectedText
                  .split('\n')
                  .map((line) => (line.trim() ? `- ${line.trim()}` : ''))
                  .join('\n')
              : '- åˆ—è¡¨é¡¹1\n- åˆ—è¡¨é¡¹2\n- åˆ—è¡¨é¡¹3'
            break
          case 'table':
            template =
              '| åˆ—1 | åˆ—2 | åˆ—3 |\n|-----|-----|-----|\n| å†…å®¹1 | å†…å®¹2 | å†…å®¹3 |\n| å†…å®¹4 | å†…å®¹5 | å†…å®¹6 |'
            break
          case 'code':
            template = selectedText
              ? `\`\`\`javascript\n${selectedText}\n\`\`\``
              : '```javascript\nconsole.log("Hello World!");\n```'
            break
        }

        textarea.value =
          textarea.value.substring(0, start) +
          template +
          textarea.value.substring(end)
        textarea.focus()
        textarea.setSelectionRange(
          start + template.length,
          start + template.length
        )
        updatePreview()
        showMessage(
          `${
            type === 'heading'
              ? 'æ ‡é¢˜'
              : type === 'list'
              ? 'åˆ—è¡¨'
              : type === 'table'
              ? 'è¡¨æ ¼'
              : 'ä»£ç å—'
          }æ¨¡æ¿å·²æ’å…¥`,
          'success'
        )
      }

      // é”®ç›˜å¿«æ·é”®
      markdownInput.addEventListener('keydown', function (e) {
        // Ctrl+S ä¿å­˜
        if (e.ctrlKey && e.key === 's') {
          e.preventDefault()
          downloadMarkdown()
        }
        // Ctrl+N æ–°å»º
        if (e.ctrlKey && e.key === 'n') {
          e.preventDefault()
          newDocument()
        }
        // Tabé”®æ’å…¥ç©ºæ ¼
        if (e.key === 'Tab') {
          e.preventDefault()
          const start = this.selectionStart
          const end = this.selectionEnd
          this.value =
            this.value.substring(0, start) + '    ' + this.value.substring(end)
          this.setSelectionRange(start + 4, start + 4)
          updatePreview()
        }
      })

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–é¢„è§ˆ
      document.addEventListener('DOMContentLoaded', function () {
        // åˆå§‹åŒ–ç¼–è¾‘å™¨çŠ¶æ€ï¼ˆé»˜è®¤éšè—ï¼‰
        const editorContainer = document.querySelector('.editor-container')
        const toggleBtn = document.getElementById('toggleEditorBtn')

        editorContainer.classList.add('preview-only')
        toggleBtn.textContent = 'ğŸ“ æ˜¾ç¤ºç¼–è¾‘å™¨'

        updatePreview()
        showMessage(
          'Markdownç¼–è¾‘å™¨å·²å°±ç»ª - ç‚¹å‡»"æ˜¾ç¤ºç¼–è¾‘å™¨"å¼€å§‹ç¼–è¾‘',
          'success'
        )
      })

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
      window.addEventListener('DOMContentLoaded', function () {
        // åˆå§‹åŒ–ä»£ç é«˜äº®
        hljs.highlightAll()
        // å¦‚æœæœ‰åˆå§‹å†…å®¹ï¼Œè§¦å‘é¢„è§ˆæ›´æ–°
        if (markdownInput.value.trim()) {
          updatePreview()
        }
      })

      // é˜²æ­¢é¡µé¢åˆ·æ–°ä¸¢å¤±å†…å®¹
      window.addEventListener('beforeunload', function (e) {
        if (markdownInput.value.trim()) {
          e.preventDefault()
          e.returnValue = 'æ‚¨æœ‰æœªä¿å­˜çš„å†…å®¹ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ'
        }
      })
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ™ºèƒ½é¢œè‰²å·¥å…·ç®±</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      }

      :root {
        --primary-color: #007AFF;
        --secondary-color: #5856D6;
        --success-color: #34C759;
        --warning-color: #FF9500;
        --error-color: #FF3B30;
        --background-color: #F2F2F7;
        --card-background: #FFFFFF;
        --text-primary: #000000;
        --text-secondary: #8E8E93;
        --border-color: #C6C6C8;
        --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.1);
        --shadow-medium: 0 4px 12px rgba(0, 0, 0, 0.15);
        --shadow-heavy: 0 8px 25px rgba(0, 0, 0, 0.2);
        --border-radius: 12px;
        --border-radius-large: 20px;
      }

      body {
        background: linear-gradient(135deg, #F2F2F7 0%, #E5E5EA 100%);
        min-height: 100vh;
        padding: 20px;
        color: var(--text-primary);
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
      }

      .header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 8px;
        text-shadow: 0 2px 4px rgba(0, 122, 255, 0.2);
      }

      .header p {
        font-size: 1.1rem;
        color: var(--text-secondary);
        font-weight: 400;
      }

      .main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .card {
        background: var(--card-background);
        border-radius: var(--border-radius-large);
        padding: 30px;
        box-shadow: var(--shadow-medium);
        border: 1px solid rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }

      .card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-heavy);
      }

      .card-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .card-title::before {
        content: '';
        width: 4px;
        height: 20px;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border-radius: 2px;
      }

      /* å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ */
      .image-upload-area {
        border: 2px dashed var(--border-color);
        border-radius: var(--border-radius);
        padding: 40px 20px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        background: linear-gradient(135deg, #FAFAFA 0%, #F5F5F5 100%);
        margin-bottom: 20px;
        position: relative;
        overflow: hidden;
      }

      .image-upload-area:hover {
        border-color: var(--primary-color);
        background: linear-gradient(135deg, #F0F8FF 0%, #E6F3FF 100%);
      }

      .image-upload-area.dragover {
        border-color: var(--primary-color);
        background: linear-gradient(135deg, #E6F3FF 0%, #CCE7FF 100%);
        transform: scale(1.02);
      }

      .upload-icon {
        font-size: 3rem;
        color: var(--text-secondary);
        margin-bottom: 15px;
        transition: all 0.3s ease;
      }

      .image-upload-area:hover .upload-icon {
        color: var(--primary-color);
        transform: scale(1.1);
      }

      .upload-text {
        font-size: 1.1rem;
        color: var(--text-secondary);
        margin-bottom: 10px;
      }

      .upload-hint {
        font-size: 0.9rem;
        color: var(--text-secondary);
        opacity: 0.7;
      }

      #imageInput {
        display: none;
      }

      .image-preview {
        max-width: 100%;
        max-height: 300px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-medium);
        cursor: crosshair;
        display: none;
        transition: transform 0.3s ease;
        transform-origin: center;
      }

      .image-container {
        position: relative;
        display: inline-block;
        max-width: 100%;
        overflow: hidden;
        border-radius: var(--border-radius);
      }

      .color-picker-crosshair {
        position: absolute;
        width: 20px;
        height: 20px;
        border: 2px solid white;
        border-radius: 50%;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.2);
        pointer-events: none;
        transform: translate(-50%, -50%);
        transition: all 0.1s ease;
        display: none;
      }

      /* é¢œè‰²è¾“å…¥åŒºåŸŸ */
      .color-input-group {
        margin-bottom: 25px;
      }

      .color-input-label {
        display: block;
        font-size: 1rem;
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 8px;
      }

      .color-input {
        width: 100%;
        padding: 15px 20px;
        border: 2px solid var(--border-color);
        border-radius: var(--border-radius);
        font-size: 1rem;
        background: #FAFAFA;
        transition: all 0.3s ease;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .color-input:focus {
        outline: none;
        border-color: var(--primary-color);
        background: white;
        box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1), inset 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .color-preview {
        width: 100%;
        height: 120px;
        border-radius: var(--border-radius);
        border: 2px solid var(--border-color);
        margin-bottom: 20px;
        position: relative;
        overflow: hidden;
        box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
        background: linear-gradient(45deg, #ccc 25%, transparent 25%), 
                    linear-gradient(-45deg, #ccc 25%, transparent 25%), 
                    linear-gradient(45deg, transparent 75%, #ccc 75%), 
                    linear-gradient(-45deg, transparent 75%, #ccc 75%);
        background-size: 20px 20px;
        background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
      }

      .color-preview::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--preview-color, #3498db);
        transition: background-color 0.3s ease;
      }

      /* é¢œè‰²é€‰æ‹©å™¨ */
      .color-picker-container {
        margin-bottom: 25px;
      }

      .color-picker-grid {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 15px;
        align-items: center;
      }

      .native-color-picker {
        width: 60px;
        height: 60px;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: var(--shadow-medium);
        transition: all 0.3s ease;
        background: none;
        overflow: hidden;
      }

      .native-color-picker::-webkit-color-swatch-wrapper {
        padding: 0;
        border: 3px solid white;
        border-radius: 50%;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      .native-color-picker::-webkit-color-swatch {
        border: none;
        border-radius: 50%;
      }

      .native-color-picker:hover {
        transform: scale(1.05);
        box-shadow: var(--shadow-heavy);
      }

      /* ç»“æœæ˜¾ç¤ºåŒºåŸŸ */
      .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
      }

      .result-card {
        background: linear-gradient(135deg, #FAFAFA 0%, #F0F0F0 100%);
        border-radius: var(--border-radius);
        padding: 20px;
        border: 1px solid var(--border-color);
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .result-card:hover {
        background: linear-gradient(135deg, #F5F5F5 0%, #EBEBEB 100%);
        transform: translateY(-1px);
      }

      .result-label {
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--text-secondary);
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .result-value {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 15px;
        word-break: break-all;
        font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        background: white;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid rgba(0, 0, 0, 0.1);
      }

      .copy-button {
        width: 100%;
        padding: 10px;
        background: linear-gradient(135deg, var(--primary-color) 0%, #0056CC 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
      }

      .copy-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 122, 255, 0.4);
      }

      .copy-button:active {
        transform: translateY(0);
      }

      .copy-button.copied {
        background: linear-gradient(135deg, var(--success-color) 0%, #28A745 100%);
        box-shadow: 0 2px 8px rgba(52, 199, 89, 0.3);
      }

      /* é¢„è®¾é¢œè‰² */
      .preset-colors {
        margin-top: 25px;
      }

      .preset-title {
        font-size: 1rem;
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 15px;
      }

      .preset-grid {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 10px;
      }

      .preset-color {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        cursor: pointer;
        border: 2px solid white;
        box-shadow: var(--shadow-light);
        transition: all 0.3s ease;
      }

      .preset-color:hover {
        transform: scale(1.1);
        box-shadow: var(--shadow-medium);
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 768px) {
        .main-grid {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .container {
          padding: 0 10px;
        }

        .card {
          padding: 20px;
        }

        .header h1 {
          font-size: 2rem;
        }

        .preset-grid {
          grid-template-columns: repeat(6, 1fr);
        }

        .results-grid {
          grid-template-columns: 1fr;
        }
      }

      /* åŠ¨ç”»æ•ˆæœ */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card {
        animation: fadeIn 0.6s ease-out;
      }

      .card:nth-child(2) {
        animation-delay: 0.1s;
      }

      .card:nth-child(3) {
        animation-delay: 0.2s;
      }

      /* å·¥å…·æç¤º */
      .tooltip {
        position: relative;
      }

      .tooltip::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 0.8rem;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
        z-index: 1000;
      }

      .tooltip:hover::after {
        opacity: 1;
      }

      /* å›¾ç‰‡æ§åˆ¶æŒ‰é’® */
      .image-controls {
        position: absolute;
        top: 10px;
        right: 10px;
        display: none;
        flex-direction: column;
        gap: 8px;
        z-index: 10;
      }

      .image-container:hover .image-controls {
        display: flex;
      }

      .control-btn {
        width: 40px;
        height: 40px;
        border: none;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        color: var(--text-primary);
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .control-btn:hover {
        background: rgba(255, 255, 255, 1);
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .control-btn:active {
        transform: scale(0.95);
      }

      .clear-btn:hover {
        background: rgba(255, 59, 48, 0.1);
        color: var(--error-color);
      }

      .control-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
      }

      .control-btn:disabled:hover {
        background: rgba(255, 255, 255, 0.9);
        transform: none !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      /* é¢œè‰²æ»‘å— */
      .color-picker-sliders {
        margin-top: 20px;
      }

      .color-picker-slider {
        position: relative;
        height: 20px;
        border-radius: 10px;
        cursor: pointer;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        border: 2px solid white;
        overflow: hidden;
      }

      .color-picker-slider-cursor {
        position: absolute;
        top: -2px;
        width: 20px;
        height: 24px;
        background: white;
        border: 2px solid #333;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        transform: translateX(-50%);
        transition: all 0.1s ease;
      }

      .color-picker-slider-cursor:hover {
        transform: translateX(-50%) scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ¨ æ™ºèƒ½é¢œè‰²å·¥å…·ç®±</h1>
        <p>å›¾ç‰‡å–è‰² Â· é¢œè‰²è½¬æ¢ Â· å®æ—¶é¢„è§ˆ</p>
      </div>

      <div class="main-grid">
        <!-- å·¦ä¾§ï¼šå›¾ç‰‡ä¸Šä¼ å’Œé¢œè‰²è¾“å…¥ -->
        <div class="card">
          <h2 class="card-title">ğŸ“¸ å›¾ç‰‡å–è‰²å™¨</h2>
          
          <div class="image-upload-area" id="uploadArea">
            <div class="upload-icon">ğŸ“</div>
            <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡</div>
            <div class="upload-hint">æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼</div>
            <input type="file" id="imageInput" accept="image/*">
          </div>

          <div class="image-container" id="imageContainer">
            <img id="imagePreview" class="image-preview" alt="é¢„è§ˆå›¾ç‰‡">
            <div class="color-picker-crosshair" id="crosshair"></div>
            <div class="image-controls" id="imageControls">
              <button class="control-btn zoom-in-btn" id="zoomInBtn" title="æ”¾å¤§å›¾ç‰‡">ğŸ”+</button>
              <button class="control-btn zoom-out-btn" id="zoomOutBtn" title="ç¼©å°å›¾ç‰‡">ğŸ”-</button>
              <button class="control-btn reset-zoom-btn" id="resetZoomBtn" title="é‡ç½®ç¼©æ”¾">â†»</button>
              <button class="control-btn clear-btn" id="clearImageBtn" title="æ¸…é™¤å›¾ç‰‡">ğŸ—‘ï¸</button>
            </div>
          </div>

          <div class="color-input-group">
            <label class="color-input-label" for="colorInput">ğŸ¯ é¢œè‰²å€¼è¾“å…¥</label>
            <input 
              type="text" 
              id="colorInput" 
              class="color-input" 
              placeholder="è¾“å…¥é¢œè‰²å€¼ï¼Œå¦‚ #3498db, rgb(52,152,219), hsl(204,70%,53%)"
            >
          </div>

          <div class="color-picker-container">
            <div class="color-picker-grid">
              <div>
                <label class="color-input-label">ğŸ¨ é¢œè‰²é€‰æ‹©å™¨</label>
                <div class="color-preview" id="colorPreview"></div>
              </div>
              <input 
                type="color" 
                id="nativeColorPicker" 
                class="native-color-picker tooltip" 
                value="#3498db"
                data-tooltip="ç‚¹å‡»é€‰æ‹©é¢œè‰²"
              >
            </div>
            
            <div class="color-picker-sliders">
              <div 
                class="color-picker-slider" 
                id="hueSlider" 
                style="
                  background: linear-gradient(
                    to right,
                    #ff0000,
                    #ffff00,
                    #00ff00,
                    #00ffff,
                    #0000ff,
                    #ff00ff,
                    #ff0000
                  );
                "
              >
                <div class="color-picker-slider-cursor" id="hueCursor"></div>
              </div>
            </div>
          </div>

          <div class="preset-colors">
            <div class="preset-title">ğŸŒˆ é¢„è®¾é¢œè‰²</div>
            <div class="preset-grid">
              <div class="preset-color" style="background-color: #FF6B6B;" data-color="#FF6B6B"></div>
              <div class="preset-color" style="background-color: #4ECDC4;" data-color="#4ECDC4"></div>
              <div class="preset-color" style="background-color: #45B7D1;" data-color="#45B7D1"></div>
              <div class="preset-color" style="background-color: #96CEB4;" data-color="#96CEB4"></div>
              <div class="preset-color" style="background-color: #FFEAA7;" data-color="#FFEAA7"></div>
              <div class="preset-color" style="background-color: #DDA0DD;" data-color="#DDA0DD"></div>
              <div class="preset-color" style="background-color: #98D8C8;" data-color="#98D8C8"></div>
              <div class="preset-color" style="background-color: #F7DC6F;" data-color="#F7DC6F"></div>
              <div class="preset-color" style="background-color: #BB8FCE;" data-color="#BB8FCE"></div>
              <div class="preset-color" style="background-color: #85C1E9;" data-color="#85C1E9"></div>
              <div class="preset-color" style="background-color: #F8C471;" data-color="#F8C471"></div>
              <div class="preset-color" style="background-color: #82E0AA;" data-color="#82E0AA"></div>
              <div class="preset-color" style="background-color: #E8DAEF;" data-color="#E8DAEF"></div>
              <div class="preset-color" style="background-color: #D5DBDB;" data-color="#D5DBDB"></div>
              <div class="preset-color" style="background-color: #2C3E50;" data-color="#2C3E50"></div>
              <div class="preset-color" style="background-color: #E74C3C;" data-color="#E74C3C"></div>
            </div>
          </div>
        </div>

        <!-- å³ä¾§ï¼šé¢œè‰²æ ¼å¼è½¬æ¢ç»“æœ -->
        <div class="card">
          <h2 class="card-title">ğŸ”„ æ ¼å¼è½¬æ¢ç»“æœ</h2>
          
          <div class="results-grid">
            <div class="result-card">
              <div class="result-label">HEX åå…­è¿›åˆ¶</div>
              <div class="result-value" id="hexResult">#3498DB</div>
              <button class="copy-button" data-target="hexResult">å¤åˆ¶ HEX</button>
            </div>

            <div class="result-card">
              <div class="result-label">RGB çº¢ç»¿è“</div>
              <div class="result-value" id="rgbResult">rgb(52, 152, 219)</div>
              <button class="copy-button" data-target="rgbResult">å¤åˆ¶ RGB</button>
            </div>

            <div class="result-card">
              <div class="result-label">RGBA å¸¦é€æ˜åº¦</div>
              <div class="result-value" id="rgbaResult">rgba(52, 152, 219, 1)</div>
              <button class="copy-button" data-target="rgbaResult">å¤åˆ¶ RGBA</button>
            </div>

            <div class="result-card">
              <div class="result-label">HSL è‰²ç›¸é¥±å’Œåº¦</div>
              <div class="result-value" id="hslResult">hsl(204, 70%, 53%)</div>
              <button class="copy-button" data-target="hslResult">å¤åˆ¶ HSL</button>
            </div>

            <div class="result-card">
              <div class="result-label">HSLA å¸¦é€æ˜åº¦</div>
              <div class="result-value" id="hslaResult">hsla(204, 70%, 53%, 1)</div>
              <button class="copy-button" data-target="hslaResult">å¤åˆ¶ HSLA</button>
            </div>

            <div class="result-card">
              <div class="result-label">HSV è‰²ç›¸é¥±å’Œåº¦æ˜åº¦</div>
              <div class="result-value" id="hsvResult">hsv(204, 76%, 86%)</div>
              <button class="copy-button" data-target="hsvResult">å¤åˆ¶ HSV</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      class ColorToolbox {
        constructor() {
          this.initElements();
          this.initEventListeners();
          this.updateColor('#3498db');
        }

        initElements() {
          // å›¾ç‰‡ç›¸å…³å…ƒç´ 
          this.uploadArea = document.getElementById('uploadArea');
          this.imageInput = document.getElementById('imageInput');
          this.imagePreview = document.getElementById('imagePreview');
          this.imageContainer = document.getElementById('imageContainer');
          this.crosshair = document.getElementById('crosshair');
          this.imageControls = document.getElementById('imageControls');
          this.zoomInBtn = document.getElementById('zoomInBtn');
          this.zoomOutBtn = document.getElementById('zoomOutBtn');
          this.resetZoomBtn = document.getElementById('resetZoomBtn');
          this.clearImageBtn = document.getElementById('clearImageBtn');
          
          // ç¼©æ”¾ç›¸å…³å˜é‡
          this.currentZoom = 1;
          this.minZoom = 0.5;
          this.maxZoom = 3;
          this.zoomStep = 0.2;
          
          // é¢œè‰²è¾“å…¥å…ƒç´ 
          this.colorInput = document.getElementById('colorInput');
          this.nativeColorPicker = document.getElementById('nativeColorPicker');
          this.colorPreview = document.getElementById('colorPreview');
          
          // è‰²ç›¸æ»‘å—å…ƒç´ 
          this.hueSlider = document.getElementById('hueSlider');
          this.hueCursor = document.getElementById('hueCursor');
          
          // å½“å‰é¢œè‰²çš„HSLå€¼
          this.currentHSL = { h: 204, s: 70, l: 53 };
          
          // ç»“æœæ˜¾ç¤ºå…ƒç´ 
          this.hexResult = document.getElementById('hexResult');
          this.rgbResult = document.getElementById('rgbResult');
          this.rgbaResult = document.getElementById('rgbaResult');
          this.hslResult = document.getElementById('hslResult');
          this.hslaResult = document.getElementById('hslaResult');
          this.hsvResult = document.getElementById('hsvResult');
          
          // é¢„è®¾é¢œè‰²
          this.presetColors = document.querySelectorAll('.preset-color');
          
          // å¤åˆ¶æŒ‰é’®
          this.copyButtons = document.querySelectorAll('.copy-button');
        }

        initEventListeners() {
          // å›¾ç‰‡ä¸Šä¼ äº‹ä»¶
          this.uploadArea.addEventListener('click', () => this.imageInput.click());
          this.imageInput.addEventListener('change', (e) => this.handleImageUpload(e));
          
          // æ‹–æ‹½ä¸Šä¼ 
          this.uploadArea.addEventListener('dragover', (e) => this.handleDragOver(e));
          this.uploadArea.addEventListener('dragleave', (e) => this.handleDragLeave(e));
          this.uploadArea.addEventListener('drop', (e) => this.handleDrop(e));
          
          // å›¾ç‰‡ç‚¹å‡»å–è‰²
          this.imagePreview.addEventListener('click', (e) => this.handleImageClick(e));
          this.imagePreview.addEventListener('mousemove', (e) => this.handleImageMouseMove(e));
          this.imagePreview.addEventListener('mouseleave', () => this.hideCrosshair());
          
          // é¢œè‰²è¾“å…¥
          this.colorInput.addEventListener('input', (e) => this.handleColorInput(e));
          this.nativeColorPicker.addEventListener('input', (e) => this.updateColor(e.target.value));
          
          // é¢„è®¾é¢œè‰²ç‚¹å‡»
          this.presetColors.forEach(preset => {
            preset.addEventListener('click', () => {
              const color = preset.dataset.color;
              this.updateColor(color);
            });
          });
          
          // å¤åˆ¶æŒ‰é’®
          this.copyButtons.forEach(button => {
            button.addEventListener('click', (e) => this.handleCopy(e));
          });
          
          // å›¾ç‰‡æ§åˆ¶æŒ‰é’®
          this.zoomInBtn.addEventListener('click', () => this.zoomIn());
          this.zoomOutBtn.addEventListener('click', () => this.zoomOut());
          this.resetZoomBtn.addEventListener('click', () => this.resetZoom());
          this.clearImageBtn.addEventListener('click', () => this.clearImage());
          
          // è‰²ç›¸æ»‘å—äº‹ä»¶
          this.hueSlider.addEventListener('mousedown', (e) => this.handleHueSliderStart(e));
          this.hueSlider.addEventListener('click', (e) => this.handleHueSliderClick(e));
        }

        handleImageUpload(e) {
          const file = e.target.files[0];
          if (file && file.type.startsWith('image/')) {
            this.loadImage(file);
          }
        }

        handleDragOver(e) {
          e.preventDefault();
          this.uploadArea.classList.add('dragover');
        }

        handleDragLeave(e) {
          e.preventDefault();
          this.uploadArea.classList.remove('dragover');
        }

        handleDrop(e) {
          e.preventDefault();
          this.uploadArea.classList.remove('dragover');
          
          const files = e.dataTransfer.files;
          if (files.length > 0 && files[0].type.startsWith('image/')) {
            this.loadImage(files[0]);
          }
        }

        loadImage(file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            this.imagePreview.src = e.target.result;
            this.imagePreview.style.display = 'block';
            this.uploadArea.style.display = 'none';
            
            // é‡ç½®ç¼©æ”¾
            this.currentZoom = 1;
            this.applyZoom();
            
            // æ˜¾ç¤ºæ§åˆ¶æŒ‰é’®
            this.imageControls.style.display = 'flex';
          };
          reader.readAsDataURL(file);
        }

        handleImageClick(e) {
          const rect = this.imagePreview.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          
          // è·å–å›¾ç‰‡ä¸Šçš„é¢œè‰²
          const color = this.getColorFromImage(x, y);
          if (color) {
            this.updateColor(color);
            this.showCrosshair(x, y);
          }
        }

        handleImageMouseMove(e) {
          const rect = this.imagePreview.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          this.showCrosshair(x, y);
        }

        showCrosshair(x, y) {
          this.crosshair.style.display = 'block';
          
          // è®¡ç®—å›¾ç‰‡çš„å®é™…æ˜¾ç¤ºåŒºåŸŸ
          const imageRect = this.imagePreview.getBoundingClientRect();
          const containerRect = this.imageContainer.getBoundingClientRect();
          
          // è®¡ç®—å›¾ç‰‡åœ¨å®¹å™¨ä¸­çš„åç§»ï¼ˆè€ƒè™‘ç¼©æ”¾åçš„å±…ä¸­æ•ˆæœï¼‰
          const imageOffsetX = (containerRect.width - imageRect.width) / 2;
          const imageOffsetY = (containerRect.height - imageRect.height) / 2;
          
          // è®¾ç½®åå­—å‡†æ˜Ÿä½ç½®ï¼ˆç›¸å¯¹äºå®¹å™¨ï¼‰
          this.crosshair.style.left = (imageOffsetX + x) + 'px';
          this.crosshair.style.top = (imageOffsetY + y) + 'px';
        }

        hideCrosshair() {
          this.crosshair.style.display = 'none';
        }

        getColorFromImage(x, y) {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          
          canvas.width = this.imagePreview.naturalWidth;
          canvas.height = this.imagePreview.naturalHeight;
          
          ctx.drawImage(this.imagePreview, 0, 0);
          
          // è®¡ç®—å®é™…å›¾ç‰‡åæ ‡ï¼Œè€ƒè™‘ç¼©æ”¾æ¯”ä¾‹
          const scaleX = this.imagePreview.naturalWidth / (this.imagePreview.offsetWidth * this.currentZoom);
          const scaleY = this.imagePreview.naturalHeight / (this.imagePreview.offsetHeight * this.currentZoom);
          
          const actualX = Math.floor(x * scaleX);
          const actualY = Math.floor(y * scaleY);
          
          try {
            const imageData = ctx.getImageData(actualX, actualY, 1, 1);
            const [r, g, b] = imageData.data;
            return `rgb(${r}, ${g}, ${b})`;
          } catch (error) {
            console.error('æ— æ³•è·å–å›¾ç‰‡é¢œè‰²:', error);
            return null;
          }
        }

        handleColorInput(e) {
          const value = e.target.value.trim();
          if (value) {
            this.updateColor(value);
          }
        }

        updateColor(colorValue) {
          try {
            const color = this.parseColor(colorValue);
            if (!color) return;
            
            // æ›´æ–°å½“å‰HSLå€¼
            this.currentHSL = { h: color.h, s: color.s, l: color.l };
            
            // æ›´æ–°é¢„è§ˆ
            this.colorPreview.style.setProperty('--preview-color', color.hex);
            this.nativeColorPicker.value = color.hex;
            this.colorInput.value = color.hex;
            
            // æ›´æ–°è‰²ç›¸æ»‘å—ä½ç½®
            const huePercentage = this.currentHSL.h / 360;
            this.hueCursor.style.left = `${huePercentage * 100}%`;
            
            // æ›´æ–°æ‰€æœ‰æ ¼å¼
            this.hexResult.textContent = color.hex;
            this.rgbResult.textContent = `rgb(${color.r}, ${color.g}, ${color.b})`;
            this.rgbaResult.textContent = `rgba(${color.r}, ${color.g}, ${color.b}, 1)`;
            this.hslResult.textContent = `hsl(${color.h}, ${color.s}%, ${color.l}%)`;
            this.hslaResult.textContent = `hsla(${color.h}, ${color.s}%, ${color.l}%, 1)`;
            this.hsvResult.textContent = `hsv(${color.h}, ${color.sv}%, ${color.v}%)`;
            
          } catch (error) {
            console.error('é¢œè‰²è§£æé”™è¯¯:', error);
          }
        }

        parseColor(colorValue) {
          // åˆ›å»ºä¸´æ—¶å…ƒç´ æ¥è§£æé¢œè‰²
          const tempDiv = document.createElement('div');
          tempDiv.style.color = colorValue;
          document.body.appendChild(tempDiv);
          
          const computedColor = window.getComputedStyle(tempDiv).color;
          document.body.removeChild(tempDiv);
          
          if (computedColor === 'rgba(0, 0, 0, 0)' || computedColor === 'transparent') {
            return null;
          }
          
          // è§£æ RGB å€¼
          const rgbMatch = computedColor.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
          if (!rgbMatch) return null;
          
          const r = parseInt(rgbMatch[1]);
          const g = parseInt(rgbMatch[2]);
          const b = parseInt(rgbMatch[3]);
          
          // è½¬æ¢ä¸ºå…¶ä»–æ ¼å¼
          const hex = this.rgbToHex(r, g, b);
          const hsl = this.rgbToHsl(r, g, b);
          const hsv = this.rgbToHsv(r, g, b);
          
          return {
            r, g, b,
            hex,
            h: hsl.h,
            s: hsl.s,
            l: hsl.l,
            sv: hsv.s,
            v: hsv.v
          };
        }

        rgbToHex(r, g, b) {
          return '#' + [r, g, b].map(x => {
            const hex = x.toString(16);
            return hex.length === 1 ? '0' + hex : hex;
          }).join('');
        }

        rgbToHsl(r, g, b) {
          r /= 255;
          g /= 255;
          b /= 255;
          
          const max = Math.max(r, g, b);
          const min = Math.min(r, g, b);
          let h, s, l = (max + min) / 2;
          
          if (max === min) {
            h = s = 0;
          } else {
            const d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            
            switch (max) {
              case r: h = (g - b) / d + (g < b ? 6 : 0); break;
              case g: h = (b - r) / d + 2; break;
              case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
          }
          
          return {
            h: Math.round(h * 360),
            s: Math.round(s * 100),
            l: Math.round(l * 100)
          };
        }

        rgbToHsv(r, g, b) {
          r /= 255;
          g /= 255;
          b /= 255;
          
          const max = Math.max(r, g, b);
          const min = Math.min(r, g, b);
          let h, s, v = max;
          
          const d = max - min;
          s = max === 0 ? 0 : d / max;
          
          if (max === min) {
            h = 0;
          } else {
            switch (max) {
              case r: h = (g - b) / d + (g < b ? 6 : 0); break;
              case g: h = (b - r) / d + 2; break;
              case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
          }
          
          return {
            h: Math.round(h * 360),
            s: Math.round(s * 100),
            v: Math.round(v * 100)
          };
        }

        async handleCopy(e) {
          const button = e.target;
          const targetId = button.dataset.target;
          const text = document.getElementById(targetId).textContent;
          
          try {
            await navigator.clipboard.writeText(text);
            
            // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸçŠ¶æ€
            const originalText = button.textContent;
            button.textContent = 'âœ“ å·²å¤åˆ¶';
            button.classList.add('copied');
            
            setTimeout(() => {
              button.textContent = originalText;
              button.classList.remove('copied');
            }, 2000);
            
          } catch (error) {
            console.error('å¤åˆ¶å¤±è´¥:', error);
            
            // é™çº§æ–¹æ¡ˆ
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            button.textContent = 'âœ“ å·²å¤åˆ¶';
            button.classList.add('copied');
            
            setTimeout(() => {
              button.textContent = button.textContent.replace('âœ“ å·²å¤åˆ¶', 'å¤åˆ¶');
              button.classList.remove('copied');
            }, 2000);
          }
        }

        // å›¾ç‰‡ç¼©æ”¾åŠŸèƒ½
        zoomIn() {
          if (this.currentZoom < this.maxZoom) {
            this.currentZoom += this.zoomStep;
            this.applyZoom();
          }
        }

        zoomOut() {
          if (this.currentZoom > this.minZoom) {
            this.currentZoom -= this.zoomStep;
            this.applyZoom();
          }
        }

        resetZoom() {
          this.currentZoom = 1;
          this.applyZoom();
        }

        applyZoom() {
          this.imagePreview.style.transform = `scale(${this.currentZoom})`;
          // æ›´æ–°æŒ‰é’®çŠ¶æ€
          this.zoomInBtn.disabled = this.currentZoom >= this.maxZoom;
          this.zoomOutBtn.disabled = this.currentZoom <= this.minZoom;
        }

        clearImage() {
          // æ¸…é™¤å›¾ç‰‡é¢„è§ˆ
          this.imagePreview.style.display = 'none';
          this.imagePreview.src = '';
          this.imageControls.style.display = 'none';
          
          // é‡ç½®ç¼©æ”¾
          this.currentZoom = 1;
          this.applyZoom();
          
          // æ¸…é™¤æ–‡ä»¶è¾“å…¥
          this.imageInput.value = '';
          
          // éšè—åå­—å‡†æ˜Ÿ
          this.hideCrosshair();
          
          // æ˜¾ç¤ºä¸Šä¼ åŒºåŸŸ
          this.uploadArea.style.display = 'block';
        }
        
        // è‰²ç›¸æ»‘å—åŠŸèƒ½
        handleHueSliderClick(e) {
          const rect = this.hueSlider.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const percentage = Math.max(0, Math.min(1, x / rect.width));
          this.updateHue(percentage * 360);
        }
        
        handleHueSliderStart(e) {
          e.preventDefault();
          this.isDraggingHue = true;
          
          const handleMouseMove = (e) => {
            if (this.isDraggingHue) {
              const rect = this.hueSlider.getBoundingClientRect();
              const x = e.clientX - rect.left;
              const percentage = Math.max(0, Math.min(1, x / rect.width));
              this.updateHue(percentage * 360);
            }
          };
          
          const handleMouseUp = () => {
            this.isDraggingHue = false;
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseUp);
          };
          
          document.addEventListener('mousemove', handleMouseMove);
          document.addEventListener('mouseup', handleMouseUp);
          
          // ç«‹å³å¤„ç†å½“å‰ä½ç½®
          this.handleHueSliderClick(e);
        }
        
        updateHue(hue) {
          this.currentHSL.h = hue;
          const hslColor = `hsl(${this.currentHSL.h}, ${this.currentHSL.s}%, ${this.currentHSL.l}%)`;
          const hexColor = this.hslToHex(this.currentHSL.h, this.currentHSL.s, this.currentHSL.l);
          
          // æ›´æ–°æ»‘å—æ¸¸æ ‡ä½ç½®
          const percentage = hue / 360;
          this.hueCursor.style.left = `${percentage * 100}%`;
          
          // æ›´æ–°é¢œè‰²
          this.updateColor(hexColor);
        }
        
        // HSLè½¬HEX
        hslToHex(h, s, l) {
          l /= 100;
          const a = s * Math.min(l, 1 - l) / 100;
          const f = n => {
            const k = (n + h / 30) % 12;
            const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
            return Math.round(255 * color).toString(16).padStart(2, '0');
          };
          return `#${f(0)}${f(8)}${f(4)}`;
        }
      }

      // åˆå§‹åŒ–åº”ç”¨
      document.addEventListener('DOMContentLoaded', () => {
        new ColorToolbox();
      });
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç½‘é¡µç‰ˆå¤šæ®µè§†é¢‘å‰ªè¾‘å·¥å…·</title>
    <script src="./ffmpeg.min.js"></script>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: 'SF Pro Display', 'PingFang SC', 'Helvetica Neue', Arial,
          sans-serif;
      }

      :root {
        --primary-bg: #e6e7ee;
        --secondary-bg: #ffffff;
        --shadow-light: #ffffff;
        --shadow-dark: #d1d9e6;
        --accent-color: #667eea;
        --accent-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-color: #4ecdc4;
        --danger-color: #ff6b6b;
        --warning-color: #feca57;
        --text-primary: #2d3748;
        --text-secondary: #718096;
        --glass-bg: rgba(255, 255, 255, 0.25);
        --glass-border: rgba(255, 255, 255, 0.18);
      }

      body {
        background: var(--primary-bg);
        color: var(--text-primary);
        min-height: 100vh;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: all 0.3s ease;
        animation: pageLoad 0.8s ease;
      }

      @keyframes pageLoad {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .container {
        width: 100%;
        max-width: 1200px;
        background: var(--primary-bg);
        border-radius: 30px;
        padding: 40px;
        box-shadow: 20px 20px 60px var(--shadow-dark),
          -20px -20px 60px var(--shadow-light);
        margin-top: 20px;
        transition: all 0.3s ease;
        animation: containerFloat 1s ease 0.2s both;
      }

      @keyframes containerFloat {
        from {
          opacity: 0;
          transform: translateY(30px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .container:hover {
        box-shadow: 25px 25px 70px var(--shadow-dark),
          -25px -25px 70px var(--shadow-light);
      }

      /* æ‹Ÿæ€é£æ ¼å¡ç‰‡ */
      .neumorphic-card {
        background: var(--primary-bg);
        border-radius: 25px;
        box-shadow: 12px 12px 24px var(--shadow-dark),
          -12px -12px 24px var(--shadow-light);
        transition: all 0.3s ease;
      }

      .neumorphic-inset {
        background: var(--primary-bg);
        border-radius: 20px;
        box-shadow: inset 8px 8px 16px var(--shadow-dark),
          inset -8px -8px 16px var(--shadow-light);
        transition: all 0.3s ease;
      }

      /* ç»ç’ƒæ€æ•ˆæœ */
      .glass-effect {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
      }

      header {
        text-align: center;
        margin-bottom: 40px;
        padding: 30px;
        background: var(--primary-bg);
        border-radius: 25px;
        box-shadow: 10px 10px 20px var(--shadow-dark),
          -10px -10px 20px var(--shadow-light);
        animation: headerSlide 0.8s ease 0.4s both;
      }

      @keyframes headerSlide {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h1 {
        font-size: 3.2rem;
        margin-bottom: 15px;
        background: var(--accent-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 700;
        animation: titleGlow 3s ease-in-out infinite alternate;
      }

      @keyframes titleGlow {
        from {
          filter: brightness(1);
        }
        to {
          filter: brightness(1.2);
        }
      }

      .subtitle {
        font-size: 1.3rem;
        color: var(--text-secondary);
        margin-bottom: 30px;
        font-weight: 500;
      }

      .panels {
        display: flex;
        gap: 30px;
        margin-bottom: 40px;
        animation: panelsSlide 0.8s ease 0.6s both;
      }

      @keyframes panelsSlide {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .panel {
        flex: 1;
        background: var(--primary-bg);
        border-radius: 25px;
        padding: 30px;
        box-shadow: 12px 12px 24px var(--shadow-dark),
          -12px -12px 24px var(--shadow-light);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .panel::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transition: left 0.8s;
      }

      .panel:hover::before {
        left: 100%;
      }

      .panel:hover {
        transform: translateY(-5px);
        box-shadow: 16px 16px 32px var(--shadow-dark),
          -16px -16px 32px var(--shadow-light);
      }

      .panel-title {
        font-size: 1.6rem;
        margin-bottom: 25px;
        color: var(--accent-color);
        display: flex;
        align-items: center;
        font-weight: 600;
      }

      .panel-title::before {
        content: attr(data-icon);
        margin-right: 12px;
        font-size: 1.8rem;
        animation: iconBounce 2s ease-in-out infinite;
      }

      @keyframes iconBounce {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      .file-upload {
        border: 3px dashed var(--accent-color);
        border-radius: 25px;
        padding: 50px 40px;
        text-align: center;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        margin-bottom: 25px;
        cursor: pointer;
        background: var(--primary-bg);
        box-shadow: inset 8px 8px 16px var(--shadow-dark),
          inset -8px -8px 16px var(--shadow-light);
        position: relative;
        overflow: hidden;
      }

      .file-upload::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: var(--accent-gradient);
        border-radius: 25px;
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: -1;
      }

      .file-upload::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.6s ease;
        pointer-events: none;
      }

      .file-upload:hover {
        border-color: var(--success-color);
        transform: translateY(-5px) scale(1.02);
        box-shadow: inset 10px 10px 20px var(--shadow-dark),
          inset -10px -10px 20px var(--shadow-light),
          0 15px 40px rgba(102, 126, 234, 0.25),
          0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .file-upload:hover::before {
        opacity: 0.1;
      }

      .file-upload:hover::after {
        width: 300px;
        height: 300px;
      }

      .file-upload.dragover {
        border-color: var(--success-color);
        background: rgba(78, 205, 196, 0.05);
        transform: scale(1.05);
        box-shadow: inset 12px 12px 24px var(--shadow-dark),
          inset -12px -12px 24px var(--shadow-light),
          0 20px 50px rgba(78, 205, 196, 0.3);
        animation: dragPulse 1s ease-in-out infinite;
      }

      @keyframes dragPulse {
        0%, 100% {
          border-color: var(--success-color);
        }
        50% {
          border-color: var(--accent-color);
        }
      }

      .file-upload-content {
        position: relative;
        z-index: 1;
      }

      .file-upload-icon {
        font-size: 3.5rem;
        margin-bottom: 20px;
        display: block;
        animation: iconFloat 3s ease-in-out infinite;
        filter: drop-shadow(0 4px 8px rgba(102, 126, 234, 0.2));
      }

      @keyframes iconFloat {
        0%, 100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .file-upload-text {
        font-size: 1.4rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 10px;
        background: var(--accent-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .file-upload-subtext {
        font-size: 1.1rem;
        color: var(--text-secondary);
        margin-bottom: 20px;
        font-weight: 500;
      }

      .file-upload-formats {
        font-size: 0.9rem;
        color: var(--accent-color);
        font-weight: 500;
        padding: 8px 16px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 20px;
        display: inline-block;
        margin-bottom: 20px;
      }

      .file-upload input[type='file'] {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        opacity: 0;
        cursor: pointer;
        z-index: 2;
      }

      .video-preview {
        width: 100%;
        background: var(--primary-bg);
        border-radius: 20px;
        overflow: hidden;
        margin-top: 20px;
        box-shadow: inset 10px 10px 20px var(--shadow-dark),
          inset -10px -10px 20px var(--shadow-light);
        transition: all 0.3s ease;
      }

      .video-preview:hover {
        box-shadow: inset 12px 12px 24px var(--shadow-dark),
          inset -12px -12px 24px var(--shadow-light);
      }

      video {
        width: 100%;
        max-height: 300px;
        display: block;
        border-radius: 15px;
      }

      .segment-form {
        display: flex;
        gap: 20px;
        margin-bottom: 25px;
        flex-wrap: wrap;
        align-items: flex-end;
      }

      .form-group {
        flex: 1;
        min-width: 150px;
      }

      label {
        display: block;
        margin-bottom: 10px;
        color: var(--text-secondary);
        font-weight: 500;
        font-size: 0.95rem;
      }

      input {
        width: 100%;
        padding: 14px 18px;
        background: var(--primary-bg);
        border: none;
        border-radius: 15px;
        color: var(--text-primary);
        font-size: 1rem;
        font-weight: 500;
        box-shadow: inset 6px 6px 12px var(--shadow-dark),
          inset -6px -6px 12px var(--shadow-light);
        transition: all 0.3s ease;
      }

      input:focus {
        outline: none;
        box-shadow: inset 8px 8px 16px var(--shadow-dark),
          inset -8px -8px 16px var(--shadow-light),
          0 0 0 3px rgba(102, 126, 234, 0.2);
      }

      button {
        background: var(--primary-bg);
        color: var(--text-primary);
        border: none;
        padding: 14px 28px;
        border-radius: 15px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        font-size: 1rem;
        flex-shrink: 0;
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light);
        position: relative;
        overflow: hidden;
      }

      button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      button:hover::before {
        left: 100%;
      }

      button:hover {
        transform: translateY(-3px);
        box-shadow: 12px 12px 24px var(--shadow-dark),
          -12px -12px 24px var(--shadow-light);
      }

      button:active {
        transform: translateY(0);
        box-shadow: inset 6px 6px 12px var(--shadow-dark),
          inset -6px -6px 12px var(--shadow-light);
      }

      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
        box-shadow: 4px 4px 8px var(--shadow-dark),
          -4px -4px 8px var(--shadow-light);
      }

      .btn-primary {
        background: var(--accent-gradient);
        color: white;
        padding: 16px 32px;
        font-size: 1.1rem;
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light),
          inset 0 1px 0 rgba(255, 255, 255, 0.2);
      }

      .btn-primary:hover {
        box-shadow: 12px 12px 24px var(--shadow-dark),
          -12px -12px 24px var(--shadow-light),
          inset 0 1px 0 rgba(255, 255, 255, 0.2),
          0 0 30px rgba(102, 126, 234, 0.3);
      }

      .btn-danger {
        background: linear-gradient(
          135deg,
          var(--danger-color) 0%,
          #ee5a52 100%
        );
        color: white;
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light),
          inset 0 1px 0 rgba(255, 255, 255, 0.2);
      }

      .btn-success {
        background: linear-gradient(
          135deg,
          var(--success-color) 0%,
          #44a08d 100%
        );
        color: white;
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light),
          inset 0 1px 0 rgba(255, 255, 255, 0.2);
      }

      .segments-list {
        background: var(--primary-bg);
        border-radius: 20px;
        padding: 20px;
        max-height: 250px;
        overflow-y: auto;
        margin-bottom: 25px;
        box-shadow: inset 10px 10px 20px var(--shadow-dark),
          inset -10px -10px 20px var(--shadow-light);
      }

      .segments-list::-webkit-scrollbar {
        width: 8px;
      }

      .segments-list::-webkit-scrollbar-track {
        background: var(--primary-bg);
        border-radius: 10px;
      }

      .segments-list::-webkit-scrollbar-thumb {
        background: var(--accent-color);
        border-radius: 10px;
      }

      .segment-item {
        display: flex;
        justify-content: space-between;
        padding: 16px 20px;
        background: var(--primary-bg);
        border-radius: 15px;
        margin-bottom: 12px;
        align-items: center;
        box-shadow: 6px 6px 12px var(--shadow-dark),
          -6px -6px 12px var(--shadow-light);
        transition: all 0.3s ease;
        animation: segmentSlideIn 0.5s ease;
      }

      @keyframes segmentSlideIn {
        from {
          opacity: 0;
          transform: translateX(-20px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateX(0) scale(1);
        }
      }

      .segment-item:hover {
        transform: translateY(-2px);
        box-shadow: 8px 8px 16px var(--shadow-dark),
          -8px -8px 16px var(--shadow-light);
      }

      .segment-item:last-child {
        margin-bottom: 0;
      }

      .segment-times {
        font-weight: 600;
        color: var(--accent-color);
        font-size: 1.05rem;
      }

      .segment-actions button {
        padding: 8px 16px;
        font-size: 0.9rem;
        background: linear-gradient(
          135deg,
          var(--danger-color) 0%,
          #ee5a52 100%
        );
        color: white;
        box-shadow: 4px 4px 8px var(--shadow-dark),
          -4px -4px 8px var(--shadow-light);
      }

      .progress-container {
        margin: 30px 0;
        animation: progressSlide 0.8s ease 0.8s both;
      }

      @keyframes progressSlide {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .progress-bar {
        height: 16px;
        background: var(--primary-bg);
        border-radius: 20px;
        overflow: hidden;
        margin-bottom: 15px;
        box-shadow: inset 6px 6px 12px var(--shadow-dark),
          inset -6px -6px 12px var(--shadow-light);
        position: relative;
      }

      .progress-fill {
        height: 100%;
        background: var(--accent-gradient);
        width: 0%;
        transition: width 0.3s ease;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        position: relative;
        overflow: hidden;
      }

      .progress-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: progressShine 2s infinite;
      }

      @keyframes progressShine {
        0% {
          left: -100%;
        }
        100% {
          left: 100%;
        }
      }

      .progress-text {
        text-align: center;
        font-size: 1rem;
        color: var(--text-secondary);
        font-weight: 500;
      }

      .actions {
        display: flex;
        justify-content: center;
        gap: 25px;
        margin-top: 30px;
        animation: actionsSlide 0.8s ease 1s both;
      }

      @keyframes actionsSlide {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .result-panel {
        text-align: center;
        animation: resultPanelSlide 0.8s ease 1.2s both;
      }

      @keyframes resultPanelSlide {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .status-message {
        min-height: 35px;
        margin: 20px 0;
        color: var(--accent-color);
        font-weight: 600;
        font-size: 1.1rem;
        transition: all 0.3s ease;
      }

      .status-message.processing {
        animation: statusPulse 1.5s ease-in-out infinite;
      }

      @keyframes statusPulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.6;
        }
      }

      .error-message {
        color: var(--danger-color);
        margin: 20px 0;
        min-height: 35px;
        font-weight: 600;
        font-size: 1.1rem;
        animation: errorShake 0.5s ease;
      }

      @keyframes errorShake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }

      .instructions {
        background: var(--primary-bg);
        border-radius: 25px;
        padding: 30px;
        margin-top: 40px;
        box-shadow: 10px 10px 20px var(--shadow-dark),
          -10px -10px 20px var(--shadow-light);
        animation: instructionsSlide 0.8s ease 1.4s both;
      }

      @keyframes instructionsSlide {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .instructions h3 {
        color: var(--accent-color);
        margin-bottom: 20px;
        font-size: 1.4rem;
        font-weight: 600;
      }

      .instructions ol {
        padding-left: 25px;
        margin-bottom: 20px;
      }

      .instructions li {
        margin-bottom: 12px;
        line-height: 1.7;
        color: var(--text-secondary);
        font-weight: 500;
      }

      .instructions p {
        color: var(--text-secondary);
        font-style: italic;
        font-weight: 500;
        padding: 15px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 15px;
        border-left: 4px solid var(--accent-color);
      }

      footer {
        margin-top: 40px;
        text-align: center;
        color: var(--text-secondary);
        font-size: 0.95rem;
        padding: 25px;
        background: var(--primary-bg);
        border-radius: 20px;
        box-shadow: 6px 6px 12px var(--shadow-dark),
          -6px -6px 12px var(--shadow-light);
        animation: footerFade 0.8s ease 1.6s both;
      }

      @keyframes footerFade {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 1024px) {
        .container {
          padding: 30px;
          margin: 15px;
        }

        .panels {
          gap: 20px;
        }

        .panel {
          padding: 25px;
        }

        h1 {
          font-size: 2.8rem;
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 15px;
        }

        .container {
          padding: 20px;
          margin: 5px;
          border-radius: 20px;
        }

        header {
          padding: 20px;
          margin-bottom: 25px;
        }

        .panels {
          flex-direction: column;
          gap: 20px;
        }

        .panel {
          padding: 20px;
        }

        .segment-form {
          flex-direction: column;
          align-items: stretch;
          gap: 15px;
        }

        .actions {
          flex-direction: column;
          align-items: center;
          gap: 15px;
        }

        h1 {
          font-size: 2.4rem;
        }

        .subtitle {
          font-size: 1.1rem;
        }

        .panel-title {
          font-size: 1.4rem;
        }

        .file-upload {
          padding: 35px 25px;
        }

        .file-upload-icon {
          font-size: 3rem;
          margin-bottom: 15px;
        }

        .file-upload-text {
          font-size: 1.2rem;
        }

        .file-upload-subtext {
          font-size: 1rem;
          margin-bottom: 15px;
        }

        .file-upload-formats {
          font-size: 0.85rem;
          margin-bottom: 15px;
        }

        button {
          padding: 12px 24px;
          font-size: 0.95rem;
        }

        .btn-primary {
          padding: 14px 28px;
          font-size: 1rem;
        }

        .segments-list {
          max-height: 200px;
        }

        .segment-item {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }

        .segment-actions {
          align-self: flex-end;
        }

        .instructions {
          padding: 20px;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 10px;
        }

        .container {
          padding: 15px;
          margin: 0;
          border-radius: 15px;
        }

        header {
          padding: 15px;
          margin-bottom: 20px;
          border-radius: 15px;
        }

        h1 {
          font-size: 2rem;
        }

        .subtitle {
          font-size: 1rem;
        }

        .panel {
          padding: 15px;
          border-radius: 15px;
        }

        .panel-title {
          font-size: 1.2rem;
          margin-bottom: 15px;
        }

        .panel-title::before {
          font-size: 1.4rem;
          margin-right: 8px;
        }

        .file-upload {
          padding: 25px 20px;
          border-radius: 20px;
        }

        .file-upload-icon {
          font-size: 2.5rem;
          margin-bottom: 12px;
        }

        .file-upload-text {
          font-size: 1.1rem;
          margin-bottom: 8px;
        }

        .file-upload-subtext {
          font-size: 0.9rem;
          margin-bottom: 12px;
        }

        .file-upload-formats {
          font-size: 0.75rem;
          margin-bottom: 12px;
          padding: 6px 12px;
        }



        button {
          padding: 10px 20px;
          font-size: 0.9rem;
          border-radius: 12px;
        }

        .btn-primary {
          padding: 12px 24px;
          font-size: 0.95rem;
        }

        input {
          padding: 12px 16px;
          font-size: 0.95rem;
          border-radius: 12px;
        }

        .video-preview {
          border-radius: 15px;
        }

        video {
          max-height: 200px;
          border-radius: 12px;
        }

        .segments-list {
          padding: 15px;
          border-radius: 15px;
          max-height: 180px;
        }

        .segment-item {
          padding: 12px 15px;
          border-radius: 12px;
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }

        .segment-times {
          font-size: 0.95rem;
        }

        .segment-actions button {
          padding: 6px 12px;
          font-size: 0.8rem;
        }

        .progress-bar {
          height: 12px;
        }

        .instructions {
          padding: 15px;
          border-radius: 15px;
        }

        .instructions h3 {
          font-size: 1.2rem;
        }

        .instructions li {
          font-size: 0.9rem;
        }

        footer {
          padding: 15px;
          border-radius: 15px;
          font-size: 0.85rem;
        }
      }

      /* æš—è‰²æ¨¡å¼æ”¯æŒ */
      @media (prefers-color-scheme: dark) {
        :root {
          --primary-bg: #2d3748;
          --secondary-bg: #1a202c;
          --shadow-light: #4a5568;
          --shadow-dark: #1a202c;
          --text-primary: #f7fafc;
          --text-secondary: #a0aec0;
        }
      }

      /* åŠ¨ç”»ä¼˜åŒ– */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
      ::-webkit-scrollbar {
        width: 12px;
      }

      ::-webkit-scrollbar-track {
        background: var(--primary-bg);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--accent-color);
        border-radius: 10px;
        border: 2px solid var(--primary-bg);
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--accent-gradient);
      }
    </style>
  </head>
  <body>
    <header>
      <h1>ğŸ¬ æ™ºèƒ½è§†é¢‘å‰ªè¾‘å·¥å…·</h1>
      <p class="subtitle">
        åŸºäº FFmpeg.wasm æŠ€æœ¯ - ç›´æ¥åœ¨æµè§ˆå™¨ä¸­å®Œæˆä¸“ä¸šè§†é¢‘å‰ªè¾‘
      </p>
    </header>

    <div class="container">
      <div class="panels">
        <div class="panel">
          <h2 class="panel-title" data-icon="ğŸ“">1. ä¸Šä¼ è§†é¢‘æ–‡ä»¶</h2>
          <div class="file-upload" id="fileDropArea">
            <input type="file" id="videoInput" accept="video/*,audio/*" />
            <div class="file-upload-content">
              <span class="file-upload-icon">ğŸ¬</span>
              <div class="file-upload-text">æ‹–æ”¾è§†é¢‘æ–‡ä»¶åˆ°æ­¤å¤„</div>
              <div class="file-upload-subtext">æˆ–ç‚¹å‡»æ­¤åŒºåŸŸé€‰æ‹©æ–‡ä»¶</div>
              <div class="file-upload-formats">æ”¯æŒ MP4, AVI, MOV, MKV, WebM ç­‰æ ¼å¼</div>
            </div>
          </div>

          <div id="originalPreview" class="video-preview">
            <p
              style="
                text-align: center;
                padding: 60px 20px;
                color: var(--text-secondary);
                font-size: 1.1rem;
              "
            >
              ğŸ“º è§†é¢‘é¢„è§ˆåŒº
            </p>
          </div>
        </div>

        <div class="panel">
          <h2 class="panel-title" data-icon="âœ‚ï¸">2. é€‰æ‹©å‰ªè¾‘ç‰‡æ®µ</h2>
          <div class="segment-form">
            <div class="form-group">
              <label for="startTime">â° å¼€å§‹æ—¶é—´ï¼ˆç§’ï¼‰</label>
              <div style="display: flex; gap: 10px; align-items: flex-end">
                <input
                  type="number"
                  id="startTime"
                  min="0"
                  step="0.1"
                  value="0"
                  placeholder="0.0"
                  style="flex: 1"
                />
                <button
                  id="setCurrentTimeAsStart"
                  style="padding: 14px 16px; font-size: 0.9rem"
                >
                  ğŸ“ å½“å‰æ—¶é—´
                </button>
              </div>
            </div>

            <div class="form-group">
              <label for="endTime">â±ï¸ ç»“æŸæ—¶é—´ï¼ˆç§’ï¼‰</label>
              <div style="display: flex; gap: 10px; align-items: flex-end">
                <input
                  type="number"
                  id="endTime"
                  min="0"
                  step="0.1"
                  value="5"
                  placeholder="5.0"
                  style="flex: 1"
                />
                <button
                  id="setCurrentTimeAsEnd"
                  style="padding: 14px 16px; font-size: 0.9rem"
                >
                  ğŸ“ å½“å‰æ—¶é—´
                </button>
              </div>
            </div>

            <button id="addSegment">â• æ·»åŠ ç‰‡æ®µ</button>
          </div>

          <h3
            style="
              margin-bottom: 15px;
              color: var(--text-primary);
              font-weight: 600;
            "
          >
            ğŸ“‹ å·²æ·»åŠ ç‰‡æ®µï¼š
          </h3>
          <div class="segments-list" id="segmentsList">
            <p
              style="
                text-align: center;
                padding: 20px;
                color: var(--text-secondary);
                font-style: italic;
              "
            >
              ğŸ“­ æš‚æ— æ·»åŠ çš„ç‰‡æ®µ
            </p>
          </div>

          <div class="status-message" id="segmentStatus"></div>
          <div class="error-message" id="segmentError"></div>
        </div>
      </div>

      <div class="panel result-panel">
        <h2 class="panel-title" data-icon="ğŸ¬">3. ç”Ÿæˆå‰ªè¾‘ç»“æœ</h2>

        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-text" id="progressText">ğŸš€ å‡†å¤‡å°±ç»ª</div>
        </div>

        <div class="actions">
          <button id="processBtn" class="btn-primary" disabled>
            ğŸ¯ å¼€å§‹å‰ªè¾‘
          </button>
          <button id="downloadBtn" class="btn-primary" disabled>
            ğŸ“¥ ä¸‹è½½ç»“æœ
          </button>
          <button id="resetBtn">ğŸ”„ é‡ç½®æ‰€æœ‰</button>
        </div>

        <div class="status-message" id="statusMessage"></div>
        <div class="error-message" id="errorMessage"></div>

        <div id="resultPreview" class="video-preview">
          <p
            style="
              text-align: center;
              padding: 60px 20px;
              color: var(--text-secondary);
              font-size: 1.1rem;
            "
          >
            ğŸï¸ å‰ªè¾‘ç»“æœé¢„è§ˆåŒº
          </p>
        </div>
      </div>

      <div class="instructions">
        <h3>ğŸ“– ä½¿ç”¨è¯´æ˜ï¼š</h3>
        <ol>
          <li>ğŸ¥ ä¸Šä¼ è§†é¢‘æˆ–éŸ³é¢‘æ–‡ä»¶ï¼ˆæ”¯æŒMP4ã€MOVã€AVIã€MP3ç­‰æ ¼å¼ï¼‰</li>
          <li>â° è®¾ç½®å‰ªè¾‘çš„å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ï¼Œç‚¹å‡»"æ·»åŠ ç‰‡æ®µ"</li>
          <li>ğŸ“ å¯æ·»åŠ å¤šä¸ªä¸é‡å çš„æ—¶é—´ç‰‡æ®µï¼ˆç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶é˜»æ­¢é‡å ç‰‡æ®µï¼‰</li>
          <li>
            ğŸ¯ ç‚¹å‡»"å¼€å§‹å‰ªè¾‘"æŒ‰é’®å¤„ç†è§†é¢‘ï¼ˆå¤„ç†æ—¶é—´å–å†³äºè§†é¢‘å¤§å°å’Œç‰‡æ®µæ•°é‡ï¼‰
          </li>
          <li>ğŸ“¥ å¤„ç†å®Œæˆåç‚¹å‡»"ä¸‹è½½ç»“æœ"ä¿å­˜å‰ªè¾‘åçš„è§†é¢‘</li>
        </ol>
        <p>
          ğŸ”’
          æ³¨æ„ï¼šæœ¬å·¥å…·å®Œå…¨åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œä¸ä¼šä¸Šä¼ æ‚¨çš„è§†é¢‘æ–‡ä»¶ï¼Œç¡®ä¿éšç§å®‰å…¨ã€‚
        </p>
      </div>
    </div>

    <footer>
      <p>
        âš¡ åŸºäº FFmpeg.wasm æŠ€æœ¯å®ç° | ğŸŒ å®Œå…¨åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ | ğŸ”
        æ— éœ€ä¸Šä¼ åˆ°æœåŠ¡å™¨
      </p>
      <p>Â© 2025 æ™ºèƒ½è§†é¢‘å‰ªè¾‘å·¥å…·</p>
    </footer>

    <script>
      // FFmpegå®ä¾‹
      let ffmpeg = null
      let inputFile = null
      let videoUrl = null
      let outputBlob = null
      let segments = []

      // DOMå…ƒç´ 
      const videoInput = document.getElementById('videoInput')
      const startTimeInput = document.getElementById('startTime')
      const endTimeInput = document.getElementById('endTime')
      const addSegmentBtn = document.getElementById('addSegment')

      const segmentsList = document.getElementById('segmentsList')
      const segmentStatus = document.getElementById('segmentStatus')
      const segmentError = document.getElementById('segmentError')
      const processBtn = document.getElementById('processBtn')
      const downloadBtn = document.getElementById('downloadBtn')
      const resetBtn = document.getElementById('resetBtn')
      const statusMessage = document.getElementById('statusMessage')
      const errorMessage = document.getElementById('errorMessage')
      const progressFill = document.getElementById('progressFill')
      const progressText = document.getElementById('progressText')
      const originalPreview = document.getElementById('originalPreview')
      const resultPreview = document.getElementById('resultPreview')

      // é¡µé¢åŠ è½½åŠ¨ç”»
      window.addEventListener('DOMContentLoaded', () => {
        document.body.style.opacity = '0'
        setTimeout(() => {
          document.body.style.transition = 'opacity 0.5s ease'
          document.body.style.opacity = '1'
        }, 100)
      })

      // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
      function initEvents() {
        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        videoInput.addEventListener('change', handleFileUpload)

        // æ·»åŠ ç‰‡æ®µæŒ‰é’®
        addSegmentBtn.addEventListener('click', addSegment)

        // è·å–å½“å‰æ’­æ”¾æ—¶é—´æŒ‰é’®
        document
          .getElementById('setCurrentTimeAsStart')
          .addEventListener('click', setCurrentTimeAsStart)
        document
          .getElementById('setCurrentTimeAsEnd')
          .addEventListener('click', setCurrentTimeAsEnd)

        // å¤„ç†æŒ‰é’®
        processBtn.addEventListener('click', processVideo)

        // ä¸‹è½½æŒ‰é’®
        downloadBtn.addEventListener('click', downloadResult)

        // é‡ç½®æŒ‰é’®
        resetBtn.addEventListener('click', resetAll)

        // æ‹–æ”¾åŠŸèƒ½
        const dropArea = document.getElementById('fileDropArea')
        dropArea.addEventListener('dragover', (e) => {
          e.preventDefault()
          dropArea.classList.add('dragover')
        })

        dropArea.addEventListener('dragleave', () => {
          dropArea.classList.remove('dragover')
        })

        dropArea.addEventListener('drop', (e) => {
          e.preventDefault()
          dropArea.classList.remove('dragover')

          if (e.dataTransfer.files.length) {
            videoInput.files = e.dataTransfer.files
            handleFileUpload({ target: { files: e.dataTransfer.files } })
          }
        })
      }

      // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
      function handleFileUpload(event) {
        const file = event.target.files[0]
        if (!file) return

        // æ£€æŸ¥æ–‡ä»¶ç±»å‹
        if (!file.type.match('video.*') && !file.type.match('audio.*')) {
          showError('âŒ è¯·ä¸Šä¼ è§†é¢‘æˆ–éŸ³é¢‘æ–‡ä»¶', errorMessage)
          return
        }

        inputFile = file
        videoUrl = URL.createObjectURL(file)

        // æ˜¾ç¤ºåŸè§†é¢‘é¢„è§ˆ
        originalPreview.innerHTML = `
                <video controls style="border-radius: 15px;">
                    <source src="${videoUrl}" type="${file.type}">
                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘é¢„è§ˆ
                </video>
                <p style="text-align: center; padding: 15px 0; color: var(--text-secondary); font-weight: 500;">ğŸ“ ${
                  file.name
                } (${formatFileSize(file.size)})</p>
            `

        // é‡ç½®ç‰‡æ®µåˆ—è¡¨
        segments = []
        updateSegmentsList()

        // å¯ç”¨å¤„ç†æŒ‰é’®
        processBtn.disabled = false
        downloadBtn.disabled = true
        segmentStatus.textContent = 'âœ¨ è¯·æ·»åŠ è¦å‰ªè¾‘çš„æ—¶é—´æ®µ'
      }

      // æ·»åŠ æ—¶é—´æ®µ
      function addSegment() {
        const start = parseFloat(startTimeInput.value)
        const end = parseFloat(endTimeInput.value)

        // éªŒè¯è¾“å…¥
        if (isNaN(start) || isNaN(end) || start < 0 || end < 0) {
          showError('âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„æ—¶é—´å€¼', segmentError)
          return
        }

        if (start >= end) {
          showError('âŒ ç»“æŸæ—¶é—´å¿…é¡»å¤§äºå¼€å§‹æ—¶é—´', segmentError)
          return
        }

        if (!inputFile) {
          showError('âŒ è¯·å…ˆä¸Šä¼ è§†é¢‘æ–‡ä»¶', segmentError)
          return
        }

        // æ£€æŸ¥é‡å 
        for (const seg of segments) {
          if (
            (start >= seg.start && start < seg.end) ||
            (end > seg.start && end <= seg.end) ||
            (start <= seg.start && end >= seg.end)
          ) {
            showError(
              `âŒ æ—¶é—´æ®µä¸å·²æ·»åŠ çš„ç‰‡æ®µ (${seg.start}s-${seg.end}s) é‡å `,
              segmentError
            )
            return
          }
        }

        // æ·»åŠ æ–°ç‰‡æ®µ
        segments.push({ start, end })
        segments.sort((a, b) => a.start - b.start)

        updateSegmentsList()
        segmentStatus.textContent = `âœ… å·²æ·»åŠ ç‰‡æ®µ: ${start}s - ${end}s`
        segmentError.textContent = ''

        // æ¸…ç©ºè¾“å…¥
        startTimeInput.value = ''
        endTimeInput.value = ''
      }

      // æ›´æ–°ç‰‡æ®µåˆ—è¡¨æ˜¾ç¤º
      function updateSegmentsList() {
        if (segments.length === 0) {
          segmentsList.innerHTML =
            '<p style="text-align: center; padding: 20px; color: var(--text-secondary); font-style: italic;">ğŸ“­ æš‚æ— æ·»åŠ çš„ç‰‡æ®µ</p>'
          return
        }

        segmentsList.innerHTML = ''
        segments.forEach((seg, index) => {
          const segElement = document.createElement('div')
          segElement.className = 'segment-item'
          segElement.style.animationDelay = `${index * 0.1}s`
          segElement.innerHTML = `
                    <div class="segment-times">ğŸ¬ ${
                      index + 1
                    }. ${seg.start.toFixed(1)}s - ${seg.end.toFixed(1)}s</div>
                    <div class="segment-actions">
                        <button data-index="${index}">ğŸ—‘ï¸ åˆ é™¤</button>
                    </div>
                `
          segmentsList.appendChild(segElement)
        })

        // æ·»åŠ åˆ é™¤æŒ‰é’®äº‹ä»¶
        document.querySelectorAll('.segment-actions button').forEach((btn) => {
          btn.addEventListener('click', (e) => {
            const index = parseInt(e.target.getAttribute('data-index'))
            segments.splice(index, 1)
            updateSegmentsList()
            segmentStatus.textContent = 'ğŸ—‘ï¸ ç‰‡æ®µå·²åˆ é™¤'
          })
        })
      }

      // å¤„ç†è§†é¢‘å‰ªè¾‘
      async function processVideo() {
        if (!inputFile || segments.length === 0) {
          showError('âŒ è¯·ä¸Šä¼ æ–‡ä»¶å¹¶æ·»åŠ è‡³å°‘ä¸€ä¸ªå‰ªè¾‘ç‰‡æ®µ', errorMessage)
          return
        }

        // åˆå§‹åŒ–FFmpeg
        try {
          statusMessage.textContent = 'ğŸš€ æ­£åœ¨åŠ è½½FFmpegå¼•æ“...'
          statusMessage.classList.add('processing')
          errorMessage.textContent = ''
          processBtn.disabled = true
          downloadBtn.disabled = true

          if (!ffmpeg) {
            const { createFFmpeg, fetchFile } = FFmpeg
            ffmpeg = createFFmpeg({
              log: true,
            })

            // ç›‘å¬æ—¥å¿—è¾“å‡ºä»¥è·å–è¿›åº¦
            ffmpeg.setLogging(({ message }) => {
              if (message.startsWith('frame=')) {
                const match = message.match(/time=(\d+:\d+:\d+\.\d+)/)
                if (match) {
                  const time = match[1]
                  progressText.textContent = `âš¡ å¤„ç†ä¸­: ${time}`
                }
              }
            })

            // ç›‘å¬è¿›åº¦
            ffmpeg.setProgress(({ ratio }) => {
              const percent = Math.floor(ratio * 100)
              progressFill.style.width = `${percent}%`
              progressText.textContent = `ğŸ¯ å¤„ç†ä¸­: ${percent}%`
            })

            await ffmpeg.load()
          }

          statusMessage.textContent = 'ğŸ¬ æ­£åœ¨å¤„ç†è§†é¢‘...'
          const { fetchFile } = FFmpeg

          // å†™å…¥è§†é¢‘æ–‡ä»¶åˆ°è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ
          const inputName =
            'input.' + (inputFile.type.includes('audio') ? 'mp3' : 'mp4')
          ffmpeg.FS('writeFile', inputName, await fetchFile(inputFile))

          // æ„å»ºFFmpegå‘½ä»¤ - å¤šæ®µå‰ªè¾‘
          let filterComplex = ''
          segments.forEach((seg, i) => {
            filterComplex += `[0:v]trim=start=${seg.start}:end=${seg.end},setpts=PTS-STARTPTS[v${i}];`
            filterComplex += `[0:a]atrim=start=${seg.start}:end=${seg.end},asetpts=PTS-STARTPTS[a${i}];`
          })

          // è¿æ¥æ‰€æœ‰ç‰‡æ®µ
          filterComplex += segments.map((_, i) => `[v${i}][a${i}]`).join('')
          filterComplex += `concat=n=${segments.length}:v=1:a=1[outv][outa]`

          // æ‰§è¡ŒFFmpegå‘½ä»¤
          await ffmpeg.run(
            '-i',
            inputName,
            '-filter_complex',
            filterComplex,
            '-map',
            '[outv]',
            '-map',
            '[outa]',
            '-c:v',
            'libx264',
            '-c:a',
            'aac',
            'output.mp4'
          )

          // è¯»å–è¾“å‡ºæ–‡ä»¶
          const data = ffmpeg.FS('readFile', 'output.mp4')
          outputBlob = new Blob([data.buffer], { type: 'video/mp4' })
          const outputUrl = URL.createObjectURL(outputBlob)

          // æ˜¾ç¤ºç»“æœé¢„è§ˆ
          resultPreview.innerHTML = `
                    <video controls style="border-radius: 15px;">
                        <source src="${outputUrl}" type="video/mp4">
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘é¢„è§ˆ
                    </video>
                `

          statusMessage.textContent = 'ğŸ‰ è§†é¢‘å¤„ç†å®Œæˆï¼'
          statusMessage.classList.remove('processing')
          progressText.textContent = 'âœ… å¤„ç†å®Œæˆ'
          progressFill.style.width = '100%'
          downloadBtn.disabled = false
        } catch (error) {
          console.error('å¤„ç†å¤±è´¥:', error)
          showError(`âŒ å¤„ç†å¤±è´¥: ${error.message}`, errorMessage)
          statusMessage.classList.remove('processing')
          processBtn.disabled = false
        }
      }

      // ä¸‹è½½ç»“æœ
      function downloadResult() {
        if (!outputBlob) {
          showError('âŒ æ²¡æœ‰å¯ä¸‹è½½çš„ç»“æœ', errorMessage)
          return
        }

        const a = document.createElement('a')
        a.href = URL.createObjectURL(outputBlob)
        a.download = `å‰ªè¾‘ç»“æœ_${new Date()
          .toISOString()
          .slice(0, 19)
          .replace(/:/g, '-')}.mp4`
        a.click()

        statusMessage.textContent = 'ğŸ“¥ æ–‡ä»¶ä¸‹è½½ä¸­...'
      }

      // é‡ç½®æ‰€æœ‰
      function resetAll() {
        if (confirm('ğŸ¤” ç¡®å®šè¦é‡ç½®æ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
          segments = []
          updateSegmentsList()

          if (videoUrl) {
            URL.revokeObjectURL(videoUrl)
            videoUrl = null
          }

          inputFile = null
          outputBlob = null
          videoInput.value = ''
          startTimeInput.value = '0'
          endTimeInput.value = '5'

          originalPreview.innerHTML =
            '<p style="text-align: center; padding: 60px 20px; color: var(--text-secondary); font-size: 1.1rem;">ğŸ“º è§†é¢‘é¢„è§ˆåŒº</p>'
          resultPreview.innerHTML =
            '<p style="text-align: center; padding: 60px 20px; color: var(--text-secondary); font-size: 1.1rem;">ğŸï¸ å‰ªè¾‘ç»“æœé¢„è§ˆåŒº</p>'

          processBtn.disabled = true
          downloadBtn.disabled = true
          statusMessage.textContent = ''
          statusMessage.classList.remove('processing')
          errorMessage.textContent = ''
          segmentStatus.textContent = ''
          segmentError.textContent = ''
          progressFill.style.width = '0%'
          progressText.textContent = 'ğŸš€ å‡†å¤‡å°±ç»ª'
        }
      }

      // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
      function showError(message, element) {
        element.textContent = message
        element.classList.add('error-shake')
        setTimeout(() => {
          element.classList.remove('error-shake')
        }, 500)
      }

      // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
      function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes'
        const k = 1024
        const sizes = ['Bytes', 'KB', 'MB', 'GB']
        const i = Math.floor(Math.log(bytes) / Math.log(k))
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
      }

      // è·å–å½“å‰è§†é¢‘æ’­æ”¾æ—¶é—´å¹¶è®¾ç½®ä¸ºå¼€å§‹æ—¶é—´
      function setCurrentTimeAsStart() {
        const video = document.querySelector('#originalPreview video')
        if (!video) {
          showError('âŒ è¯·å…ˆä¸Šä¼ å¹¶æ’­æ”¾è§†é¢‘', segmentError)
          return
        }

        const currentTime = video.currentTime
        startTimeInput.value = currentTime.toFixed(1)
        segmentStatus.textContent = `â° å·²è®¾ç½®å¼€å§‹æ—¶é—´ä¸º: ${currentTime.toFixed(
          1
        )}ç§’`

        // æ·»åŠ è§†è§‰åé¦ˆ
        startTimeInput.style.background = 'rgba(78, 205, 196, 0.2)'
        setTimeout(() => {
          startTimeInput.style.background = ''
        }, 1000)
      }

      // è·å–å½“å‰è§†é¢‘æ’­æ”¾æ—¶é—´å¹¶è®¾ç½®ä¸ºç»“æŸæ—¶é—´
      function setCurrentTimeAsEnd() {
        const video = document.querySelector('#originalPreview video')
        if (!video) {
          showError('âŒ è¯·å…ˆä¸Šä¼ å¹¶æ’­æ”¾è§†é¢‘', segmentError)
          return
        }

        const currentTime = video.currentTime
        endTimeInput.value = currentTime.toFixed(1)
        segmentStatus.textContent = `â±ï¸ å·²è®¾ç½®ç»“æŸæ—¶é—´ä¸º: ${currentTime.toFixed(
          1
        )}ç§’`

        // æ·»åŠ è§†è§‰åé¦ˆ
        endTimeInput.style.background = 'rgba(78, 205, 196, 0.2)'
        setTimeout(() => {
          endTimeInput.style.background = ''
        }, 1000)
      }

      // åˆå§‹åŒ–
      initEvents()
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>极速在线图片格式转换器</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #1e3c72, #2a5298);
        color: #fff;
        min-height: 100vh;
        padding: 30px 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(12px);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
      }

      header {
        text-align: center;
        padding: 40px 20px;
        background: rgba(0, 0, 0, 0.25);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      h1 {
        font-size: 2.8rem;
        margin-bottom: 15px;
        background: linear-gradient(to right, #4facfe, #00f2fe);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .subtitle {
        font-size: 1.2rem;
        color: #a0d2ff;
        max-width: 600px;
        margin: 0 auto;
        line-height: 1.6;
      }

      .main-content {
        display: flex;
        flex-wrap: wrap;
        padding: 30px;
        gap: 30px;
      }

      .upload-panel {
        flex: 1;
        min-width: 300px;
        background: rgba(30, 40, 60, 0.7);
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }

      .settings-panel {
        flex: 1;
        min-width: 300px;
        background: rgba(30, 40, 60, 0.7);
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }

      .panel-title {
        font-size: 1.8rem;
        margin-bottom: 25px;
        color: #4facfe;
        display: flex;
        align-items: center;
      }

      .panel-title i {
        margin-right: 12px;
        font-size: 1.8rem;
      }

      .file-upload-area {
        border: 3px dashed #5d9cec;
        border-radius: 15px;
        padding: 40px 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: 25px;
        position: relative;
        background: rgba(93, 156, 236, 0.05);
      }

      .file-upload-area:hover {
        background: rgba(93, 156, 236, 0.15);
        transform: translateY(-5px);
      }

      .file-upload-area p {
        margin: 15px 0;
        font-size: 1.1rem;
        color: #c0e0ff;
      }

      .upload-icon {
        font-size: 60px;
        color: #4facfe;
        opacity: 0.7;
      }

      input[type='file'] {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        opacity: 0;
        cursor: pointer;
      }

      .format-options {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 15px;
        margin: 25px 0;
      }

      .format-option {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px 10px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid transparent;
      }

      .format-option:hover {
        transform: translateY(-3px);
        background: rgba(79, 172, 254, 0.2);
      }

      .format-option.active {
        background: rgba(79, 172, 254, 0.4);
        border-color: #4facfe;
      }

      .format-option img {
        width: 40px;
        height: 40px;
        margin-bottom: 8px;
        filter: invert(1);
      }

      .quality-control {
        margin: 25px 0;
      }

      .quality-slider {
        width: 100%;
        margin: 15px 0;
        -webkit-appearance: none;
        height: 10px;
        border-radius: 5px;
        background: rgba(255, 255, 255, 0.1);
        outline: none;
      }

      .quality-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: #4facfe;
        cursor: pointer;
        box-shadow: 0 0 10px rgba(79, 172, 254, 0.7);
      }

      .preview-container {
        background: #000;
        border-radius: 10px;
        overflow: hidden;
        margin-top: 15px;
        aspect-ratio: 16/9;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .preview-container img {
        max-width: 100%;
        max-height: 100%;
        display: block;
      }

      .file-list {
        max-height: 300px;
        overflow-y: auto;
        margin-top: 20px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        padding: 15px;
      }

      .file-item {
        display: flex;
        justify-content: space-between;
        padding: 12px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        margin-bottom: 10px;
        align-items: center;
      }

      .file-info {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .file-icon {
        width: 30px;
        height: 30px;
        filter: invert(1);
      }

      .file-name {
        max-width: 200px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .file-size {
        font-size: 0.8rem;
        color: #aaa;
      }

      .file-status {
        font-size: 0.9rem;
        color: #4facfe;
      }

      .actions {
        display: flex;
        gap: 15px;
        margin-top: 25px;
        flex-wrap: wrap;
      }

      button {
        flex: 1;
        min-width: 180px;
        background: linear-gradient(to right, #4facfe, #00f2fe);
        color: white;
        border: none;
        padding: 16px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: bold;
        font-size: 1.1rem;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      button:hover {
        transform: translateY(-3px);
        box-shadow: 0 7px 15px rgba(0, 0, 0, 0.3);
      }

      button:disabled {
        background: #555;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
        opacity: 0.6;
      }

      .btn-reset {
        background: linear-gradient(to right, #ff9966, #ff5e62);
      }

      .conversion-info {
        margin-top: 30px;
        padding: 20px;
        background: rgba(0, 30, 60, 0.5);
        border-radius: 15px;
      }

      .info-title {
        font-size: 1.5rem;
        margin-bottom: 15px;
        color: #00f2fe;
      }

      .info-content {
        line-height: 1.8;
        color: #c0e0ff;
      }

      .features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .feature {
        background: rgba(255, 255, 255, 0.05);
        padding: 20px;
        border-radius: 10px;
        border-left: 3px solid #4facfe;
      }

      .feature h3 {
        color: #4facfe;
        margin-bottom: 10px;
      }

      footer {
        text-align: center;
        padding: 30px;
        color: #a0d2ff;
        font-size: 0.9rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      @media (max-width: 768px) {
        .main-content {
          flex-direction: column;
        }

        h1 {
          font-size: 2.2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>极速在线图片格式转换</h1>
        <p class="subtitle">
          无需上传服务器 · 100%本地浏览器处理 · 支持批量转换 · 完美保护隐私
        </p>
      </header>

      <div class="main-content">
        <div class="upload-panel">
          <h2 class="panel-title">📁 图片上传</h2>

          <div class="file-upload-area" id="dropArea">
            <div class="upload-icon">📁</div>
            <p>拖放图片到此处 或 <u>点击选择文件</u></p>
            <p>支持 JPG, PNG, WEBP, BMP, GIF 等格式</p>
            <input type="file" id="fileInput" accept="image/*" multiple />
          </div>

          <div class="file-list" id="fileList">
            <p style="text-align: center; padding: 20px">暂无上传文件</p>
          </div>
        </div>

        <div class="settings-panel">
          <h2 class="panel-title">⚙️ 转换设置</h2>

          <h3>目标格式</h3>
          <div class="format-options">
            <div class="format-option active" data-format="jpg">
              <div>JPG</div>
            </div>
            <div class="format-option" data-format="png">
              <div>PNG</div>
            </div>
            <div class="format-option" data-format="webp">
              <div>WEBP</div>
            </div>
            <div class="format-option" data-format="bmp">
              <div>BMP</div>
            </div>
          </div>

          <div class="quality-control">
            <h3>输出质量 <span id="qualityValue">90%</span></h3>
            <input
              type="range"
              min="10"
              max="100"
              value="90"
              class="quality-slider"
              id="qualitySlider"
            />
            <p style="color: #aaa; font-size: 0.9rem">
              提示：仅JPG/WEBP支持质量调整，PNG为无损格式
            </p>
          </div>

          <div class="preview-container" id="previewContainer">
            <p>图片预览区</p>
          </div>

          <div class="actions">
            <button id="convertBtn">🔄 开始转换</button>
            <button id="downloadBtn" disabled>💾 全部下载</button>
            <button id="resetBtn" class="btn-reset">❌ 重置</button>
          </div>
        </div>
      </div>

      <div class="conversion-info">
        <h2 class="info-title">✨ 功能特点</h2>
        <div class="features">
          <div class="feature">
            <h3>完全本地处理</h3>
            <p>
              所有图片处理均在浏览器中完成，无需上传到任何服务器，100%保护您的隐私安全[4,5](@ref)。
            </p>
          </div>
          <div class="feature">
            <h3>批量高效转换</h3>
            <p>支持同时上传多张图片批量转换，大幅提升工作效率[1,6](@ref)。</p>
          </div>
          <div class="feature">
            <h3>格式全面支持</h3>
            <p>支持JPG、PNG、WEBP、BMP等主流图片格式互转[2,7](@ref)。</p>
          </div>
          <div class="feature">
            <h3>大文件兼容</h3>
            <p>可处理高达50MB的图片文件，满足专业需求[1,4](@ref)。</p>
          </div>
        </div>
      </div>

      <footer>
        <p>
          © 2025 极速图片格式转换器 | 基于HTML5 Canvas技术实现 | 永久免费无广告
        </p>
        <p>
          隐私声明：本工具不会收集任何用户上传的图片内容，所有处理均在您的浏览器中完成
        </p>
      </footer>
    </div>

    <script>
      // 全局变量
      let uploadedFiles = []
      let currentFormat = 'jpg'
      let currentQuality = 90

      // DOM元素
      const fileInput = document.getElementById('fileInput')
      const dropArea = document.getElementById('dropArea')
      const fileList = document.getElementById('fileList')
      const formatOptions = document.querySelectorAll('.format-option')
      const qualitySlider = document.getElementById('qualitySlider')
      const qualityValue = document.getElementById('qualityValue')
      const convertBtn = document.getElementById('convertBtn')
      const downloadBtn = document.getElementById('downloadBtn')
      const resetBtn = document.getElementById('resetBtn')
      const previewContainer = document.getElementById('previewContainer')

      // 初始化事件
      function initEvents() {
        // 文件选择处理
        fileInput.addEventListener('change', handleFileSelect)

        // 拖放功能
        dropArea.addEventListener('dragover', (e) => {
          e.preventDefault()
          dropArea.style.borderColor = '#00f2fe'
          dropArea.style.backgroundColor = 'rgba(0, 242, 254, 0.1)'
        })

        dropArea.addEventListener('dragleave', () => {
          dropArea.style.borderColor = '#5d9cec'
          dropArea.style.backgroundColor = 'rgba(93, 156, 236, 0.05)'
        })

        dropArea.addEventListener('drop', (e) => {
          e.preventDefault()
          dropArea.style.borderColor = '#5d9cec'
          dropArea.style.backgroundColor = 'rgba(93, 156, 236, 0.05)'

          if (e.dataTransfer.files.length) {
            handleFiles(e.dataTransfer.files)
          }
        })

        // 格式选择
        formatOptions.forEach((option) => {
          option.addEventListener('click', () => {
            formatOptions.forEach((opt) => opt.classList.remove('active'))
            option.classList.add('active')
            currentFormat = option.dataset.format
          })
        })

        // 质量滑块
        qualitySlider.addEventListener('input', () => {
          currentQuality = qualitySlider.value
          qualityValue.textContent = `${currentQuality}%`
        })

        // 转换按钮
        convertBtn.addEventListener('click', convertImages)

        // 下载按钮
        downloadBtn.addEventListener('click', downloadAll)

        // 重置按钮
        resetBtn.addEventListener('click', resetAll)
      }

      // 处理选择的文件
      function handleFileSelect(e) {
        handleFiles(e.target.files)
      }

      // 处理文件
      function handleFiles(files) {
        for (let i = 0; i < files.length; i++) {
          const file = files[i]

          // 检查文件类型
          if (!file.type.match('image.*')) {
            alert(`"${file.name}" 不是图片文件，已跳过`)
            continue
          }

          // 添加到文件列表
          uploadedFiles.push({
            file: file,
            status: '待转换',
            converted: null,
          })

          // 如果是第一个文件，显示预览
          if (i === 0) {
            showPreview(file)
          }
        }

        updateFileList()
      }

      // 显示预览
      function showPreview(file) {
        const reader = new FileReader()
        reader.onload = (e) => {
          previewContainer.innerHTML = `<img src="${e.target.result}" alt="预览">`
        }
        reader.readAsDataURL(file)
      }

      // 更新文件列表显示
      function updateFileList() {
        if (uploadedFiles.length === 0) {
          fileList.innerHTML =
            '<p style="text-align: center; padding: 20px;">暂无上传文件</p>'
          return
        }

        fileList.innerHTML = ''
        uploadedFiles.forEach((fileInfo, index) => {
          const file = fileInfo.file
          const item = document.createElement('div')
          item.className = 'file-item'

          const extension = file.name.split('.').pop().toUpperCase()
          const size = formatFileSize(file.size)

          item.innerHTML = `
                    <div class="file-info">
                        <div class="file-icon">📷</div>
                        <div>
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${extension} | ${size}</div>
                        </div>
                    </div>
                    <div class="file-status">${fileInfo.status}</div>
                `

          fileList.appendChild(item)
        })

        convertBtn.disabled = false
      }

      // 转换图片
      async function convertImages() {
        if (uploadedFiles.length === 0) {
          alert('请先上传图片')
          return
        }

        convertBtn.disabled = true
        convertBtn.textContent = '转换中...'

        // 转换所有图片
        for (let i = 0; i < uploadedFiles.length; i++) {
          const fileInfo = uploadedFiles[i]
          fileInfo.status = '转换中...'
          updateFileList()

          try {
            const convertedBlob = await convertImage(
              fileInfo.file,
              currentFormat,
              currentQuality
            )
            fileInfo.converted = {
              blob: convertedBlob,
              url: URL.createObjectURL(convertedBlob),
              name:
                fileInfo.file.name.replace(/\.[^/.]+$/, '') +
                '.' +
                currentFormat,
            }
            fileInfo.status = '✓ 转换完成'
          } catch (error) {
            console.error(error)
            fileInfo.status = '✗ 转换失败'
          }

          updateFileList()

          // 显示第一张转换完成的图片预览
          if (i === 0 && fileInfo.converted) {
            previewContainer.innerHTML = `<img src="${fileInfo.converted.url}" alt="转换预览">`
          }
        }

        convertBtn.textContent = '🔄 开始转换'
        downloadBtn.disabled = false
      }

      // 图片转换核心函数
      function convertImage(file, format, quality) {
        return new Promise((resolve, reject) => {
          const img = new Image()
          const reader = new FileReader()

          reader.onload = (e) => {
            img.onload = () => {
              // 创建Canvas进行转换
              const canvas = document.createElement('canvas')
              canvas.width = img.width
              canvas.height = img.height

              const ctx = canvas.getContext('2d')
              ctx.drawImage(img, 0, 0)

              // 根据格式转换
              let mimeType
              switch (format) {
                case 'jpg':
                case 'jpeg':
                  mimeType = 'image/jpeg'
                  break
                case 'png':
                  mimeType = 'image/png'
                  break
                case 'webp':
                  mimeType = 'image/webp'
                  break
                case 'bmp':
                  mimeType = 'image/bmp'
                  break
                default:
                  mimeType = 'image/jpeg'
              }

              // 转换质量处理
              let qualityValue = quality / 100
              if (format === 'png') {
                // PNG格式不支持质量参数
                qualityValue = undefined
              }

              canvas.toBlob(
                (blob) => {
                  if (blob) {
                    resolve(blob)
                  } else {
                    reject(new Error('图片转换失败'))
                  }
                },
                mimeType,
                qualityValue
              )
            }

            img.onerror = () => {
              reject(new Error('图片加载失败'))
            }

            img.src = e.target.result
          }

          reader.onerror = () => {
            reject(new Error('文件读取失败'))
          }

          reader.readAsDataURL(file)
        })
      }

      // 下载所有转换后的图片
      function downloadAll() {
        if (!uploadedFiles.some((file) => file.converted)) {
          alert('没有可下载的转换结果')
          return
        }

        // 创建并触发下载
        uploadedFiles.forEach((fileInfo) => {
          if (fileInfo.converted) {
            const a = document.createElement('a')
            a.href = fileInfo.converted.url
            a.download = fileInfo.converted.name
            document.body.appendChild(a)
            a.click()
            document.body.removeChild(a)
          }
        })
      }

      // 重置所有
      function resetAll() {
        // 释放对象URL
        uploadedFiles.forEach((fileInfo) => {
          if (fileInfo.converted) {
            URL.revokeObjectURL(fileInfo.converted.url)
          }
        })

        uploadedFiles = []
        fileInput.value = ''
        previewContainer.innerHTML = '<p>图片预览区</p>'
        convertBtn.disabled = true
        downloadBtn.disabled = true
        updateFileList()
      }

      // 格式化文件大小
      function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B'
        else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB'
        else return (bytes / 1048576).toFixed(1) + ' MB'
      }

      // 初始化
      window.onload = initEvents
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æé€Ÿåœ¨çº¿å›¾ç‰‡æ ¼å¼è½¬æ¢å™¨</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #1e3c72, #2a5298);
        color: #fff;
        min-height: 100vh;
        padding: 30px 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(12px);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
      }

      header {
        text-align: center;
        padding: 40px 20px;
        background: rgba(0, 0, 0, 0.25);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      h1 {
        font-size: 2.8rem;
        margin-bottom: 15px;
        background: linear-gradient(to right, #4facfe, #00f2fe);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .subtitle {
        font-size: 1.2rem;
        color: #a0d2ff;
        max-width: 600px;
        margin: 0 auto;
        line-height: 1.6;
      }

      .main-content {
        display: flex;
        flex-wrap: wrap;
        padding: 30px;
        gap: 30px;
      }

      .upload-panel {
        flex: 1;
        min-width: 300px;
        background: rgba(30, 40, 60, 0.7);
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }

      .settings-panel {
        flex: 1;
        min-width: 300px;
        background: rgba(30, 40, 60, 0.7);
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }

      .panel-title {
        font-size: 1.8rem;
        margin-bottom: 25px;
        color: #4facfe;
        display: flex;
        align-items: center;
      }

      .panel-title i {
        margin-right: 12px;
        font-size: 1.8rem;
      }

      .file-upload-area {
        border: 3px dashed #5d9cec;
        border-radius: 15px;
        padding: 40px 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: 25px;
        position: relative;
        background: rgba(93, 156, 236, 0.05);
      }

      .file-upload-area:hover {
        background: rgba(93, 156, 236, 0.15);
        transform: translateY(-5px);
      }

      .file-upload-area p {
        margin: 15px 0;
        font-size: 1.1rem;
        color: #c0e0ff;
      }

      .upload-icon {
        font-size: 60px;
        color: #4facfe;
        opacity: 0.7;
      }

      input[type='file'] {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        opacity: 0;
        cursor: pointer;
      }

      .format-options {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 15px;
        margin: 25px 0;
      }

      .format-option {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px 10px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid transparent;
      }

      .format-option:hover {
        transform: translateY(-3px);
        background: rgba(79, 172, 254, 0.2);
      }

      .format-option.active {
        background: rgba(79, 172, 254, 0.4);
        border-color: #4facfe;
      }

      .format-option img {
        width: 40px;
        height: 40px;
        margin-bottom: 8px;
        filter: invert(1);
      }

      .quality-control {
        margin: 25px 0;
      }

      .quality-slider {
        width: 100%;
        margin: 15px 0;
        -webkit-appearance: none;
        height: 10px;
        border-radius: 5px;
        background: rgba(255, 255, 255, 0.1);
        outline: none;
      }

      .quality-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: #4facfe;
        cursor: pointer;
        box-shadow: 0 0 10px rgba(79, 172, 254, 0.7);
      }

      .preview-container {
        background: #000;
        border-radius: 10px;
        overflow: hidden;
        margin-top: 15px;
        aspect-ratio: 16/9;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .preview-container img {
        max-width: 100%;
        max-height: 100%;
        display: block;
      }

      .file-list {
        max-height: 300px;
        overflow-y: auto;
        margin-top: 20px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        padding: 15px;
      }

      .file-item {
        display: flex;
        justify-content: space-between;
        padding: 12px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        margin-bottom: 10px;
        align-items: center;
      }

      .file-info {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .file-icon {
        width: 30px;
        height: 30px;
        filter: invert(1);
      }

      .file-name {
        max-width: 200px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .file-size {
        font-size: 0.8rem;
        color: #aaa;
      }

      .file-status {
        font-size: 0.9rem;
        color: #4facfe;
      }

      .actions {
        display: flex;
        gap: 15px;
        margin-top: 25px;
        flex-wrap: wrap;
      }

      button {
        flex: 1;
        min-width: 180px;
        background: linear-gradient(to right, #4facfe, #00f2fe);
        color: white;
        border: none;
        padding: 16px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: bold;
        font-size: 1.1rem;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      button:hover {
        transform: translateY(-3px);
        box-shadow: 0 7px 15px rgba(0, 0, 0, 0.3);
      }

      button:disabled {
        background: #555;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
        opacity: 0.6;
      }

      .btn-reset {
        background: linear-gradient(to right, #ff9966, #ff5e62);
      }

      .conversion-info {
        margin-top: 30px;
        padding: 20px;
        background: rgba(0, 30, 60, 0.5);
        border-radius: 15px;
      }

      .info-title {
        font-size: 1.5rem;
        margin-bottom: 15px;
        color: #00f2fe;
      }

      .info-content {
        line-height: 1.8;
        color: #c0e0ff;
      }

      .features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .feature {
        background: rgba(255, 255, 255, 0.05);
        padding: 20px;
        border-radius: 10px;
        border-left: 3px solid #4facfe;
      }

      .feature h3 {
        color: #4facfe;
        margin-bottom: 10px;
      }

      footer {
        text-align: center;
        padding: 30px;
        color: #a0d2ff;
        font-size: 0.9rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      @media (max-width: 768px) {
        .main-content {
          flex-direction: column;
        }

        h1 {
          font-size: 2.2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>æé€Ÿåœ¨çº¿å›¾ç‰‡æ ¼å¼è½¬æ¢</h1>
        <p class="subtitle">
          æ— éœ€ä¸Šä¼ æœåŠ¡å™¨ Â· 100%æœ¬åœ°æµè§ˆå™¨å¤„ç† Â· æ”¯æŒæ‰¹é‡è½¬æ¢ Â· å®Œç¾ä¿æŠ¤éšç§
        </p>
      </header>

      <div class="main-content">
        <div class="upload-panel">
          <h2 class="panel-title">ğŸ“ å›¾ç‰‡ä¸Šä¼ </h2>

          <div class="file-upload-area" id="dropArea">
            <div class="upload-icon">ğŸ“</div>
            <p>æ‹–æ”¾å›¾ç‰‡åˆ°æ­¤å¤„ æˆ– <u>ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</u></p>
            <p>æ”¯æŒ JPG, PNG, WEBP, BMP, GIF ç­‰æ ¼å¼</p>
            <input type="file" id="fileInput" accept="image/*" multiple />
          </div>

          <div class="file-list" id="fileList">
            <p style="text-align: center; padding: 20px">æš‚æ— ä¸Šä¼ æ–‡ä»¶</p>
          </div>
        </div>

        <div class="settings-panel">
          <h2 class="panel-title">âš™ï¸ è½¬æ¢è®¾ç½®</h2>

          <h3>ç›®æ ‡æ ¼å¼</h3>
          <div class="format-options">
            <div class="format-option active" data-format="jpg">
              <div>JPG</div>
            </div>
            <div class="format-option" data-format="png">
              <div>PNG</div>
            </div>
            <div class="format-option" data-format="webp">
              <div>WEBP</div>
            </div>
            <div class="format-option" data-format="bmp">
              <div>BMP</div>
            </div>
          </div>

          <div class="quality-control">
            <h3>è¾“å‡ºè´¨é‡ <span id="qualityValue">90%</span></h3>
            <input
              type="range"
              min="10"
              max="100"
              value="90"
              class="quality-slider"
              id="qualitySlider"
            />
            <p style="color: #aaa; font-size: 0.9rem">
              æç¤ºï¼šä»…JPG/WEBPæ”¯æŒè´¨é‡è°ƒæ•´ï¼ŒPNGä¸ºæ— æŸæ ¼å¼
            </p>
          </div>

          <div class="preview-container" id="previewContainer">
            <p>å›¾ç‰‡é¢„è§ˆåŒº</p>
          </div>

          <div class="actions">
            <button id="convertBtn">ğŸ”„ å¼€å§‹è½¬æ¢</button>
            <button id="downloadBtn" disabled>ğŸ’¾ å…¨éƒ¨ä¸‹è½½</button>
            <button id="resetBtn" class="btn-reset">âŒ é‡ç½®</button>
          </div>
        </div>
      </div>

      <div class="conversion-info">
        <h2 class="info-title">âœ¨ åŠŸèƒ½ç‰¹ç‚¹</h2>
        <div class="features">
          <div class="feature">
            <h3>å®Œå…¨æœ¬åœ°å¤„ç†</h3>
            <p>
              æ‰€æœ‰å›¾ç‰‡å¤„ç†å‡åœ¨æµè§ˆå™¨ä¸­å®Œæˆï¼Œæ— éœ€ä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ï¼Œ100%ä¿æŠ¤æ‚¨çš„éšç§å®‰å…¨[4,5](@ref)ã€‚
            </p>
          </div>
          <div class="feature">
            <h3>æ‰¹é‡é«˜æ•ˆè½¬æ¢</h3>
            <p>æ”¯æŒåŒæ—¶ä¸Šä¼ å¤šå¼ å›¾ç‰‡æ‰¹é‡è½¬æ¢ï¼Œå¤§å¹…æå‡å·¥ä½œæ•ˆç‡[1,6](@ref)ã€‚</p>
          </div>
          <div class="feature">
            <h3>æ ¼å¼å…¨é¢æ”¯æŒ</h3>
            <p>æ”¯æŒJPGã€PNGã€WEBPã€BMPç­‰ä¸»æµå›¾ç‰‡æ ¼å¼äº’è½¬[2,7](@ref)ã€‚</p>
          </div>
          <div class="feature">
            <h3>å¤§æ–‡ä»¶å…¼å®¹</h3>
            <p>å¯å¤„ç†é«˜è¾¾50MBçš„å›¾ç‰‡æ–‡ä»¶ï¼Œæ»¡è¶³ä¸“ä¸šéœ€æ±‚[1,4](@ref)ã€‚</p>
          </div>
        </div>
      </div>

      <footer>
        <p>
          Â© 2025 æé€Ÿå›¾ç‰‡æ ¼å¼è½¬æ¢å™¨ | åŸºäºHTML5 CanvasæŠ€æœ¯å®ç° | æ°¸ä¹…å…è´¹æ— å¹¿å‘Š
        </p>
        <p>
          éšç§å£°æ˜ï¼šæœ¬å·¥å…·ä¸ä¼šæ”¶é›†ä»»ä½•ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡å†…å®¹ï¼Œæ‰€æœ‰å¤„ç†å‡åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­å®Œæˆ
        </p>
      </footer>
    </div>

    <script>
      // å…¨å±€å˜é‡
      let uploadedFiles = []
      let currentFormat = 'jpg'
      let currentQuality = 90

      // DOMå…ƒç´ 
      const fileInput = document.getElementById('fileInput')
      const dropArea = document.getElementById('dropArea')
      const fileList = document.getElementById('fileList')
      const formatOptions = document.querySelectorAll('.format-option')
      const qualitySlider = document.getElementById('qualitySlider')
      const qualityValue = document.getElementById('qualityValue')
      const convertBtn = document.getElementById('convertBtn')
      const downloadBtn = document.getElementById('downloadBtn')
      const resetBtn = document.getElementById('resetBtn')
      const previewContainer = document.getElementById('previewContainer')

      // åˆå§‹åŒ–äº‹ä»¶
      function initEvents() {
        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        fileInput.addEventListener('change', handleFileSelect)

        // æ‹–æ”¾åŠŸèƒ½
        dropArea.addEventListener('dragover', (e) => {
          e.preventDefault()
          dropArea.style.borderColor = '#00f2fe'
          dropArea.style.backgroundColor = 'rgba(0, 242, 254, 0.1)'
        })

        dropArea.addEventListener('dragleave', () => {
          dropArea.style.borderColor = '#5d9cec'
          dropArea.style.backgroundColor = 'rgba(93, 156, 236, 0.05)'
        })

        dropArea.addEventListener('drop', (e) => {
          e.preventDefault()
          dropArea.style.borderColor = '#5d9cec'
          dropArea.style.backgroundColor = 'rgba(93, 156, 236, 0.05)'

          if (e.dataTransfer.files.length) {
            handleFiles(e.dataTransfer.files)
          }
        })

        // æ ¼å¼é€‰æ‹©
        formatOptions.forEach((option) => {
          option.addEventListener('click', () => {
            formatOptions.forEach((opt) => opt.classList.remove('active'))
            option.classList.add('active')
            currentFormat = option.dataset.format
          })
        })

        // è´¨é‡æ»‘å—
        qualitySlider.addEventListener('input', () => {
          currentQuality = qualitySlider.value
          qualityValue.textContent = `${currentQuality}%`
        })

        // è½¬æ¢æŒ‰é’®
        convertBtn.addEventListener('click', convertImages)

        // ä¸‹è½½æŒ‰é’®
        downloadBtn.addEventListener('click', downloadAll)

        // é‡ç½®æŒ‰é’®
        resetBtn.addEventListener('click', resetAll)
      }

      // å¤„ç†é€‰æ‹©çš„æ–‡ä»¶
      function handleFileSelect(e) {
        handleFiles(e.target.files)
      }

      // å¤„ç†æ–‡ä»¶
      function handleFiles(files) {
        for (let i = 0; i < files.length; i++) {
          const file = files[i]

          // æ£€æŸ¥æ–‡ä»¶ç±»å‹
          if (!file.type.match('image.*')) {
            alert(`"${file.name}" ä¸æ˜¯å›¾ç‰‡æ–‡ä»¶ï¼Œå·²è·³è¿‡`)
            continue
          }

          // æ·»åŠ åˆ°æ–‡ä»¶åˆ—è¡¨
          uploadedFiles.push({
            file: file,
            status: 'å¾…è½¬æ¢',
            converted: null,
          })

          // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œæ˜¾ç¤ºé¢„è§ˆ
          if (i === 0) {
            showPreview(file)
          }
        }

        updateFileList()
      }

      // æ˜¾ç¤ºé¢„è§ˆ
      function showPreview(file) {
        const reader = new FileReader()
        reader.onload = (e) => {
          previewContainer.innerHTML = `<img src="${e.target.result}" alt="é¢„è§ˆ">`
        }
        reader.readAsDataURL(file)
      }

      // æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
      function updateFileList() {
        if (uploadedFiles.length === 0) {
          fileList.innerHTML =
            '<p style="text-align: center; padding: 20px;">æš‚æ— ä¸Šä¼ æ–‡ä»¶</p>'
          return
        }

        fileList.innerHTML = ''
        uploadedFiles.forEach((fileInfo, index) => {
          const file = fileInfo.file
          const item = document.createElement('div')
          item.className = 'file-item'

          const extension = file.name.split('.').pop().toUpperCase()
          const size = formatFileSize(file.size)

          item.innerHTML = `
                    <div class="file-info">
                        <div class="file-icon">ğŸ“·</div>
                        <div>
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${extension} | ${size}</div>
                        </div>
                    </div>
                    <div class="file-status">${fileInfo.status}</div>
                `

          fileList.appendChild(item)
        })

        convertBtn.disabled = false
      }

      // è½¬æ¢å›¾ç‰‡
      async function convertImages() {
        if (uploadedFiles.length === 0) {
          alert('è¯·å…ˆä¸Šä¼ å›¾ç‰‡')
          return
        }

        convertBtn.disabled = true
        convertBtn.textContent = 'è½¬æ¢ä¸­...'

        // è½¬æ¢æ‰€æœ‰å›¾ç‰‡
        for (let i = 0; i < uploadedFiles.length; i++) {
          const fileInfo = uploadedFiles[i]
          fileInfo.status = 'è½¬æ¢ä¸­...'
          updateFileList()

          try {
            const convertedBlob = await convertImage(
              fileInfo.file,
              currentFormat,
              currentQuality
            )
            fileInfo.converted = {
              blob: convertedBlob,
              url: URL.createObjectURL(convertedBlob),
              name:
                fileInfo.file.name.replace(/\.[^/.]+$/, '') +
                '.' +
                currentFormat,
            }
            fileInfo.status = 'âœ“ è½¬æ¢å®Œæˆ'
          } catch (error) {
            console.error(error)
            fileInfo.status = 'âœ— è½¬æ¢å¤±è´¥'
          }

          updateFileList()

          // æ˜¾ç¤ºç¬¬ä¸€å¼ è½¬æ¢å®Œæˆçš„å›¾ç‰‡é¢„è§ˆ
          if (i === 0 && fileInfo.converted) {
            previewContainer.innerHTML = `<img src="${fileInfo.converted.url}" alt="è½¬æ¢é¢„è§ˆ">`
          }
        }

        convertBtn.textContent = 'ğŸ”„ å¼€å§‹è½¬æ¢'
        downloadBtn.disabled = false
      }

      // å›¾ç‰‡è½¬æ¢æ ¸å¿ƒå‡½æ•°
      function convertImage(file, format, quality) {
        return new Promise((resolve, reject) => {
          const img = new Image()
          const reader = new FileReader()

          reader.onload = (e) => {
            img.onload = () => {
              // åˆ›å»ºCanvasè¿›è¡Œè½¬æ¢
              const canvas = document.createElement('canvas')
              canvas.width = img.width
              canvas.height = img.height

              const ctx = canvas.getContext('2d')
              ctx.drawImage(img, 0, 0)

              // æ ¹æ®æ ¼å¼è½¬æ¢
              let mimeType
              switch (format) {
                case 'jpg':
                case 'jpeg':
                  mimeType = 'image/jpeg'
                  break
                case 'png':
                  mimeType = 'image/png'
                  break
                case 'webp':
                  mimeType = 'image/webp'
                  break
                case 'bmp':
                  mimeType = 'image/bmp'
                  break
                default:
                  mimeType = 'image/jpeg'
              }

              // è½¬æ¢è´¨é‡å¤„ç†
              let qualityValue = quality / 100
              if (format === 'png') {
                // PNGæ ¼å¼ä¸æ”¯æŒè´¨é‡å‚æ•°
                qualityValue = undefined
              }

              canvas.toBlob(
                (blob) => {
                  if (blob) {
                    resolve(blob)
                  } else {
                    reject(new Error('å›¾ç‰‡è½¬æ¢å¤±è´¥'))
                  }
                },
                mimeType,
                qualityValue
              )
            }

            img.onerror = () => {
              reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'))
            }

            img.src = e.target.result
          }

          reader.onerror = () => {
            reject(new Error('æ–‡ä»¶è¯»å–å¤±è´¥'))
          }

          reader.readAsDataURL(file)
        })
      }

      // ä¸‹è½½æ‰€æœ‰è½¬æ¢åçš„å›¾ç‰‡
      function downloadAll() {
        if (!uploadedFiles.some((file) => file.converted)) {
          alert('æ²¡æœ‰å¯ä¸‹è½½çš„è½¬æ¢ç»“æœ')
          return
        }

        // åˆ›å»ºå¹¶è§¦å‘ä¸‹è½½
        uploadedFiles.forEach((fileInfo) => {
          if (fileInfo.converted) {
            const a = document.createElement('a')
            a.href = fileInfo.converted.url
            a.download = fileInfo.converted.name
            document.body.appendChild(a)
            a.click()
            document.body.removeChild(a)
          }
        })
      }

      // é‡ç½®æ‰€æœ‰
      function resetAll() {
        // é‡Šæ”¾å¯¹è±¡URL
        uploadedFiles.forEach((fileInfo) => {
          if (fileInfo.converted) {
            URL.revokeObjectURL(fileInfo.converted.url)
          }
        })

        uploadedFiles = []
        fileInput.value = ''
        previewContainer.innerHTML = '<p>å›¾ç‰‡é¢„è§ˆåŒº</p>'
        convertBtn.disabled = true
        downloadBtn.disabled = true
        updateFileList()
      }

      // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
      function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B'
        else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB'
        else return (bytes / 1048576).toFixed(1) + ' MB'
      }

      // åˆå§‹åŒ–
      window.onload = initEvents
    </script>
  </body>
</html>
